"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[3887],{83887:function(e,s,t){t.d(s,{WB:function(){return bn},rc:function(){return V.rc},tj:function(){return V.tj},tl:function(){return $.tl},sp:function(){return ea},_p:function(){return No},sG:function(){return M},w_:function(){return Ro},o8:function(){return o.o8},tU:function(){return ht.v},js:function(){return Un},Te:function(){return V.Te},Rl:function(){return V.Rl},TH:function(){return Jn},$W:function(){return V.$W},Pn:function(){return V.Pn},YO:function(){return V.YO},XQ:function(){return V.XQ},$6:function(){return $.$6},$U:function(){return $o},pR:function(){return D.pR},h:function(){return F.h},Mq:function(){return F.Mq},d9:function(){return F.d9},BL:function(){return Zn},R7:function(){return Eo},Xz:function(){return Pn},Ie:function(){return Gn},Wx:function(){return ta},KW:function(){return Xn},Zn:function(){return eo},K0:function(){return Vo},GY:function(){return Y}});var n=t(76118),o=t(33481);const a=e=>{var s;return!0===(null===(s=e.metadata)||void 0===s?void 0:s[o.bz.IS_OVERALL_ASSESSMENT])},l=e=>{var s;return(0,n.isNumber)(null===(s=e.metadata)||void 0===s?void 0:s[o.bz.CHUNK_INDEX])},i=e=>Array.isArray(e)&&e.every((e=>(0,n.isPlainObject)(e)&&"doc_uri"in e&&"content"in e)),r=e=>Object.values(e||{}).find(i),d=(e,s,t)=>{const a=r(e)||[],l=r(s);return a.map(((e,s)=>{const a=null===l||void 0===l?void 0:l[s],i=(t||[]).filter((e=>(e.metadata||{})[o.bz.CHUNK_INDEX]===s)),r=(0,n.groupBy)(i,"name");return Object.keys(r).forEach((e=>{r[e]=(0,n.orderBy)(r[e],"timestamp","desc")})),{docUrl:e.doc_uri,content:e.content,retrievalAssessmentsByName:r,target:null===a||void 0===a?void 0:a.content}}))};function c(e){if(!e)return;const{columns:s,data:t,filename:o}=e;if(!s||!Array.isArray(s))throw new SyntaxError(`Artifact ${o} is malformed, it does not contain "columns" array`);if(!t||!Array.isArray(t))throw new SyntaxError(`Artifact ${o} is malformed, it does not contain "data" array`);const a=s.map(((e,s)=>null!==e&&void 0!==e?e:`column_${s}`));return t.map((e=>(0,n.zipObject)(a,e)))}var u=t(9858),m=t(46709),p=t(71102),g=t(27637);const v=p.zy,h=g.ok,f=g.N_,y="assessmentFilter";function w(e){if("undefined"!==e)return"true"===e||"false"!==e&&e}function b(e,s){if("pass-fail"===e.dtype){if("undefined"===s)return;return s}return"boolean"===e.dtype?"true"===s||"false"!==s&&void 0:s}function x(e){return void 0===e||null===e?"undefined":`${e}`}var I=t(90448);const Y=(e,s)=>{const[t,n]=(0,m.useState)(s&&e.find((e=>e.id===s.key))?s:void 0);return[(0,m.useMemo)((()=>{if(t&&e.find((e=>e.id===t.key)))return t}),[t,e]),n]};var S=t(68248),A=t(27757),C=t(74060),T=t(66916),R=t(79081),_=t(42747),k=t(73408);const N=(0,m.createContext)({table:void 0,setTable:()=>{},selectedRowIds:[],setSelectedRowIds:()=>{}}),M=({children:e})=>{const[s,t]=(0,m.useState)(),[n,o]=(0,m.useState)([]),a=(0,m.useMemo)((()=>({table:s,setTable:t,selectedRowIds:n,setSelectedRowIds:o})),[s,n]);return(0,k.Y)(N.Provider,{value:a,children:e})},E=({experimentIds:e,visible:s,selectedTraces:t,handleClose:n,deleteTraces:o})=>{const a=(0,_.tz)(),[l,i]=(0,m.useState)(""),[r,d]=(0,m.useState)(!1),c=t.map((e=>e.evaluationId));return(0,k.FD)(R.d,{componentId:"eval-tab.delete_traces-modal",title:(0,k.Y)(_.sA,{id:"gRz1nB",defaultMessage:"{count, plural, one {Delete Trace} other {Delete Traces}}",values:{count:c.length}}),visible:s,onCancel:n,okText:(0,k.Y)(_.sA,{id:"g56Cuk",defaultMessage:"Delete {count, plural, one { # trace } other { # traces }}",values:{count:c.length}}),onOk:()=>{(async()=>{try{var s;await o(null!==(s=e[0])&&void 0!==s?s:"",c),n()}catch(t){i(a.formatMessage({id:"zhzZUu",defaultMessage:"An error occured while attempting to delete traces. Please refresh the page and try again."}))}d(!1)})(),d(!0)},okButtonProps:{loading:r,danger:!0},children:[l&&(0,k.Y)(A.T.Paragraph,{color:"error",children:l}),(0,k.Y)(A.T.Paragraph,{children:(0,k.Y)(A.T.Text,{bold:!0,children:(0,k.Y)(_.sA,{id:"kmtWGf",defaultMessage:"{count, plural, one { # trace } other { # traces }} will be deleted.",values:{count:c.length}})})}),(0,k.Y)(A.T.Paragraph,{children:(0,k.Y)(_.sA,{id:"VfGJFc",defaultMessage:"Deleted traces cannot be restored. Are you sure you want to proceed?"})})]})};var D=t(93241),F=t(71540);const O=e=>{const{traceActions:s,experimentId:t,selectedTraces:o,traceInfos:a,setRowSelection:l}=e,{table:i,selectedRowIds:r}=(0,m.useContext)(N),d=(0,m.useMemo)((()=>(0,F.Co)(r.map((e=>{const s=null===a||void 0===a?void 0:a.find((s=>(0,F.h2)(s)===e));if(s)return{evaluationId:s.trace_id,requestId:s.client_request_id||s.trace_id,inputsId:s.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:s}})).filter((e=>!(0,n.isNil)(e))))),[r,a]),c=o||d;return(0,k.Y)(H,{experimentId:t,selectedTraces:c,traceActions:s,setRowSelection:null!==l&&void 0!==l?l:null===i||void 0===i?void 0:i.setRowSelection})},H=e=>{var s,t,o,a,l;const{experimentId:i,selectedTraces:r,traceActions:d,setRowSelection:c}=e,u=(0,_.tz)(),[p,g]=(0,m.useState)(!1),v=(0,m.useCallback)((()=>{1===r.length&&r[0].traceInfo&&null!==d&&void 0!==d&&d.editTags&&d.editTags.showEditTagsModalForTrace(r[0].traceInfo)}),[r,d]),h=(0,m.useCallback)((()=>{g(!0)}),[]),f=(0,m.useCallback)((async(e,s)=>{var t,n;await(null===d||void 0===d||null===(t=d.deleteTracesAction)||void 0===t||null===(n=t.deleteTraces)||void 0===n?void 0:n.call(t,e,s)),null===c||void 0===c||c({})}),[c,d]),y=Boolean(null===d||void 0===d?void 0:d.exportToEvals),w=(0,D.ij)()&&Boolean(null===d||void 0===d?void 0:d.editTags),b=Boolean(null===d||void 0===d?void 0:d.deleteTracesAction),x=(0,m.useCallback)((()=>{var e;null===d||void 0===d||null===(e=d.exportToEvals)||void 0===e||e.setShowExportTracesToDatasetsModal(!0)}),[null===d||void 0===d?void 0:d.exportToEvals]),I=null===d||void 0===d||null===(s=d.exportToEvals)||void 0===s?void 0:s.showExportTracesToDatasetsModal,Y=r.length>1,S=0===r.length;if(!y&&!w&&!b)return null;const T=(0,k.Y)(A.B,{componentId:"mlflow.genai-traces-table.actions-dropdown",disabled:S,type:"primary",endIcon:(0,k.Y)(C.ChevronDownIcon,{}),children:u.formatMessage({id:"PwQiIn",defaultMessage:"Actions{count}"},{count:S?"":` (${r.length})`})});return(0,k.FD)(k.FK,{children:[(0,k.FD)(C.DropdownMenu.Root,{children:[S?(0,k.Y)(R.T,{componentId:"mlflow.genai-traces-table.actions-disabled-tooltip",content:u.formatMessage({id:"HbgpOU",defaultMessage:"Select one or more traces to add to an evaluation or edit the traces."}),children:(0,k.Y)("div",{children:(0,k.Y)(C.DropdownMenu.Trigger,{asChild:!0,children:T})})}):(0,k.Y)(C.DropdownMenu.Trigger,{asChild:!0,children:T}),(0,k.FD)(C.DropdownMenu.Content,{children:[y&&(0,k.Y)(k.FK,{children:(0,k.FD)(C.DropdownMenu.Group,{children:[(0,k.Y)(C.DropdownMenu.Label,{children:u.formatMessage({id:"xiFkTH",defaultMessage:"Use for evaluation"})}),(0,k.Y)(C.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.export-to-datasets",onClick:x,children:u.formatMessage({id:"QcEYpD",defaultMessage:"Add to evaluation dataset"})})]})}),(w||b)&&(0,k.FD)(k.FK,{children:[y&&(0,k.Y)(C.DropdownMenu.Separator,{}),(0,k.FD)(C.DropdownMenu.Group,{children:[(0,k.Y)(C.DropdownMenu.Label,{children:u.formatMessage({id:"gerwuf",defaultMessage:"Edit"})}),w&&(0,k.Y)(C.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.edit-tags",onClick:v,disabled:Y,children:u.formatMessage({id:"A7jptW",defaultMessage:"Edit tags"})}),b&&(0,k.Y)(C.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.delete-traces",onClick:h,disabled:null===d||void 0===d||null===(t=d.deleteTracesAction)||void 0===t?void 0:t.isDisabled,disabledReason:null===d||void 0===d||null===(o=d.deleteTracesAction)||void 0===o?void 0:o.disabledReason,children:u.formatMessage({id:"G6CJOv",defaultMessage:"Delete traces"})})]})]})]})]}),null===d||void 0===d||null===(a=d.editTags)||void 0===a?void 0:a.EditTagsModal,I&&(null===d||void 0===d||null===(l=d.exportToEvals)||void 0===l?void 0:l.renderExportTracesToDatasetsModal({selectedTraceInfos:(0,n.compact)(r.map((e=>e.traceInfo)))})),p&&(null===d||void 0===d?void 0:d.deleteTracesAction)&&(0,k.Y)(E,{experimentIds:[i],visible:p,selectedTraces:r,handleClose:()=>g(!1),deleteTraces:f})]})};var V=t(4947),$=t(64667);const L=[$.w8.INFO,$.w8.ASSESSMENT,$.w8.EXPECTATION,$.w8.TAG],B=[V.XQ,V.d6,V.Rl,V.yX,V.tP,V.LV,V.im,V.YO],z=[o._1.OVERALL_ASSESSMENT],U=Object.fromEntries(L.map(((e,s)=>[e,s]))),j=Object.fromEntries(B.map(((e,s)=>[e,s]))),P=Object.fromEntries(z.map(((e,s)=>[e,s])));function q(e,s){return[...e].sort(((e,t)=>{var n,o;if(s){if(e.id===V.d6)return-1;if(t.id===V.d6)return 1}const a=null!==(n=e.group)&&void 0!==n?n:$.w8.INFO,l=null!==(o=t.group)&&void 0!==o?o:$.w8.INFO,i=U[a]-U[l];if(0!==i)return i;if(a===$.w8.INFO){var r,d;const s=null!==(r=j[e.id])&&void 0!==r?r:1/0,n=null!==(d=j[t.id])&&void 0!==d?d:1/0;return s!==n?s-n:e.label.localeCompare(t.label)}if(a===$.w8.ASSESSMENT){var c,u;const s=null!==(c=P[e.id])&&void 0!==c?c:1/0,n=null!==(u=P[t.id])&&void 0!==u?u:1/0;return s!==n?s-n:e.label.localeCompare(t.label)}return $.w8.EXPECTATION,e.label.localeCompare(t.label)}))}const K=(e,s)=>e.sort(((e,t)=>{const n=e=>{var t;const n=null===(t=s.find((s=>s.id===e.id)))||void 0===t?void 0:t.type;return n===$.$6.INPUT?1:e.id===V.LV?2:n===$.$6.TRACE_INFO?3:n===$.$6.INTERNAL_MONITOR_REQUEST_TIME?4:n===$.$6.ASSESSMENT?5:999},a=n(e)-n(t);if(0!==a)return a;const l=s.find((s=>s.id===e.id)),i=s.find((e=>e.id===t.id));return(null===l||void 0===l?void 0:l.type)===$.$6.ASSESSMENT&&(null===i||void 0===i?void 0:i.type)===$.$6.ASSESSMENT?l.id===o._1.OVERALL_ASSESSMENT?-1:i.id===o._1.OVERALL_ASSESSMENT?1:(l.label||"").localeCompare(i.label||""):0})),W=(e,s)=>{var t;switch(s){case V.Te:case V.tj:case V.Pn:case V.$W:return e[s];case V.FW:return e.tags;case V.XQ:return e.trace_id;case V.yX:return null===(t=e.tags)||void 0===t?void 0:t["mlflow.trace.session"];default:throw new Error(`Unknown column id: ${s}`)}};function Q(e){const s=new Map,t=new Map;return null===e||void 0===e||e.forEach((e=>{let n=(0,F.ZS)([e])?(0,F.h)(e.traceInfo):e.inputsId;if(s.has(n)){const s=(t.get(e.inputsId)||0)+1;t.set(e.inputsId,s),n=`${e.inputsId}_${s}`}s.set(n,e)})),s}function G(e,s){if((0,n.isNil)(s))return e.map((e=>({currentRunValue:e})));const t=Q(s),o=Q(e),a=new Set([...o.keys(),...t.keys()]);return Array.from(a).map((e=>({currentRunValue:o.get(e),otherRunValue:t.get(e)})))}var J=t(43617),Z=t(90061),X=t(49460),ee=t(23125),se=t(49708);const te=()=>{const{theme:e}=(0,A.u)();return(0,k.FD)("span",{css:(0,S.AH)({display:"flex",alignItems:"center",gap:e.spacing.sm,svg:{width:"12px",height:"12px"},color:e.colors.textValidationWarning},""),children:[(0,k.Y)(A.k,{css:(0,S.AH)({color:e.colors.textValidationWarning},"")}),(0,k.Y)(_.sA,{id:"HdEgbb",defaultMessage:"Error"})," "]})};var ne={name:"rhxkjj",styles:"height:20px"};const oe=({isComparing:e})=>{const{theme:s}=(0,A.u)();return(0,k.Y)("span",{css:ne,children:e&&(0,k.Y)("span",{css:(0,S.AH)({fontStyle:"italic",color:s.colors.textSecondary},""),children:"null"})})},ae=e=>{const{first:s,second:t,gap:n,borderRadius:o,marginY:a}=e,{theme:l}=(0,A.u)();return(0,k.FD)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",gap:n||l.spacing.sm,borderRadius:o||l.legacyBorders.borderRadiusMd,marginTop:a||"auto",marginBottom:a||"auto"},""),children:[s,t]})};var le=t(36476);const ie=fetch,re=async(e,s,t,n)=>{const o={method:s,signal:n,headers:{...t?{"Content-Type":"application/json"}:{},...ce(document.cookie)}};t&&(o.body=JSON.stringify(t));const a=await ie(e,o);if(!a.ok){const e=(0,le.a$)(a);try{const s=await(await a.json()).message;s&&(e.message=s)}catch{}throw e}return a.json()};const de=e=>{const s="mlflow-request-header-",t=function(e=document.cookie){return e.split(";").reduce(((e,s)=>{const[t,n]=s.trim().split("=");return e[t]=decodeURIComponent(n||""),e}),{})}(e);return t&&0!==Object.keys(t).length?Object.keys(t).filter((e=>e.startsWith(s))).reduce(((e,s)=>({...e,[s.substring(22)]:t[s]})),{}):{}},ce=e=>({...de(e)});var ue=t(12608),me=t.n(ue);class pe{static getEntryPointName(e){const s=e[pe.entryPointTag];return s?s.value:""}static getSourceType(e){const s=e[pe.sourceTypeTag];return s?s.value:""}static dropExtension(e){return e.replace(/(.*[^/])\.[^/.]+$/,"$1")}static baseName(e){const s=e.split("/");return s[s.length-1]}static formatSource(e){const s=pe.getSourceName(e),t=pe.getSourceType(e),n=pe.getEntryPointName(e);if("PROJECT"===t){let e=pe.dropExtension(pe.baseName(s));return n&&"main"!==n&&(e+=":"+n),e}if("JOB"===t){const t="mlflow.databricks.jobID",n="mlflow.databricks.jobRunID",o=e&&e[t]&&e[t].value,a=e&&e[n]&&e[n].value;return o&&a?pe.getDefaultJobRunName(o,a):s}return pe.baseName(s)}static getDefaultJobRunName(e,s,t=null){if(!e)return"-";let n=`job ${e}`;return s&&(n=`run ${s} of `+n),t&&(n=`workspace ${t}: `+n),n}static getSourceName(e){const s=e[pe.sourceNameTag];return s?s.value:""}static getGitHubRegex(){return/[@/]github.com[:/]([^/.]+)\/([^/#]+)#?(.*)/}static getGitLabRegex(){return/[@/]gitlab.com[:/]([^/.]+)\/([^/#]+)#?(.*)/}static getBitbucketRegex(){return/[@/]bitbucket.org[:/]([^/.]+)\/([^/#]+)#?(.*)/}static getExperimentChatSessionPageRoute(e,s){return`/experiments/${e}/chat-sessions/${s}`}static getRunPageRoute(e,s){return`/experiments/${e}/runs/${s}`}static getLoggedModelPageRoute(e,s){return`/experiments/${e}/models/${s}`}static getGitRegex(){return/(.*?[@/][^?]*git.*?)[:/]([^#]+)(?:#(.*))?/}static getGitRepoUrl(e,s="master"){const t=e.match(pe.getGitHubRegex()),n=e.match(pe.getGitLabRegex()),o=e.match(pe.getBitbucketRegex()),a=e.match(pe.getGitRegex());let l=null;if(t)l=`https://github.com/${t[1]}/${t[2].replace(/.git/,"")}`,t[3]&&(l+=`/tree/${s}/${t[3]}`);else if(n)l=`https://gitlab.com/${n[1]}/${n[2].replace(/.git/,"")}`,n[3]&&(l+=`/-/tree/${s}/${n[3]}`);else if(o)l=`https://bitbucket.org/${o[1]}/${o[2].replace(/.git/,"")}`,o[3]&&(l+=`/src/${s}/${o[3]}`);else if(a){const[,e,t,n]=a;l=e.replace(/git@/,"https://")+"/"+t.replace(/.git/,""),n&&(l+=`/tree/${s}/${n}`)}return l}static getNotebookRevisionId(e){const s="mlflow.databricks.notebookRevisionID";return e&&e[s]&&e[s].value}static getNotebookId(e){const s="mlflow.databricks.notebookID";return e&&e[s]&&e[s].value}static isCurrentWorkspace(e){return!0}static getDefaultNotebookRevisionName(e,s,t=null){if(!e)return"-";let n=`notebook ${e}`;return s&&(n=`revision ${s} of `+n),t&&(n=`workspace ${t}: `+n),n}static ensureUrlScheme(e,s="https"){return e?e.match(/^:\/\//i)?`${s}${e}`:e.match(/^[a-z1-9+-.]+:\/\//i)?e:`${s}://${e}`:e}static setQueryParams(e,s){const t=new URL(pe.ensureUrlScheme(e));return t.search=s||"",t.toString()}static getNotebookSourceUrl(e,s,t,n,o=null){let a=pe.setQueryParams(o||window.location.origin,e);return a+=`#notebook/${s}`,t&&(a+=`/revision/${t}`,n&&(a+=`/mlflow/run/${n}`)),a}static renderNotebookSource(e,s,t,n,o,a=null,l=null){const i=o?pe.baseName(o):pe.getDefaultNotebookRevisionName(s,t),r=l||i;if(s){const l=pe.getNotebookSourceUrl(e,s,t,n,a);return(0,k.Y)("a",{title:o||pe.getDefaultNotebookRevisionName(s,t),href:l,target:"_top",children:r})}return r}static addQueryParams(e,s){if(!s||0===Object.keys(s).length)return e;const t=new URLSearchParams(e);Object.entries(s).forEach((([e,s])=>Boolean(e)&&Boolean(s)&&t.set(e,s)));const n=t.toString();return""===n||n.includes("?")?n:`?${n}`}static getJobSourceUrl(e,s,t,n=null){let o=pe.setQueryParams(n||window.location.origin,e);return o+=`#job/${s}`,t&&(o+=`/run/${t}`),o}static renderJobSource(e,s,t,n,o=null,a=null){const l=n||pe.getDefaultJobRunName(s,t),i=a||l;if(s){const n=pe.getJobSourceUrl(e,s,t,o);return(0,k.Y)("a",{title:l,href:n,target:"_top",children:i})}return i}static renderSource(e,s,t,n="master"){const o=pe.getSourceName(e);let a=pe.formatSource(e);const l=pe.getGitRepoUrl(o,n);l&&(a=(0,k.Y)("a",{target:"_top",href:l,children:a}));const i=pe.getSourceType(e);if("NOTEBOOK"===i){const n=pe.getNotebookRevisionId(e),a=pe.getNotebookId(e),l="mlflow.databricks.workspaceID",i=e&&e[l]&&e[l].value;if(pe.isCurrentWorkspace(i))return pe.renderNotebookSource(s,a,n,t,o,null);{const l="mlflow.databricks.workspaceURL",r=e&&e[l]&&e[l].value,d=pe.addQueryParams(s,{o:i});return pe.renderNotebookSource(d,a,n,t,o,r)}}if("JOB"===i){const t="mlflow.databricks.jobID",n="mlflow.databricks.jobRunID",o=e&&e[t]&&e[t].value,l=e&&e[n]&&e[n].value,i="mlflow.databricks.workspaceID",r=e&&e[i]&&e[i].value;if(pe.isCurrentWorkspace(r))return pe.renderJobSource(s,o,l,a,null);{const t="mlflow.databricks.workspaceURL",n=e&&e[t]&&e[t].value,i=pe.addQueryParams(s,{o:r});return pe.renderJobSource(i,o,l,a,n)}}return a}static renderSourceFromMetadata(e){var s,t,n,o,a;const l=null===(s=e.trace_metadata)||void 0===s?void 0:s[pe.sourceNameTag],i=null===(t=e.trace_metadata)||void 0===t?void 0:t[pe.sourceTypeTag];let r=l?pe.baseName(l):"";const d=null===(n=e.trace_metadata)||void 0===n?void 0:n["mlflow.source.git.repoURL"],c=null===(o=e.trace_metadata)||void 0===o?void 0:o["mlflow.source.git.branch"],u=null===(a=e.trace_metadata)||void 0===a?void 0:a["mlflow.source.git.commit"];if(d){const e=d.replace("git@github.com:","https://github.com/").replace("git@gitlab.com:","https://gitlab.com/").replace("git@bitbucket.org:","https://bitbucket.org/").replace(".git",""),s=u||c||"master",t=l?`/${l}`:"";let n=e;n=e.includes("github.com")?`${e}/tree/${s}${t}`:e.includes("gitlab.com")?`${e}/-/tree/${s}${t}`:e.includes("bitbucket.org")?`${e}/src/${s}${t}`:`${e}/tree/${s}${t}`,r=(0,k.Y)("a",{target:"_blank",rel:"noopener noreferrer",href:n,onClick:e=>{e.stopPropagation()},children:r})}if("NOTEBOOK"===i){var m,p,g;const s=null===(m=e.trace_metadata)||void 0===m?void 0:m["mlflow.databricks.notebookRevisionID"],t=null===(p=e.trace_metadata)||void 0===p?void 0:p["mlflow.databricks.notebookID"],n=null===(g=e.trace_metadata)||void 0===g?void 0:g["mlflow.databricks.workspaceID"];if(pe.isCurrentWorkspace(n))return pe.renderNotebookSource(null,t,s,null,l,null);{var v;const o="mlflow.databricks.workspaceURL",a=(null===(v=e.trace_metadata)||void 0===v?void 0:v[o])||void 0,i=pe.addQueryParams(null,{o:n});return pe.renderNotebookSource(i,t,s,null,l,a)}}if("JOB"===i){var h,f,y;const s=null===(h=e.trace_metadata)||void 0===h?void 0:h["mlflow.databricks.jobID"],t=null===(f=e.trace_metadata)||void 0===f?void 0:f["mlflow.databricks.jobRunID"],n=null===(y=e.trace_metadata)||void 0===y?void 0:y["mlflow.databricks.workspaceID"];if(pe.isCurrentWorkspace(n))return pe.renderJobSource(null,s,t,r,null);{var w;const o="mlflow.databricks.workspaceURL",a=(null===(w=e.trace_metadata)||void 0===w?void 0:w[o])||void 0,l=pe.addQueryParams(null,{o:n});return pe.renderJobSource(l,s,t,r,a)}}return r}static formatDuration(e){return e<500?e+"ms":e<6e4?(e/1e3).toFixed(1)+"s":e<36e5?(e/1e3/60).toFixed(1)+"min":e<864e5?(e/1e3/60/60).toFixed(1)+"h":(e/1e3/60/60/24).toFixed(1)+"d"}static formatTimestamp(e,s){const t=new Date(0);return t.setUTCMilliseconds(e),s?s.formatDate(t,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):me()(t).format("YYYY-MM-DD HH:mm:ss")}}pe.runNameTag="mlflow.runName",pe.sourceNameTag="mlflow.source.name",pe.sourceTypeTag="mlflow.source.type",pe.entryPointTag="mlflow.project.entryPoint";var ge=pe;const ve=e=>{var s,t;const{experimentId:n,currentTraceInfo:o,otherTraceInfo:a,isComparing:l}=e,i=null===o||void 0===o||null===(s=o.trace_metadata)||void 0===s?void 0:s["mlflow.modelId"],r=null===a||void 0===a||null===(t=a.trace_metadata)||void 0===t?void 0:t["mlflow.modelId"];return(0,k.Y)(ae,{first:i?(0,k.Y)(we,{experimentId:n,modelId:i,isComparing:l}):(0,k.Y)(oe,{isComparing:l}),second:l&&(r?(0,k.Y)(we,{experimentId:n,modelId:r,isComparing:l}):(0,k.Y)(oe,{isComparing:l}))})};var he={name:"1puasmx",styles:"width:fit-content;max-width:100%;margin-right:0;cursor:pointer"},fe={name:"1it2kpr",styles:"max-width:100%;display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},ye={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const we=e=>{var s;const{experimentId:t,modelId:n,isComparing:o}=e,{theme:a}=(0,A.u)(),{data:l,isLoading:i,error:r}=be({loggedModelId:n}),d=null===l||void 0===l||null===(s=l.info)||void 0===s?void 0:s.name;return i?(0,k.Y)(C.ParagraphSkeleton,{}):r?(0,k.Y)(te,{}):d?(0,k.Y)(R.T,{componentId:"mlflow.eval-runs.model-version-cell-tooltip",content:d,children:(0,k.Y)(C.Tag,{componentId:"mlflow.eval-runs.model-version-cell",id:"model-version-cell",css:he,children:(0,k.Y)(f,{to:ge.getLoggedModelPageRoute(t,n),target:"_blank",css:fe,title:d,children:(0,k.FD)("div",{css:(0,S.AH)({display:"flex",alignItems:"center",gap:a.spacing.xs,maxWidth:"100%"},""),children:[(0,k.Y)(C.ModelsIcon,{css:(0,S.AH)({color:a.colors.textPrimary,fontSize:16},"")}),(0,k.Y)(A.T.Text,{css:ye,children:d})]})})})}):(0,k.Y)(oe,{isComparing:o})},be=({loggedModelId:e})=>{const{data:s,isLoading:t,isFetching:o,refetch:a,error:l}=(0,se.I)({queryKey:["loggedModelName",e],queryFn:async()=>await re(`ajax-api/2.0/mlflow/logged-models/${e}`,"GET"),cacheTime:1/0,staleTime:1/0,refetchOnMount:!1,retry:1,enabled:!(0,n.isNil)(e)});return{isLoading:t,isFetching:o,data:null===s||void 0===s?void 0:s.model,refetch:a,error:l}};var xe={name:"pzwiqy",styles:"display:flex;max-width:100%;text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};const Ie=e=>{var s,t,n;const{experimentId:o,runUuid:a}=e,{data:l,isLoading:i,error:r}=Ye(o,a),d=null===l||void 0===l||null===(s=l.runs)||void 0===s||null===(t=s[0])||void 0===t||null===(n=t.info)||void 0===n?void 0:n.run_name;return i?(0,k.Y)(C.ParagraphSkeleton,{}):r?(0,k.Y)(te,{}):d?(0,k.Y)(f,{css:xe,to:ge.getRunPageRoute(o,a),title:d,children:d}):(0,k.Y)(oe,{})},Ye=(e,s)=>(0,se.I)({queryKey:["runName",e,s],cacheTime:1/0,staleTime:1/0,retry:1,refetchOnMount:!1,queryFn:async()=>{const t=`run_id IN ('${s}')`;return await re("ajax-api/2.0/mlflow/runs/search","POST",{experiment_ids:[e],filter:t})}});var Se=function(e){return e.NOTEBOOK="NOTEBOOK",e.JOB="JOB",e.PROJECT="PROJECT",e.LOCAL="LOCAL",e.UNKNOWN="UNKNOWN",e}(Se||{});const Ae=({sourceType:e,className:s})=>e===Se.NOTEBOOK?(0,k.Y)(C.NotebookIcon,{className:s}):e===Se.LOCAL?(0,k.Y)(C.HomeIcon,{className:s}):e===Se.PROJECT?(0,k.Y)(C.FolderBranchIcon,{className:s}):e===Se.JOB?(0,k.Y)(C.WorkflowsIcon,{className:s}):null;var Ce={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"};const Te=e=>{var s;const t=e.traceInfo.tags,{theme:n}=(0,A.u)();if(!t)return(0,k.Y)(oe,{isComparing:e.isComparing});const o=null===(s=e.traceInfo.trace_metadata)||void 0===s?void 0:s[ge.sourceTypeTag],a=ge.renderSourceFromMetadata(e.traceInfo);return a&&o?(0,k.FD)("div",{css:(0,S.AH)({display:"flex",gap:n.spacing.xs,alignItems:"center",...e.disableLinks&&{"& a":{pointerEvents:"none",color:"inherit",textDecoration:"none",cursor:"default"}}},""),children:[(0,k.Y)(Ae,{sourceType:o,css:(0,S.AH)({color:n.colors.textSecondary},"")}),(0,k.Y)("span",{css:Ce,children:a})]}):(0,k.Y)(oe,{isComparing:e.isComparing})},Re={STATE_UNSPECIFIED:null,IN_PROGRESS:(0,_.zR)({id:"y56Vz9",defaultMessage:"In progress"}),OK:(0,_.zR)({id:"Mn7Kss",defaultMessage:"OK"}),ERROR:(0,_.zR)({id:"igK5Su",defaultMessage:"Error"})},_e=(e,s)=>"IN_PROGRESS"===e?(0,k.Y)(T.C,{css:(0,S.AH)({color:s.colors.textValidationWarning},"")}):"OK"===e?(0,k.Y)(C.CheckCircleIcon,{css:(0,S.AH)({color:s.colors.textValidationSuccess},"")}):"ERROR"===e?(0,k.Y)(C.XCircleIcon,{css:(0,S.AH)({color:s.colors.textValidationDanger},"")}):null,ke=({original:e,isComparing:s})=>{const{theme:t}=(0,A.u)(),n=(0,_.tz)(),o=Re[(null===e||void 0===e?void 0:e.state)||"STATE_UNSPECIFIED"];return o?(0,k.FD)("div",{css:(0,S.AH)({display:"flex",gap:t.spacing.xs,alignItems:"center"},""),children:[_e((null===e||void 0===e?void 0:e.state)||"STATE_UNSPECIFIED",t),o?n.formatMessage(o):""]}):(0,k.Y)(oe,{isComparing:s})};var Ne=t(16333);const{Paragraph:Me}=A.T;var Ee={name:"s5xdrg",styles:"display:flex;align-items:center"},De={name:"1ff36h2",styles:"flex-grow:1"};const Fe=m.memo((e=>{const{theme:s}=(0,A.u)();return(0,k.Y)(R.d,{componentId:"codegen_mlflow_app_src_common_components_keyvaluetagfullviewmodal.tsx_17",title:"Tag: "+e.tagKey,visible:e.isKeyValueTagFullViewModalVisible,onCancel:()=>e.setIsKeyValueTagFullViewModalVisible(!1),children:(0,k.FD)("div",{css:Ee,children:[(0,k.Y)(Me,{css:De,children:(0,k.Y)("pre",{css:(0,S.AH)({backgroundColor:s.colors.backgroundPrimary,marginTop:s.spacing.sm,whiteSpace:"pre-wrap",wordBreak:"break-all"},""),children:e.tagValue})}),(0,k.Y)("div",{css:(0,S.AH)({marginBottom:s.spacing.md},""),children:(0,k.Y)(Ne.ad,{componentId:"mlflow.genai-traces-table.tag_view_modal.tag_value_copy_button",copyText:e.tagValue})})]})})}));function Oe(e=!0){return e?{overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap",whiteSpace:"nowrap"}:{whiteSpace:"nowrap"}}const He=({isClosable:e=!1,onClose:s,tag:t,enableFullViewModal:n=!1,charLimit:o=30,maxWidth:a=300,className:l})=>{const i=(0,_.tz)(),[r,d]=(0,m.useState)(!1),{shouldTruncateKey:c,shouldTruncateValue:u}=function(e,s=30){const{key:t,value:n}=e,o=t.length+n.length,a=t.length>n.length,l=a?n.length:t.length;return o<=s?{shouldTruncateKey:!1,shouldTruncateValue:!1}:l>s/2?{shouldTruncateKey:!0,shouldTruncateValue:!0}:{shouldTruncateKey:a,shouldTruncateValue:!a}}(t,o),p=n&&(c||u),g=i.formatMessage({id:"ZXUtU8",defaultMessage:"Click to see more"});return(0,k.FD)("div",{children:[(0,k.Y)(C.Tag,{componentId:"codegen_mlflow_app_src_common_components_keyvaluetag.tsx_60",closable:e,onClose:s,title:t.key,className:l,children:(0,k.Y)(R.T,{componentId:"web-shared.genai-traces-table.key-value-tag.full-view-tooltip",content:p?(0,k.Y)("span",{children:g}):void 0,children:(0,k.FD)("span",{css:(0,S.AH)({maxWidth:a,display:"inline-flex"},""),onClick:()=>p?d(!0):void 0,children:[(0,k.Y)(A.T.Text,{bold:!0,title:t.key,css:Oe(c),children:t.key}),t.value&&(0,k.FD)(A.T.Text,{title:t.value,css:Oe(u),children:[": ",t.value]})]})})}),(0,k.Y)("div",{children:r&&(0,k.Y)(Fe,{tagKey:t.key,tagValue:t.value,isKeyValueTagFullViewModalVisible:r,setIsKeyValueTagFullViewModalVisible:d})})]})};var Ve={name:"1wcfv52",styles:"margin-right:0"},$e={name:"14cnl6e",styles:"flex-shrink:0;opacity:0;[role=row]:hover &{opacity:1;}[role=row]:focus-within &{opacity:1;}"};const Le=({onAddEditTags:e,tags:s,baseComponentId:t})=>{const{theme:n}=(0,A.u)(),o=(null===s||void 0===s?void 0:s.filter((({key:e})=>e&&!e.startsWith(F.nt))))||[],a=o.length>0;return(0,k.FD)("div",{css:(0,S.AH)({display:"flex",alignItems:"center",flexWrap:"wrap",columnGap:n.spacing.xs,rowGap:n.spacing.xs},""),children:[o.map((e=>(0,k.Y)(He,{tag:e,css:Ve,charLimit:20,maxWidth:150,enableFullViewModal:!0},e.key))),e&&(0,k.Y)(A.B,{componentId:`${t}.traces_table.edit_tag`,size:"small",icon:a?(0,k.Y)(C.PencilIcon,{}):void 0,onClick:e,children:a?void 0:(0,k.Y)(_.sA,{id:"vHNP+J",defaultMessage:"Add tags"}),css:$e,type:"tertiary"})]})};const Be=e=>{const{currentTraceInfo:s,otherTraceInfo:t,isComparing:n}=e;return(0,k.Y)(ae,{first:(0,k.Y)(Je,{traceInfo:s,isComparing:n}),second:n&&(0,k.Y)(Je,{traceInfo:t,isComparing:n})})};var ze={name:"58t467",styles:"width:fit-content;max-width:100%"},Ue={name:"hdknak",styles:"display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},je={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Pe={name:"ho1qnd",styles:"display:flex;flex-direction:row"},qe={name:"i9sky5",styles:"width:35%"},Ke={name:"ho1qnd",styles:"display:flex;flex-direction:row"},We={name:"i9sky5",styles:"width:35%"},Qe={name:"ho1qnd",styles:"display:flex;flex-direction:row"},Ge={name:"i9sky5",styles:"width:35%"};const Je=e=>{var s;const{traceInfo:t,isComparing:n}=e,o=null===t||void 0===t||null===(s=t.trace_metadata)||void 0===s?void 0:s[ee.TOKEN_USAGE_METADATA_KEY],a=(()=>{try{return o?JSON.parse(o):{}}catch{return{}}})(),l=a.total_tokens,i=a.input_tokens,r=a.output_tokens,d=(0,_.tz)();return l?(0,k.Y)(C.HoverCard,{trigger:(0,k.Y)(C.Tag,{css:ze,componentId:"mlflow.genai-traces-table.tokens",children:(0,k.Y)("span",{css:Ue,children:l})}),content:(0,k.FD)("div",{css:je,children:[l&&(0,k.FD)("div",{css:Pe,children:[(0,k.Y)("div",{css:qe,children:(0,k.Y)(A.T.Text,{children:d.formatMessage({id:"83wDn8",defaultMessage:"Total"})})}),(0,k.Y)("div",{children:(0,k.Y)(A.T.Text,{color:"secondary",children:l})})]}),i&&(0,k.FD)("div",{css:Ke,children:[(0,k.Y)("div",{css:We,children:(0,k.Y)(A.T.Text,{children:d.formatMessage({id:"Y7DzTT",defaultMessage:"Input"})})}),(0,k.Y)("div",{children:(0,k.Y)(A.T.Text,{color:"secondary",children:i})})]}),r&&(0,k.FD)("div",{css:Qe,children:[(0,k.Y)("div",{css:Ge,children:(0,k.Y)(A.T.Text,{children:d.formatMessage({id:"tGqJL4",defaultMessage:"Output"})})}),(0,k.Y)("div",{children:(0,k.Y)(A.T.Text,{color:"secondary",children:r})})]})]})}):(0,k.Y)(oe,{isComparing:n})};var Ze=t(10708);var Xe={name:"1wr4ndu",styles:"width:12px;height:12px;border-radius:6px;flex-shrink:0;border:1px solid rgba(0, 0, 0, 0.1);cursor:default;position:relative"},es={name:"mvtt3w",styles:"clip:rect(0px, 0px, 0px, 0px);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px"};const ss=m.memo((({color:e,hidden:s})=>(0,k.Y)("label",{css:Xe,style:{backgroundColor:e,display:s?"none":""},children:(0,k.Y)("span",{css:es,children:e})})));var ts=t(90081),ns=t(87879);var os={name:"6dhm9o",styles:"visibility:hidden"};const as=(e,s,t,o,a)=>{var l,i,r,d,c,u,m,p,g,v,h,f,y,w;const b=o.name,x={currentValue:(0,n.first)(null===(l=a.currentRunValue)||void 0===l?void 0:l.responseAssessmentsByName[b]),otherValue:(0,n.first)(null===(i=a.otherRunValue)||void 0===i?void 0:i.responseAssessmentsByName[b])},Y=(0,ts.Yl)(o,(null===(r=a.currentRunValue)||void 0===r?void 0:r.responseAssessmentsByName[b])||[]),A=(null===(d=a.currentRunValue)||void 0===d||null===(c=d.overallAssessments[0])||void 0===c||null===(u=c.rootCauseAssessment)||void 0===u?void 0:u.assessmentName)===b,T=(null===(m=a.otherRunValue)||void 0===m||null===(p=m.overallAssessments[0])||void 0===p||null===(g=p.rootCauseAssessment)||void 0===g?void 0:g.assessmentName)===b,R=x.currentValue?(0,I.Zh)(x.currentValue):void 0,_=x.otherValue?(0,I.Zh)(x.otherValue):void 0,N=function(e,s,t){if("pass-fail"===e.dtype)return s===t?"equal":s===I.gZ.YES?"greater":s===I.gZ.NO?"less":(0,n.isNil)(t)?"equal":"less";if("boolean"===e.dtype)return s===t?"equal":!0===s?"greater":!1===s?"less":(0,n.isNil)(t)?"equal":"less";if("string"===e.dtype){if(s===t)return"equal";if(null===s)return"less";if(null===t)return"greater";const e=s,o=t;return(0,n.isNil)(e)?"less":(0,n.isNil)(o)||1===e.toString().localeCompare(o.toString())?"greater":"less"}if("numeric"===e.dtype){if(s===t)return"equal";if(null===s)return"less";if(null===t)return"greater";return s>t?"greater":"less"}return"equal"}(o,(0,n.isNil)(R)?void 0:R,(0,n.isNil)(_)?void 0:_),M=_!==R,E=I.jr[b];return(0,k.Y)("div",{css:(0,S.AH)({display:"flex",gap:e.spacing.sm,alignItems:"center",marginTop:"auto",marginBottom:"auto"},""),children:t?(0,k.FD)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm,borderRadius:e.legacyBorders.borderRadiusMd,marginTop:"auto",marginBottom:"auto"},""),children:[(0,k.FD)("div",{css:(0,S.AH)({display:"flex",gap:e.spacing.sm,alignItems:"center"},""),children:[(0,k.Y)(Ze.m,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,assessment:x.currentValue,isRootCauseAssessment:A,assessmentInfo:o,type:"value"},`tag_${null===(v=a.currentRunValue)||void 0===v?void 0:v.evaluationId}_${null===(h=x.currentValue)||void 0===h?void 0:h.name}`),M&&(0,k.Y)(C.ArrowRightIcon,{css:(0,S.AH)({transform:"greater"===N?"rotate(-45deg)":"rotate(45deg)",color:e.colors.textSecondary},"")})]}),(0,k.FD)("div",{css:(0,S.AH)({display:"flex",gap:e.spacing.sm,alignItems:"center"},""),children:[(0,k.Y)(Ze.m,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,assessment:x.otherValue,isRootCauseAssessment:T,assessmentInfo:o,type:"value"},`tag_${null===(f=a.otherRunValue)||void 0===f?void 0:f.evaluationId}_${null===(y=x.currentValue)||void 0===y?void 0:y.name}`),M&&(0,k.Y)(C.ArrowRightIcon,{css:os})]})]}):x.currentValue?(0,k.Y)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm},""),children:Y.map((e=>{const s=e.latestAssessment,t=e.count;return(0,k.Y)(Ze.m,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,assessment:s,isRootCauseAssessment:A,assessmentInfo:o,type:"value",count:t},`tag_${e.latestAssessment.name}_${e.value}`)}))}):(0,k.Y)(Ze.m,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,isRootCauseAssessment:A,assessmentInfo:o,assessment:{name:b,rationale:E?s.formatMessage(E):s.formatMessage({id:"gOUJ0f",defaultMessage:"No assessment for this evaluation"}),source:{sourceId:"",sourceType:"AI_JUDGE",metadata:{}},stringValue:null,booleanValue:null,rootCauseAssessment:null,numericValue:null,timestamp:null,metadata:{}},type:"value"},`tag_${b}_${null===(w=a.currentRunValue)||void 0===w?void 0:w.evaluationId}`)})};var ls={name:"36bnqj",styles:"display:flex;flex:1"},is={name:"36bnqj",styles:"display:flex;flex:1"};var rs={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},ds={name:"1jwcxx3",styles:"font-style:italic"},cs={name:"zjik7",styles:"display:flex"},us={name:"1suksrg",styles:"width:12px;height:12px"},ms={name:"zjik7",styles:"display:flex"},ps={name:"1suksrg",styles:"width:12px;height:12px"};var gs={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},vs={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},hs={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},fs={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},ys={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},ws={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},bs={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},xs={name:"58t467",styles:"width:fit-content;max-width:100%"},Is={name:"hdknak",styles:"display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Ys={name:"58t467",styles:"width:fit-content;max-width:100%"},Ss={name:"4fjnre",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},As={name:"58t467",styles:"width:fit-content;max-width:100%"},Cs={name:"4fjnre",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Ts={name:"58t467",styles:"width:fit-content;max-width:100%"},Rs={name:"4fjnre",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},_s={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},ks={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Ns={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Ms={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Es={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Ds={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Fs={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Os={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const Hs=120,Vs=120;const $s=e=>{let s=e;try{var t,o;const i=JSON.parse(e).response.choices;var a,l;if(Array.isArray(i)&&!(0,n.isNil)(null===(t=i[0])||void 0===t||null===(o=t.message)||void 0===o?void 0:o.content))s=null===(a=i[0])||void 0===a||null===(l=a.message)||void 0===l?void 0:l.content;else s=(0,I.ng)(e)}catch{s=(0,I.ng)(e)}return s},Ls=(e,{evaluationInputs:s,isComparing:t,theme:o,intl:a,experimentId:l,onChangeEvaluationId:i,onTraceTagsEdit:r})=>{const d={header:e.label,id:e.id,accessorFn:e=>e};switch(e.type){case $.$6.INPUT:return{...d,sortingFn:(s,t)=>{var n,o,a,l,i,r,d,c;const u=s.getValue(e.id),m=t.getValue(e.id),p={request:(null===(n=u.currentRunValue)||void 0===n?void 0:n.inputs[e.id])||(null===(o=u.otherRunValue)||void 0===o?void 0:o.inputs[e.id])||"",evalId:(null===(a=u.currentRunValue)||void 0===a?void 0:a.evaluationId)||(null===(l=u.otherRunValue)||void 0===l?void 0:l.evaluationId)||""},g={request:(null===(i=m.currentRunValue)||void 0===i?void 0:i.inputs[e.id])||(null===(r=m.otherRunValue)||void 0===r?void 0:r.inputs[e.id])||"",evalId:(null===(d=m.currentRunValue)||void 0===d?void 0:d.evaluationId)||(null===(c=m.otherRunValue)||void 0===c?void 0:c.evaluationId)||""};return JSON.stringify(p).localeCompare(JSON.stringify(g))},size:300/s.length,minSize:120,cell:s=>{var n;return((e,s,t,n,o,a)=>{var l,i,r,d,c,m,p,g;const v=s.getValue(),h=(null===(l=v.currentRunValue)||void 0===l?void 0:l.evaluationId)||(null===(i=v.otherRunValue)||void 0===i?void 0:i.evaluationId),f=null===(r=v.currentRunValue)||void 0===r||null===(d=r.traceInfo)||void 0===d||null===(c=d.trace_metadata)||void 0===c?void 0:c[F.kQ],y=null===(m=v.otherRunValue)||void 0===m||null===(p=m.traceInfo)||void 0===p||null===(g=p.trace_metadata)||void 0===g?void 0:g[F.kQ],w=a&&f?a(f):u.IX,b=a&&y?a(y):u.OV,x=v.currentRunValue?(0,I.Qq)(v.currentRunValue,o):void 0,Y=v.otherRunValue?(0,I.Qq)(v.otherRunValue,o):void 0,C=x||Y;return(0,k.FD)("div",{css:(0,S.AH)({height:"100%",width:"100%",display:"flex",overflow:"hidden",alignItems:"center",justifyContent:"space-between",gap:n.spacing.sm},""),children:[(0,k.Y)(A.T.Link,{css:rs,componentId:"mlflow.evaluations_review.table_ui.evaluation_id_link",onClick:()=>e(h),children:C||(0,k.Y)("span",{css:ds,children:"null"})}),t&&(0,k.FD)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",gap:n.spacing.md},""),children:[(0,k.Y)("div",{css:cs,children:f?(0,k.Y)(ss,{color:w}):(0,k.Y)("div",{css:us})}),(0,k.Y)("div",{css:ms,children:y?(0,k.Y)(ss,{color:b}):(0,k.Y)("div",{css:ps})})]})]})})(i,s,t,o,e.id,null===(n=s.table.options.meta)||void 0===n?void 0:n.getRunColor)}};case $.$6.ASSESSMENT:return{...d,accessorFn:s=>({isComparing:t,assessmentInfo:e.assessmentInfo,comparisonEntry:s}),sortingFn:(s,t)=>{const{comparisonEntry:o}=s.getValue(e.id),{comparisonEntry:a}=t.getValue(e.id);if(e.assessmentInfo){var l,i,r,d,c,u,m,p;const s={currentValue:null===(l=o.currentRunValue)||void 0===l||null===(i=l.responseAssessmentsByName[e.assessmentInfo.name])||void 0===i?void 0:i[0],otherValue:null===(r=o.otherRunValue)||void 0===r||null===(d=r.responseAssessmentsByName[e.assessmentInfo.name])||void 0===d?void 0:d[0]},t={currentValue:null===(c=a.currentRunValue)||void 0===c||null===(u=c.responseAssessmentsByName[e.assessmentInfo.name])||void 0===u?void 0:u[0],otherValue:null===(m=a.otherRunValue)||void 0===m||null===(p=m.responseAssessmentsByName[e.assessmentInfo.name])||void 0===p?void 0:p[0]};return function(e,s,t){const o=s.currentValue?(0,I.Zh)(s.currentValue):void 0,a=t.currentValue?(0,I.Zh)(t.currentValue):void 0,l=s.otherValue?(0,I.Zh)(s.otherValue):void 0,i=t.otherValue?(0,I.Zh)(t.otherValue):void 0;if("pass-fail"===e.dtype){const e=l===I.gZ.YES&&o===I.gZ.NO,n=i===I.gZ.YES&&a===I.gZ.NO,r=l===I.gZ.NO&&o===I.gZ.YES,d=i===I.gZ.NO&&a===I.gZ.YES,c=l===I.gZ.NO&&o===I.gZ.NO,u=i===I.gZ.NO&&a===I.gZ.NO,m=l===I.gZ.YES&&o===I.gZ.YES,p=i===I.gZ.YES&&a===I.gZ.YES;return e&&!n?-1:!e&&n?1:c&&!u?-1:!c&&u?1:r&&!d?-1:!r&&d?1:m&&!p?-1:!m&&p?1:function(e,s){if(!e&&s)return 1;if(e&&!s)return-1;if(!e||!s)return 0;const t=e.stringValue===I.gZ.YES||e.stringValue!==I.gZ.NO&&void 0,n=s.stringValue===I.gZ.YES||s.stringValue!==I.gZ.NO&&void 0;if(t===n)return 0;if(void 0===t)return 1;if(void 0===n)return-1;return t?1:-1}(s.currentValue,t.currentValue)}return o===a?0:(0,n.isNil)(o)||(0,n.isNil)(a)?(0,n.isNil)(o)?-1:1:o>a?1:-1}(e.assessmentInfo,s,t)}return 0},maxSize:200,size:t?Vs:Hs,minSize:t?Vs:Hs,cell:e=>{const{isComparing:s,assessmentInfo:t,comparisonEntry:n}=e.getValue();return as(o,a,s,t,n)}};case $.$6.EXPECTATION:return{...d,accessorFn:s=>({isComparing:t,expectationName:e.expectationName,comparisonEntry:s}),maxSize:200,size:t?Vs:Hs,minSize:t?Vs:Hs,cell:e=>{const{isComparing:s,expectationName:t,comparisonEntry:n}=e.getValue();return((e,s,t,n,o)=>{var a,l,i,r;const d=null===(a=o.currentRunValue)||void 0===a||null===(l=a.targets)||void 0===l?void 0:l[n],c=null===(i=o.otherRunValue)||void 0===i||null===(r=i.targets)||void 0===r?void 0:r[n],u=d?(0,k.Y)(ee.ExpectationValuePreview,{parsedValue:d,singleLine:!0}):(0,k.Y)(oe,{isComparing:t}),m=c?(0,k.Y)(ee.ExpectationValuePreview,{parsedValue:c,singleLine:!0}):(0,k.Y)(oe,{isComparing:t});return t?(0,k.FD)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm},""),children:[(0,k.Y)("div",{css:ls,children:u}),(0,k.Y)("div",{css:is,children:m})]}):u})(o,0,s,t,n)}};case $.$6.TRACE_INFO:return{...d,accessorFn:e=>({isComparing:t,comparisonEntry:e}),sortingFn:(s,t)=>{var n,o;const{comparisonEntry:a}=s.getValue(e.id),{comparisonEntry:l}=t.getValue(e.id);return((e,s,t)=>{var n,o;if(!V.My.includes(t))return 0;const a=String(null!==(n=W(e,t))&&void 0!==n?n:""),l=String(null!==(o=W(s,t))&&void 0!==o?o:"");return a.localeCompare(l,void 0,{numeric:!0})})(null===a||void 0===a||null===(n=a.currentRunValue)||void 0===n?void 0:n.traceInfo,null===l||void 0===l||null===(o=l.currentRunValue)||void 0===o?void 0:o.traceInfo,e.id)},size:e.id===V.Rl?300:100,minSize:e.id===V.Rl?120:100,cell:s=>{const{isComparing:t,comparisonEntry:a}=s.getValue();return((e,s,t,o,a,l,i)=>{var r,d;const c=null===(r=o.currentRunValue)||void 0===r?void 0:r.traceInfo,u=s?null===(d=o.otherRunValue)||void 0===d?void 0:d.traceInfo:void 0;if(t===V.Te){const e=null!==c&&void 0!==c&&c.request_time?new Date(c.request_time):void 0,t=null!==u&&void 0!==u&&u.request_time?new Date(u.request_time):void 0;return(0,k.Y)(ae,{first:e?(0,k.Y)(R.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-request-time",content:e.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,k.Y)("span",{css:gs,children:(0,ns.Pt)(e)})}):(0,k.Y)(oe,{isComparing:s}),second:s&&(t?(0,k.Y)(R.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-other-request-time",content:t.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,k.Y)("span",{css:vs,children:(0,ns.Pt)(t)})}):(0,k.Y)(oe,{isComparing:s}))})}if(t===V.$W)return(0,k.Y)(ae,{first:(0,k.Y)(ke,{original:c,isComparing:s}),second:s&&(u?(0,k.Y)(ke,{original:u,isComparing:s}):(0,k.Y)(oe,{isComparing:s}))});if(t===V.FW)return(0,k.Y)(ae,{first:c?(0,k.Y)(Te,{traceInfo:c,isComparing:s}):(0,k.Y)(oe,{isComparing:s}),second:s&&(u?(0,k.Y)(Te,{traceInfo:u,isComparing:s}):(0,k.Y)(oe,{isComparing:s}))});if(t===V.Pn){const e=Object.entries((null===c||void 0===c?void 0:c.tags)||{}).map((([e,s])=>({key:e,value:s}))),t=Object.entries((null===u||void 0===u?void 0:u.tags)||{}).map((([e,s])=>({key:e,value:s}))),n=!u&&c?()=>null===i||void 0===i?void 0:i(c):void 0;return(0,k.Y)(ae,{first:(0,k.Y)(Le,{baseComponentId:"tags-cell-renderer",tags:e,onAddEditTags:n}),second:s&&(u?(0,k.Y)(Le,{baseComponentId:"tags-cell-renderer-other",tags:t}):(0,k.Y)(oe,{isComparing:s}))})}if((0,D.ij)()&&t.startsWith(V.Pn)){var m,p;const e=(0,F.PO)(t);if(!e)return(0,k.Y)(oe,{isComparing:s});const n=null===c||void 0===c||null===(m=c.tags)||void 0===m?void 0:m[e],o=null===u||void 0===u||null===(p=u.tags)||void 0===p?void 0:p[e];return(0,k.Y)(ae,{first:n?(0,k.Y)("span",{title:n,css:hs,children:n}):(0,k.Y)(oe,{isComparing:s}),second:s&&(o?(0,k.Y)("span",{title:n,css:fs,children:o}):(0,k.Y)(oe,{isComparing:s}))})}if(t===V.LV){var g,v,h,y,w;const e=null===(g=o.currentRunValue)||void 0===g?void 0:g.evaluationId,t=null===c||void 0===c||null===(v=c.tags)||void 0===v?void 0:v["mlflow.traceName"],n=null===u||void 0===u||null===(h=u.tags)||void 0===h?void 0:h["mlflow.traceName"];return(0,k.Y)(ae,{first:t?s?(0,k.Y)("div",{children:null===c||void 0===c||null===(w=c.tags)||void 0===w?void 0:w["mlflow.traceName"]}):(0,k.Y)(A.T.Link,{css:ys,componentId:"mlflow.evaluations_review.table_ui.evaluation_id_link",onClick:()=>e&&a(e),children:null===c||void 0===c||null===(y=c.tags)||void 0===y?void 0:y["mlflow.traceName"]}):(0,k.Y)(oe,{isComparing:s}),second:s&&(n?(0,k.Y)("div",{children:n}):(0,k.Y)(oe,{isComparing:s}))})}if(t===V.li){var b;const s=null===c||void 0===c||null===(b=c.trace_metadata)||void 0===b?void 0:b[F.kQ];return s?(0,k.Y)(Ie,{experimentId:e,runUuid:s}):(0,k.Y)(oe,{})}if(t===V.tP){var x,Y,T,_;const e=(null===c||void 0===c||null===(x=c.trace_metadata)||void 0===x?void 0:x["mlflow.trace.user"])||(null===c||void 0===c||null===(Y=c.tags)||void 0===Y?void 0:Y["mlflow.user"]),t=(null===u||void 0===u||null===(T=u.trace_metadata)||void 0===T?void 0:T["mlflow.trace.user"])||(null===u||void 0===u||null===(_=u.tags)||void 0===_?void 0:_["mlflow.user"]);return(0,k.Y)(ae,{first:e?(0,k.FD)("span",{css:(0,S.AH)({display:"flex",alignItems:"center",gap:l.spacing.xs},""),title:e,children:[(0,k.Y)(C.UserIcon,{css:(0,S.AH)({color:l.colors.textSecondary,fontSize:16},"")}),(0,k.Y)("span",{css:ws,children:e})]}):(0,k.Y)(oe,{isComparing:s}),second:s&&(t?(0,k.FD)("span",{css:(0,S.AH)({display:"flex",alignItems:"center",gap:l.spacing.xs},""),title:t,children:[(0,k.Y)(C.UserIcon,{css:(0,S.AH)({color:l.colors.textSecondary,fontSize:16},"")}),(0,k.Y)("span",{css:bs,children:t})]}):(0,k.Y)(oe,{isComparing:s}))})}if(t===V.XQ){const e=null===c||void 0===c?void 0:c.trace_id,t=null===u||void 0===u?void 0:u.trace_id;return(0,k.Y)(ae,{first:e?(0,k.Y)(C.Tag,{css:xs,componentId:"mlflow.genai-traces-table.trace-id",color:"indigo",onClick:()=>a(e),children:(0,k.Y)("span",{css:Is,children:e})}):(0,k.Y)(oe,{isComparing:s}),second:s&&(t?(0,k.Y)(C.Tag,{css:Ys,componentId:"mlflow.genai-traces-table.trace-id",color:"indigo",title:t,onClick:()=>a(t),children:(0,k.Y)("span",{css:Ss,children:t})}):(0,k.Y)(oe,{isComparing:s}))})}if(t===V.yX){var N,M;const t=null===c||void 0===c||null===(N=c.trace_metadata)||void 0===N?void 0:N["mlflow.trace.session"],n=null===u||void 0===u||null===(M=u.trace_metadata)||void 0===M?void 0:M["mlflow.trace.session"];return(0,k.Y)(ae,{first:t?(0,k.Y)(f,{to:ge.getExperimentChatSessionPageRoute(e,t),children:(0,k.Y)(C.Tag,{css:As,componentId:"mlflow.genai-traces-table.session",title:t,children:(0,k.Y)("span",{css:Cs,children:t})})}):(0,k.Y)(oe,{isComparing:s}),second:s&&(n?(0,k.Y)(f,{to:ge.getExperimentChatSessionPageRoute(e,n),children:(0,k.Y)(C.Tag,{css:Ts,componentId:"mlflow.genai-traces-table.session",title:n,children:(0,k.Y)("span",{css:Rs,children:n})})}):(0,k.Y)(oe,{isComparing:s}))})}if(t===V.Rl){const e=c?$s((0,F.Mq)(c)):"",t=u?$s((0,F.Mq)(u)):"";return(0,k.Y)(ae,{first:e?(0,k.Y)("div",{css:_s,title:e,children:e}):(0,k.Y)(oe,{isComparing:s}),second:s&&(t?(0,k.Y)("div",{css:ks,title:t,children:t}):(0,k.Y)(oe,{isComparing:s}))})}if(t===V.im)return(0,k.Y)(ve,{experimentId:e,currentTraceInfo:c,otherTraceInfo:u,isComparing:s});if(t===V.YO)return(0,k.Y)(Be,{currentTraceInfo:c,otherTraceInfo:u,isComparing:s});if(t.startsWith(V.rc)){var E,O;const e=(0,F.v8)(t);if(!e)return(0,k.Y)(oe,{isComparing:s});const n=null===c||void 0===c||null===(E=c.trace_metadata)||void 0===E?void 0:E[e],o=null===u||void 0===u||null===(O=u.trace_metadata)||void 0===O?void 0:O[e];return(0,k.Y)(ae,{first:n?(0,k.Y)("div",{css:Ns,title:n,children:n}):(0,k.Y)(oe,{isComparing:s}),second:s&&(o?(0,k.Y)("div",{css:Ms,title:o,children:o}):(0,k.Y)(oe,{isComparing:s}))})}if(t===V.tj){const e=e=>{var s;if(void 0===e)return;const t=parseFloat(e),o=null===e||void 0===e||null===(s=e.replace)||void 0===s?void 0:s.call(e,/[0-9.]/g,"").trim().toLowerCase();return(0,n.isNil)(t)||isNaN(t)?void 0:[t.toFixed(3).replace(/\.?0+$/,""),o].filter(Boolean).join("")},t=e(null===c||void 0===c?void 0:c[V.tj]),o=e(null===u||void 0===u?void 0:u[V.tj]);return(0,k.Y)(ae,{first:(0,n.isNil)(t)?(0,k.Y)(oe,{isComparing:s}):(0,k.Y)("div",{css:Es,title:t,children:t}),second:s&&((0,n.isNil)(o)?(0,k.Y)(oe,{isComparing:s}):(0,k.Y)("div",{css:Ds,title:o,children:o}))})}const H=c?(0,I.ng)(W(c,t)):"",$=u?(0,I.ng)(W(u,t)):"";return(0,k.Y)(ae,{first:H?(0,k.Y)("div",{css:Fs,title:H,children:H}):(0,k.Y)(oe,{isComparing:s}),second:s&&($?(0,k.Y)("div",{css:Os,title:$,children:$}):(0,k.Y)(oe,{isComparing:s}))})})(l,t,e.id,a,i,o,r)}};case $.$6.INTERNAL_MONITOR_REQUEST_TIME:return{...d,accessorFn:e=>{var s;return null===(s=e.currentRunValue)||void 0===s?void 0:s.requestTime},sortingFn:(s,t)=>{const n=s.getValue(e.id),o=t.getValue(e.id);return JSON.stringify(n).localeCompare(JSON.stringify(o))},size:100,minSize:100,cell:e=>{const s=e.getValue();if(!s)return null;const t=new Date(s);return(0,k.Y)(R.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-request-time",content:t.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,k.Y)("span",{children:(0,ns.Pt)(t)})})}};default:return d}};const Bs=m.memo((({rows:e,isComparing:s,enableRowSelection:t,virtualItems:n,virtualizerTotalSize:o,virtualizerMeasureElement:a,selectedColumns:l})=>(0,k.Y)("div",{style:{height:`${o}px`,position:"relative",display:"grid"},children:n.map((n=>{const o=e[n.index],i=o.original.currentRunValue&&!s;return(0,k.Y)("div",{"data-index":n.index,ref:e=>a(e),style:{position:"absolute",transform:`translate3d(0, ${n.start}px, 0)`,willChange:"transform",width:"100%"},children:(0,k.Y)(js,{row:o,exportableTrace:i,enableRowSelection:t,isSelected:t?o.getIsSelected():void 0,isComparing:s,selectedColumns:l})},n.key)}))}))),zs=m.memo(Bs);var Us={name:"1t0jp0z",styles:"display:flex;overflow:hidden;flex-shrink:0"};const js=m.memo((({row:e,exportableTrace:s,enableRowSelection:t,isComparing:n,isSelected:o,selectedColumns:a})=>{const l=e.getVisibleCells(),i=(0,_.tz)();return(0,k.Y)(k.FK,{children:(0,k.FD)(C.TableRow,{children:[(0,k.Y)("div",{css:Us,children:t&&(0,k.Y)(R.T,{componentId:"mlflow.experiment-evaluation-monitoring.evals-logs-table-cell-tooltip",content:n?i.formatMessage({id:"dqfOjO",defaultMessage:"You cannot select rows when comparing runs"}):s?null:i.formatMessage({id:"V0/LoE",defaultMessage:"This trace is not exportable because it either contains an error or the response is not a ChatCompletionResponse."}),children:(0,k.Y)(C.TableRowSelectCell,{componentId:"mlflow.experiment-evaluation-monitoring.evals-logs-table-cell",checked:o&&s,onChange:e.getToggleSelectedHandler(),isDisabled:n||!s})})}),l.map((e=>(0,k.Y)(Ps,{cell:e},e.id)))]})})})),Ps=m.memo((({cell:e})=>{const{theme:s}=(0,A.u)();return(0,k.Y)(C.TableCell,{style:{flex:`1 1 var(--col-${(0,ns.Mr)(e.column.id)}-size)`},css:(0,S.AH)({display:"flex",flexDirection:"row",alignItems:"center","> span:first-of-type":{padding:`${s.spacing.xs}px 0px`,width:"100%"}},""),children:(0,J.Kv)(e.column.columnDef.cell,e.getContext())},e.id)}));const qs=({overallAssessmentInfo:e,assessmentNameToAggregates:s,allAssessmentFilters:t,toggleAssessmentFilter:n,runUuid:o,compareToRunUuid:a})=>{const l=(0,_.tz)(),{theme:i}=(0,A.u)(),r=(0,m.useMemo)((()=>function(e,s,t,n,o,a,l){var i,r;if(Object.values(s).every((e=>0===e.currentNumRootCause&&0===(e.otherNumRootCause||0))))return[];const d=Object.values(s).filter((e=>e.currentNumRootCause>0||(e.otherNumRootCause||0)>0)).sort(((e,s)=>s.currentNumRootCause-e.currentNumRootCause)),c=Math.max((null===(i=d[0])||void 0===i?void 0:i.currentNumRootCause)||0,(null===(r=d[0])||void 0===r?void 0:r.otherNumRootCause)||0);return d.map((s=>{var i;const r=null===(i=I.yQ[s.assessmentInfo.name])||void 0===i?void 0:i[I.gZ.NO],d=r?e.formatMessage(r):s.assessmentInfo.name,u=s.currentCounts,m=(null===u||void 0===u?void 0:u.get(I.gZ.YES))||0,p=(null===u||void 0===u?void 0:u.get(I.gZ.NO))||0,g=(null===u||void 0===u?void 0:u.get(void 0))||0,v=s.currentNumRootCause,h=m+p+g,f=s.otherCounts;let y;if(void 0!==s.otherCounts){y=((null===f||void 0===f?void 0:f.get(I.gZ.YES))||0)+((null===f||void 0===f?void 0:f.get(I.gZ.NO))||0)+((null===f||void 0===f?void 0:f.get(void 0))||0)}const w=s.otherNumRootCause||0,b=v/h,x=w/(y||1),Y=(0,ns.$h)(b),S=(0,ns.$h)(x);return{assessment:s.assessmentInfo.name,title:d,currentInfo:{count:v,fraction:v/c,tooltip:e.formatMessage({id:"a6bpXQ",defaultMessage:'{numRootCause}/{numEvals} ({percentage}%) runs failed due to the {assessment} judge failing for the current run "{currentRun}".'},{numRootCause:v,numEvals:h,percentage:Y,assessment:s.assessmentInfo.name,currentRun:a}),toggleFilter:()=>n(s.assessmentInfo.name,"failing_root_cause","current"),isSelected:t.some((e=>"rca"===e.filterType&&"current"===e.run&&e.assessmentName===s.assessmentInfo.name)),percentage:Y},otherInfo:o?{count:w,fraction:w/c,tooltip:e.formatMessage({id:"iDqqcA",defaultMessage:'{numRootCause}/{numEvals} ({percentage}%) runs failed due to the {assessment} judge failing for run "{otherRunDisplayName}".'},{numRootCause:w,numEvals:y,percentage:S,assessment:s.assessmentInfo.name,otherRunDisplayName:l}),toggleFilter:()=>n(s.assessmentInfo.name,"rca","other"),isSelected:t.some((e=>"rca"===e.filterType&&"other"===e.run&&e.assessmentName===s.assessmentInfo.name)),percentage:S}:void 0,icon:(0,k.Y)(T.X,{})}}))}(l,s,t,n,Boolean(a),o,a)),[l,s,t,n,a,o]);return 0===r.length?(0,k.Y)(k.FK,{}):(0,k.FD)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",gap:i.spacing.sm},""),children:[(0,k.Y)("div",{css:(0,S.AH)({fontWeight:i.typography.typographyBoldFontWeight},""),children:l.formatMessage({id:"etvfuH",defaultMessage:"Root Cause Analysis"})}),(0,k.Y)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",gap:i.spacing.sm},""),children:(0,k.Y)(Ws,{overallAssessmentInfo:e,rcaData:r,run:"current",runColor:a?u.IX:void 0})}),a&&(0,k.Y)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",gap:i.spacing.xs},""),children:(0,k.Y)(Ws,{overallAssessmentInfo:e,rcaData:r,run:"other",runColor:u.OV})})]})};var Ks={name:"zjik7",styles:"display:flex"};const Ws=({rcaData:e,run:s,runColor:t,overallAssessmentInfo:n})=>{const{theme:o}=(0,A.u)();return(0,k.FD)("div",{css:(0,S.AH)({display:"flex",flexDirection:"row",gap:o.spacing.sm,alignItems:"center"},""),children:[t&&(0,k.Y)("div",{css:Ks,children:(0,k.Y)(ss,{color:t})}),(0,k.Y)("div",{css:(0,S.AH)({display:"flex",flexWrap:"wrap",gap:o.spacing.xs},""),children:e.map(((e,t)=>{const a="current"===s?e.currentInfo:e.otherInfo;if(!a)return(0,k.Y)(k.FK,{});const l=(0,u.x2)(o,n,{stringValue:"no"});return(0,k.Y)(R.T,{content:a.tooltip,componentId:"mlflow.evaluations_review.rca_pill",children:(0,k.Y)(k.FK,{children:(0,k.FD)("div",{style:{border:a.isSelected?`1px solid ${o.colors.grey400}`:""},css:(0,S.AH)({color:o.colors.textSecondary,borderRadius:o.general.borderRadiusBase,padding:`0 ${o.spacing.xs}px`,height:"20px",display:"flex",backgroundColor:a.isSelected?(0,I.fu)(l,1):(0,I.fu)(l,.5),gap:o.spacing.xs,fontSize:o.typography.fontSizeSm},""),children:[a.count,(0,k.Y)("div",{children:e.title.toLocaleLowerCase()})]},t)})},t)}))})]})};var Qs={name:"dao2zk",styles:"display:contents;& p{margin-bottom:0;}"};const Gs=({assessmentInfo:e,assessmentNameToAggregates:s,allAssessmentFilters:t,toggleAssessmentFilter:n,runUuid:a,compareToRunUuid:l})=>{var i,r;const{theme:d}=(0,A.u)(),c=(0,_.tz)();return(0,k.Y)(k.FK,{children:(0,k.FD)("div",{css:(0,S.AH)({maxWidth:"25rem",display:"flex",flexDirection:"column",overflowWrap:"break-word",wordBreak:"break-word",gap:d.spacing.sm},""),children:[(0,k.Y)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",gap:d.spacing.xs},""),children:(0,k.FD)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",gap:d.spacing.xs,paddingBottom:d.spacing.sm,borderBottom:`1px solid ${d.colors.border}`},""),children:[(0,k.FD)("div",{css:(0,S.AH)({display:"flex",gap:d.spacing.xs,alignItems:"center"},""),children:["numeric"===e.dtype?(0,k.Y)(C.NumbersIcon,{}):"boolean"===e.dtype?(0,k.Y)(C.BinaryIcon,{}):(0,k.Y)(k.FK,{}),(0,k.Y)(A.T.Title,{level:4,css:(0,S.AH)({marginBottom:0,marginRight:d.spacing.xs},""),children:e.displayName}),"AI_JUDGE"===(null===(i=e.source)||void 0===i?void 0:i.sourceType)&&(0,k.Y)(C.Tag,{color:"turquoise",componentId:"mlflow.experiment.evaluations.ai-judge-tag",children:(0,k.FD)("div",{css:(0,S.AH)({display:"flex",gap:d.spacing.xs},""),children:[(0,k.Y)(C.SparkleDoubleIcon,{css:(0,S.AH)({color:d.colors.textSecondary},"")}),(0,k.Y)(A.T.Hint,{children:c.formatMessage({id:"ov1whU",defaultMessage:"AI Judge"})})]})}),"HUMAN"===(null===(r=e.source)||void 0===r?void 0:r.sourceType)&&(0,k.Y)(C.Tag,{color:"coral",componentId:"mlflow.experiment.evaluations.human-judge-tag",children:(0,k.FD)("div",{css:(0,S.AH)({display:"flex",gap:d.spacing.xs},""),children:[(0,k.Y)(C.UserIcon,{}),(0,k.Y)(A.T.Hint,{children:c.formatMessage({id:"BdV0qk",defaultMessage:"Human judge"})})]})}),e.isCustomMetric&&(0,k.Y)(C.Tag,{color:"indigo",componentId:"mlflow.experiment.evaluations.ai-judge-tag",children:(0,k.FD)("div",{css:(0,S.AH)({display:"flex",gap:d.spacing.xs},""),children:[(0,k.Y)(A.T.Hint,{children:(0,k.Y)(C.BracketsXIcon,{})}),(0,k.Y)(A.T.Hint,{children:e.metricName})]})})]}),(0,k.Y)("div",{children:(0,k.Y)(A.T.Hint,{children:e.name})})]})}),(0,k.Y)("div",{children:(0,k.Y)("span",{css:Qs,children:e.description})}),e.name===o._1.OVERALL_ASSESSMENT&&a?(0,k.Y)("div",{children:(0,k.Y)(qs,{overallAssessmentInfo:e,assessmentNameToAggregates:s,allAssessmentFilters:t,toggleAssessmentFilter:n,runUuid:a,compareToRunUuid:l})}):(0,k.Y)(k.FK,{})]})})};var Js={name:"1yqwqbb",styles:"max-height:200px;overflow-y:auto;width:200px;min-width:200px"};const Zs=m.memo((({theme:e,intl:s,assessmentInfo:t,assessmentAggregates:n,allAssessmentFilters:o,toggleAssessmentFilter:a,currentRunDisplayName:l,compareToRunDisplayName:i})=>{const r=(0,m.useMemo)((()=>(0,ts.SA)(s,e,t,o,a,n,l,i)),[s,e,t,o,a,n,l,i]),d=(0,m.useMemo)((()=>"pass-fail"===t.dtype||"boolean"===t.dtype?r:r.map(((e,s)=>({...e,originalIndex:s}))).sort(((e,s)=>{const t="null"===e.name||e.name===ts.J,n="null"===s.name||s.name===ts.J;if(t&&!n)return 1;if(n&&!t)return-1;if(!t&&!n){var o,a;const t=((null===(o=s.current)||void 0===o?void 0:o.value)||0)-((null===(a=e.current)||void 0===a?void 0:a.value)||0);if(0!==t)return t}return e.originalIndex-s.originalIndex}))),[r,t]),c=d.length>4?d.slice(0,3):d,u=d.length>4?d.slice(3):[],p=u.length>0,g=e.colors.actionDefaultBackgroundHover,v=e.colors.actionDefaultBackgroundPress;return(0,k.Y)("table",{children:(0,k.FD)("tbody",{children:[c.map((s=>(0,k.Y)(st,{barData:s,theme:e,hoverBarColor:g,selectedBarColor:v,assessmentInfo:t},s.name))),p&&(0,k.Y)("tr",{children:(0,k.Y)("td",{colSpan:2,children:(0,k.FD)(A.aw.Root,{componentId:"categorical-aggregate-chart-more-items",children:[(0,k.Y)(A.aw.Trigger,{asChild:!0,children:(0,k.Y)("div",{css:(0,S.AH)({cursor:"pointer",padding:`${e.spacing.xs}px`,color:e.colors.actionLinkDefault,fontSize:e.typography.fontSizeSm,fontWeight:"normal",":hover":{backgroundColor:g},borderRadius:e.general.borderRadiusBase},""),children:s.formatMessage({id:"WELl8J",defaultMessage:"+{count} more"},{count:u.length})})}),(0,k.Y)(A.aw.Content,{align:"start",side:"bottom",css:Js,children:(0,k.Y)("table",{children:(0,k.Y)("tbody",{children:u.map((s=>(0,k.Y)(st,{barData:s,theme:e,hoverBarColor:g,selectedBarColor:v,assessmentInfo:t},s.name)))})})})]})})})]})})}));var Xs={name:"5m5bfc",styles:"display:flex;flex-direction:column;gap:2px;width:100%"},et={name:"12n4oo4",styles:"flex:1;width:100%;position:relative"};const st=({barData:e,theme:s,hoverBarColor:t,selectedBarColor:o,assessmentInfo:a})=>{const l=e.name===ts.J,i="null"===e.name;return l||i?(0,k.FD)("tr",{css:(0,S.AH)({cursor:e.name!==ts.J?"pointer":"not-allowed",":hover":{backgroundColor:t},color:e.name===ts.J?s.colors.textValidationWarning:s.colors.textSecondary,fontWeight:"normal",fontSize:s.typography.fontSizeSm},""),onClick:e.name!==ts.J?e.current.toggleFilter:void 0,children:[(0,k.Y)("td",{css:(0,S.AH)({width:"100%",borderTopLeftRadius:s.general.borderRadiusBase,borderBottomLeftRadius:s.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingLeft:s.spacing.xs,paddingTop:s.spacing.xs,paddingBottom:s.spacing.xs,fontStyle:e.name===ts.J?"normal":"italic"},""),children:(0,k.Y)("span",{css:(0,S.AH)({lineHeight:`${s.typography.fontSizeSm}px`},""),children:e.name})}),(0,k.Y)("td",{css:(0,S.AH)({textAlign:"right",verticalAlign:"center",borderTopRightRadius:s.general.borderRadiusBase,borderBottomRightRadius:s.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingRight:s.spacing.xs,paddingTop:s.spacing.xs,paddingBottom:s.spacing.xs,fontStyle:"normal"},""),children:(0,k.Y)("span",{css:(0,S.AH)({display:"inline-block",verticalAlign:"center",lineHeight:`${s.typography.fontSizeSm}px`},""),children:(0,n.isNil)(e.scoreChange)?e.current.value:(0,ns.n0)(a,e.scoreChange,!1)})})]},e.name):(0,k.FD)("tr",{css:(0,S.AH)({cursor:"pointer",":hover":{backgroundColor:t}},""),onClick:e.current.toggleFilter,children:[(0,k.Y)("td",{css:(0,S.AH)({width:"100%",borderTopLeftRadius:s.general.borderRadiusBase,borderBottomLeftRadius:s.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingLeft:s.spacing.xs,paddingTop:s.spacing.xs,paddingBottom:s.spacing.xs},""),children:(0,k.FD)("div",{css:Xs,children:[(0,k.Y)("span",{css:(0,S.AH)({fontWeight:"normal",fontSize:"10px",lineHeight:"10px",color:s.colors.textSecondary},""),children:e.name}),(0,k.Y)("div",{css:et,children:(0,k.Y)("div",{style:{width:e.current.value>0?100*e.current.fraction+"%":"2px",borderRadius:"2px"},css:(0,S.AH)({position:"relative",flexShrink:1,transition:"width 0.3s",backgroundColor:e.backgroundColor,height:"10px",display:"flex",alignItems:"center"},"")})})]})}),(0,k.Y)("td",{css:(0,S.AH)({textAlign:"right",verticalAlign:"bottom",borderTopRightRadius:s.general.borderRadiusBase,borderBottomRightRadius:s.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingRight:s.spacing.xs,paddingTop:s.spacing.xs,paddingBottom:s.spacing.xs},""),children:(0,k.Y)("span",{css:(0,S.AH)({color:s.colors.textSecondary,fontWeight:"normal",fontSize:s.typography.fontSizeSm,display:"inline-block",verticalAlign:"bottom",lineHeight:`${s.typography.fontSizeSm}px`},""),children:(0,n.isNil)(e.scoreChange)?(0,ns.vw)(a,e.current.fraction):(0,ns.n0)(a,e.scoreChange)})})]},e.name)};var tt={name:"1fttcpj",styles:"display:flex;flex-direction:column"},nt={name:"1a4tfjy",styles:"display:flex;justify-content:center;flex-direction:row"},ot={name:"1fttcpj",styles:"display:flex;flex-direction:column"},at={name:"ho1qnd",styles:"display:flex;flex-direction:row"},lt={name:"18ubt2d",styles:"width:25%"},it={name:"ho1qnd",styles:"display:flex;flex-direction:row"},rt={name:"18ubt2d",styles:"width:25%"};const dt=m.memo((({numericAggregate:e})=>{const{theme:s}=(0,A.u)(),t=(0,_.tz)();return(0,k.FD)("div",{css:tt,children:[(0,k.Y)("div",{css:nt,children:e.counts.map(((n,o)=>(0,k.Y)(C.HoverCard,{content:(0,k.FD)("div",{css:ot,children:[(0,k.FD)("div",{css:at,children:[(0,k.Y)("div",{css:lt,children:(0,k.Y)(A.T.Text,{children:t.formatMessage({id:"kAVQ2/",defaultMessage:"Range"})})}),(0,k.Y)("div",{children:(0,k.Y)(A.T.Text,{color:"secondary",children:(0,ns.BM)(n.lower,2)===(0,ns.BM)(n.upper,2)?(0,ns.BM)(n.lower,2):`${(0,ns.BM)(n.lower,2)} - ${(0,ns.BM)(n.upper,2)}`})})]}),(0,k.FD)("div",{css:it,children:[(0,k.Y)("div",{css:rt,children:(0,k.Y)(A.T.Text,{children:t.formatMessage({id:"ClYb2e",defaultMessage:"Count"})})}),(0,k.Y)("div",{children:(0,k.Y)(A.T.Text,{color:"secondary",children:n.count})})]})]}),trigger:(0,k.Y)("div",{css:(0,S.AH)({display:"flex",flex:1,flexDirection:"column-reverse",height:"60px",width:"10px",":hover":{backgroundColor:s.colors.actionDefaultBackgroundHover}},""),children:(0,k.Y)("div",{css:(0,S.AH)({height:n.count/e.maxCount*100+"%",minHeight:"1px",width:"80%",verticalAlign:"bottom",backgroundColor:s.colors.blue400,borderTopRightRadius:s.general.borderRadiusBase,borderTopLeftRadius:s.general.borderRadiusBase},"")})},"bar-"+o)},"hover-card-"+o)))}),e.min===e.max?(0,k.Y)("div",{css:(0,S.AH)({display:"flex",justifyContent:"center",flexDirection:"row",fontWeight:"normal",fontSize:s.typography.fontSizeSm,color:s.colors.textSecondary},""),children:(0,ns.BM)(e.min,2)}):(0,k.FD)("div",{css:(0,S.AH)({display:"flex",justifyContent:"space-between",flexDirection:"row",fontWeight:"normal",fontSize:s.typography.fontSizeSm,color:s.colors.textSecondary},""),children:[(0,k.Y)("div",{children:(0,ns.BM)(e.min,2)}),(0,k.Y)("div",{children:(0,ns.BM)(e.max,2)})]})]})})),ct=m.memo((({theme:e,intl:s,assessmentInfo:t,assessmentAggregates:o,allAssessmentFilters:a,toggleAssessmentFilter:l,currentRunDisplayName:i,compareToRunDisplayName:r,collapsedHeader:d})=>{const c=(0,m.useMemo)((()=>"pass-fail"===t.dtype?s.formatMessage({id:"Yd5ANL",defaultMessage:"PASS"}):"boolean"===t.dtype?s.formatMessage({id:"icBP3T",defaultMessage:"TRUE"}):"string"===t.dtype?s.formatMessage({id:"Jdr//R",defaultMessage:"STRING"}):"numeric"===t.dtype?s.formatMessage({id:"wDFPtr",defaultMessage:"AVG"}):void 0),[t,s]),{displayScore:p,displayScoreChange:g,changeDirection:v}=(0,m.useMemo)((()=>(0,ns.p$)(s,t,o)),[s,t,o]);return"unknown"===t.dtype?null:(0,k.FD)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm},""),children:[(0,k.FD)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",paddingTop:e.spacing.xs},""),children:[(0,k.Y)("div",{css:(0,S.AH)({fontWeight:400,fontSize:"10px",color:e.colors.textPlaceholder},""),children:c}),(0,k.FD)("div",{css:(0,S.AH)({display:"flex",gap:e.spacing.xs},""),children:[(0,k.Y)("div",{css:(0,S.AH)({fontSize:e.typography.fontSizeLg,color:e.colors.textPrimary,fontWeight:e.typography.typographyBoldFontWeight},""),children:p}),!(0,n.isNil)(g)&&r&&(0,k.Y)("div",{css:(0,S.AH)({display:"flex",alignItems:"center",height:"20px",gap:e.spacing.xs,padding:`2px ${e.spacing.xs}px`,fontSize:e.typography.fontSizeMd,fontWeight:"normal",borderRadius:e.general.borderRadiusBase,color:u.G8,backgroundColor:"none"===v?"":"up"===v?u.YH.up:"down"===v?u.YH.down:(0,I.fu)(e.colors.textSecondary,.1)},""),children:g})]})]}),!d&&((0,n.isNil)(o.currentNumericAggregate)?(0,k.Y)(Zs,{theme:e,intl:s,assessmentInfo:t,assessmentAggregates:o,allAssessmentFilters:a,toggleAssessmentFilter:l,currentRunDisplayName:i,compareToRunDisplayName:r}):(0,k.Y)(dt,{numericAggregate:o.currentNumericAggregate}))]})}));var ut={name:"10sid5d",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;word-break:normal;overflow-wrap:normal"},mt={name:"190se29",styles:"padding-top:0px !important;position:absolute;left:0;right:0;bottom:0;z-index:101;padding:0;pointer-events:none"},pt={name:"14n7h35",styles:"position:absolute;left:50%;top:100%;transform:translate(-50%, -50%);z-index:102;display:flex;align-items:center;justify-content:center;width:22px;height:22px;pointer-events:auto;cursor:pointer"};const gt=m.memo((({enableRowSelection:e,enableGrouping:s,selectedAssessmentInfos:t,assessmentNameToAggregates:o,assessmentFilters:a,toggleAssessmentFilter:l,runDisplayName:i,compareToRunUuid:r,compareToRunDisplayName:d,disableAssessmentTooltips:c,collapsedHeader:u,setCollapsedHeader:p,isComparing:g,headerGroups:v,allRowSelected:h,someRowSelected:f,toggleAllRowsSelectedHandler:y,setColumnSizing:w})=>{const{theme:b}=(0,A.u)(),x=(0,_.tz)(),[I,Y]=(0,m.useState)(!1),T=s?{position:"relative","&::before":{content:'""',position:"absolute",top:"32px",left:0,right:0,borderTop:`1px solid ${b.colors.border}`}}:{};return(0,k.Y)(k.FK,{children:v.map(((m,A)=>(0,k.FD)(C.TableRow,{isHeader:!0,css:(0,S.AH)({position:"sticky",top:40*A,zIndex:100,...s&&{"& > *":{borderBottom:0===A?"none":void 0}},...A===v.length-1&&{borderBottom:`1px solid ${I?b.colors.blue500:b.colors.border}`,transition:"border-color 0.2s","& > *":{borderBottom:"none"}}},""),children:[e&&(0,k.Y)("div",{css:0===t.length&&1===A?{}:T,children:(0,k.Y)(C.TableRowSelectCell,{componentId:"mlflow.experiment-evaluation-monitoring.evals-logs-table-header-select-cell",checked:h,indeterminate:f,onChange:y(),checkboxLabel:x.formatMessage({id:"bO1IlR",defaultMessage:"Select all"}),noCheckbox:0===A,isDisabled:g})}),m.headers.map((e=>{if(e.isPlaceholder)return null;const m=t.find((s=>(0,V.A5)(s.name)===e.id)),p=e.isPlaceholder?null:(0,k.Y)("div",{css:ut,title:String((0,J.Kv)(e.column.columnDef.header,e.getContext())),children:(0,J.Kv)(e.column.columnDef.header,e.getContext())}),g=m&&!c?(0,k.Y)(C.HoverCard,{content:(0,k.Y)(k.FK,{children:(0,k.Y)(Gs,{assessmentInfo:m,assessmentNameToAggregates:o,allAssessmentFilters:a,toggleAssessmentFilter:l,runUuid:i,compareToRunUuid:r?d:void 0})}),trigger:p},e.id):(0,n.isNil)(p)?null:p;return(0,k.Y)(C.TableHeader,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_evaluationsoverview.tsx_576",css:(0,S.AH)({"> span:first-of-type":{width:"100%",height:"100%",marginTop:"auto",marginBottom:"auto"},...0===t.length&&1===A?{}:T},""),style:{flex:`${e.colSpan} 1 var(--header-${(0,ns.Mr)(null===e||void 0===e?void 0:e.column.id)}-size)`},header:e,column:e.column,setColumnSizing:w,children:(0,k.FD)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",gap:b.spacing.xs},""),children:[g,(0,k.Y)("div",{css:(0,S.AH)({borderTop:!s&&t.length>0?`1px solid ${b.colors.border}`:"",width:"100%"},""),children:m&&(0,k.Y)(ct,{theme:b,intl:x,assessmentInfo:m,assessmentAggregates:o[m.name],allAssessmentFilters:a,toggleAssessmentFilter:l,currentRunDisplayName:i,compareToRunDisplayName:r?d:void 0,collapsedHeader:u})})]})},e.column.id)})),A===v.length-1&&(0,k.FD)("div",{css:mt,children:[(0,k.Y)("div",{css:(0,S.AH)({position:"absolute",left:"50%",top:"100%",width:"24px",height:"12px",background:b.colors.backgroundPrimary,transform:"translate(-50%, -50%)",zIndex:101},"")}),(0,k.Y)("div",{css:pt,onClick:()=>p(!u),onMouseEnter:()=>Y(!0),onMouseLeave:()=>Y(!1),children:(0,k.Y)("div",{css:(0,S.AH)({width:"22px",height:"22px",borderRadius:"50%",background:b.colors.backgroundPrimary,border:`2px solid ${b.colors.border}`,boxShadow:"0 2px 8px 0 rgba(0,0,0,0.10)",display:"flex",alignItems:"center",justifyContent:"center",transition:"border-color 0.2s, box-shadow 0.2s",":hover":{borderColor:b.colors.blue500,boxShadow:"0 2px 12px 0 rgba(0,0,0,0.18)"},opacity:I?1:.5},""),children:(0,k.Y)(C.ChevronDownIcon,{css:(0,S.AH)({transform:u?"none":"rotate(180deg)",transition:"transform 0.2s, opacity 0.2s",color:b.colors.textSecondary},"")})})})]})]},m.id)))})})),vt=e=>{const{theme:s}=(0,A.u)(),t=(0,_.tz)(),{groupId:n,visibleCount:o,totalCount:a,enableGrouping:l}=e.column.columnDef.meta;if(!l)return $.RF[n];const i=$.RF[n];return(0,k.FD)("div",{css:(0,S.AH)({height:"100%",width:"100%",display:"flex",overflow:"hidden",gap:s.spacing.sm},""),children:[(0,k.Y)("div",{children:i}),n===$.w8.INFO?null:o===a?(0,k.FD)("div",{css:(0,S.AH)({color:s.colors.textSecondary,fontWeight:"normal"},""),children:["(",o,"/",a,")"]}):(0,k.Y)(C.HoverCard,{trigger:(0,k.FD)("div",{css:(0,S.AH)({color:s.colors.textSecondary,":hover":{textDecoration:"underline"},fontWeight:"normal"},""),children:["(",o,"/",a,")"]}),content:t.formatMessage({id:"pDCDkJ",defaultMessage:"Showing {visibleCount} out of {totalCount} {groupName}. Select columns to view more."},{visibleCount:o,totalCount:a,groupName:i}),align:"start"})]})};var ht=t(38086);var ft={name:"49aokf",styles:"display:contents"};const yt=({history:e,alwaysExpanded:s=!1})=>{const{theme:t}=(0,A.u)(),o=(0,_.tz)(),[a,l]=(0,m.useState)(new Date);(0,m.useEffect)((()=>{const e=setInterval((()=>{l(new Date)}),5e3);return()=>{clearInterval(e)}}),[]);const i=(0,m.useMemo)((()=>e.reduce(((s,t,n)=>{const o=e[n+1];return o?[...s,[t,o]]:s}),[])),[e]),{makeHTML:r}=(0,ht.N)(),d=(0,m.useMemo)((()=>{var s;const t=null===(s=(0,n.first)(e))||void 0===s?void 0:s.rationale;return(0,n.isString)(t)?r(t):null}),[e,r]);var c,u,p;if(!i.length)return null!==(c=(0,n.first)(e))&&void 0!==c&&c.rationale?(0,k.Y)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:(0,k.Y)("span",{css:ft,dangerouslySetInnerHTML:{__html:null!==d&&void 0!==d?d:""}})}):null!==(u=(0,n.first)(e))&&void 0!==u&&u.errorMessage?(0,k.Y)(k.FK,{children:(0,k.Y)(A.T.Text,{color:"error",children:null===(p=(0,n.first)(e))||void 0===p?void 0:p.errorMessage})}):(0,k.Y)(k.FK,{children:!s&&(0,k.FD)("div",{children:[(0,k.Y)(R.S,{size:"sm"}),(0,k.Y)(A.T.Hint,{children:(0,k.Y)(_.sA,{id:"Jj2kRy",defaultMessage:"No details for assessment"})})]})});const g=e=>{const s=(0,I.Zh)(e),t=I.yQ[e.name];if(t&&!(0,n.isNil)(s)){var o;const e=null!==(o=t[s.toString()])&&void 0!==o?o:t.default;if(e)return(0,k.Y)(_.sA,{...e,values:{value:s}})}return s};return(0,k.FD)(k.FK,{children:[(0,k.Y)(R.S,{size:"sm"}),i.map((([e,n],l)=>{var i,r;const d=g(n),c=g(e),u=d===c,m=(0,I.CH)(e)?o.formatMessage({id:"rmAWZX",defaultMessage:"just now"}):(0,ns.Pt)(e.timestamp,a);return(0,k.FD)("div",{css:(0,S.AH)({marginBottom:s?void 0:t.spacing.md},""),children:[(0,k.FD)(A.T.Hint,{css:(0,S.AH)({marginBottom:t.spacing.xs},""),children:[d&&c&&(0,k.FD)(k.FK,{children:[(0,k.Y)("code",{children:g(n)})," \u2192 ",(0,k.Y)("code",{children:g(e)})," "]}),u?(0,k.Y)(_.sA,{id:"2/B9Zg",defaultMessage:"added {when} by {user}",values:{when:m,user:null===(i=e.source)||void 0===i?void 0:i.sourceId}}):(0,k.Y)(_.sA,{id:"4TDvGX",defaultMessage:"edited {when} by {user}",values:{when:m,user:null===(r=e.source)||void 0===r?void 0:r.sourceId}})]}),e.rationale&&(0,k.Y)(A.T.Text,{children:e.rationale})]},`${e.timestamp}-${l}`)}))]})},wt=({assessmentHistory:e,children:s,disable:t=!1})=>{const o=(0,_.tz)(),a=(0,m.useMemo)((()=>e.some(I.hG)),[e]),[l,i]=(0,m.useState)(new Date);(0,m.useEffect)((()=>{const e=setInterval((()=>{i(new Date)}),5e3);return()=>{clearInterval(e)}}),[]);return(0,k.Y)(R.T,{componentId:"web-shared.genai-traces-table.evaluations-review-assessment.tooltip",content:t?void 0:(0,k.Y)("span",{children:(()=>{const s=(0,n.first)(e);if(!s)return;if((0,I.w_)(s)){var t,i;const n=e[1],a=n?null===(t=(0,I.Zh)(n))||void 0===t?void 0:t.toString():void 0,c=(0,I.CH)(s)?o.formatMessage({id:"rmAWZX",defaultMessage:"just now"}):(0,ns.Pt)(s.timestamp,l);if(a){var r,d;const e=null===(r=I.yQ[s.name])||void 0===r?void 0:r[a],t=e?o.formatMessage(e):a;return(0,k.Y)(_.sA,{id:"kHN/4I",defaultMessage:"Edited {timeSince} by {source}. Original value: {value}",values:{timeSince:c,source:null===s||void 0===s||null===(d=s.source)||void 0===d?void 0:d.sourceId,value:t}})}return(0,k.Y)(_.sA,{id:"m8ztHR",defaultMessage:"Edited {timeSince} by {source}.",values:{timeSince:c,source:null===s||void 0===s||null===(i=s.source)||void 0===i?void 0:i.sourceId}})}return a?(0,k.Y)(_.sA,{id:"4uE8hl",defaultMessage:"Overall assessment added by LLM-as-a-judge"}):null!==s&&void 0!==s&&s.errorMessage?null===s||void 0===s?void 0:s.errorMessage:(0,k.Y)(_.sA,{id:"gn1eO9",defaultMessage:"Assessment added by LLM-as-a-judge"})})()}),side:"top",children:s})},bt=({editedAssessment:e,valueSuggestions:s,onSave:t,onCancel:n,readOnly:o=!1})=>{var a;const{theme:l}=(0,A.u)(),i=(0,_.tz)(),[r,d]=(0,m.useState)((()=>(null===e||void 0===e?void 0:e.rationale)||void 0)),[c,u]=(0,m.useState)(""),[p,g]=(0,m.useState)((()=>{if(e){var t;const o=null===(t=(0,I.Zh)(e))||void 0===t?void 0:t.toString();var n;return o?null!==(n=s.find((e=>e.key===o)))&&void 0!==n?n:{key:o,label:o}:{key:e.name,label:e.name}}return{key:"",label:""}})),[v,h]=(0,m.useState)(!1),f=(0,m.useMemo)((()=>s.filter((e=>e.label.toLowerCase().includes(c.toLowerCase())))),[c,s]),y=v?s:f,w=c||y.length>0,b=(0,C.useComboboxState)({componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentupsertform.tsx_124",allItems:s,items:y,setItems:()=>{},setInputValue:e=>{h(!1),u(e)},multiSelect:!1,allowNewValue:!0,itemToString:e=>e?e.label:"",formValue:p,initialSelectedItem:p,initialInputValue:null!==(a=null===p||void 0===p?void 0:p.label)&&void 0!==a?a:"",formOnChange:e=>{(null===p||void 0===p?void 0:p.label)!==e&&g("string"!==typeof e?e:{key:null!==c&&void 0!==c?c:"",label:null!==c&&void 0!==c?c:""})},onIsOpenChange(e){e&&h(!0)}}),x=i.formatMessage({id:"bCdY2j",defaultMessage:'Add "{label}"'},{label:c});return(0,k.FD)("div",{children:[(0,k.FD)(C.TypeaheadComboboxRoot,{comboboxState:b,children:[(0,k.Y)(C.TypeaheadComboboxInput,{readOnly:o,css:(0,S.AH)({width:300,backgroundColor:l.colors.backgroundPrimary},""),placeholder:i.formatMessage({id:"nxzK82",defaultMessage:"Select or type an assessment"}),onKeyUp:e=>{-1===b.highlightedIndex&&"Enter"===e.key&&b.closeMenu()},comboboxState:b,formOnChange:e=>{g(e)}}),w&&(0,k.Y)(C.TypeaheadComboboxMenu,{comboboxState:b,emptyText:x,matchTriggerWidth:!0,children:y.map(((e,s)=>(0,k.Y)(C.TypeaheadComboboxMenuItem,{item:e,index:s,comboboxState:b,isDisabled:(null===e||void 0===e?void 0:e.disabled)||!1,children:e.label},`${e.key}-${s}`)))})]}),(0,k.Y)(R.S,{size:"sm"}),(0,k.Y)("div",{css:(0,S.AH)({backgroundColor:l.colors.backgroundPrimary,borderRadius:l.general.borderRadiusBase},""),children:(0,k.Y)(T.I.TextArea,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentupsertform.tsx_160",autoSize:!0,value:null!==r&&void 0!==r?r:"",onChange:e=>d(e.target.value),placeholder:i.formatMessage({id:"r/mP0/",defaultMessage:"Add rationale (optional)"})})}),(0,k.Y)(R.S,{size:"sm"}),(0,k.FD)("div",{css:(0,S.AH)({display:"flex",gap:l.spacing.xs},""),children:[(0,k.Y)(A.B,{size:"small",type:"primary",componentId:"mlflow.evaluations_review.confirm_edited_assessment_button",onClick:()=>{var s,n;if(!p)return;const o=null!==(s=null!==(n=p.rootAssessmentName)&&void 0!==n?n:null===e||void 0===e?void 0:e.name)&&void 0!==s?s:p.key,a=o===p.key||p.key;t({value:a,rationale:r,assessmentName:o})},disabled:!(null!==p&&void 0!==p&&p.key),children:(0,k.Y)(_.sA,{id:"/k6j6v",defaultMessage:"Confirm"})}),(0,k.Y)(A.B,{size:"small",type:"tertiary",componentId:"mlflow.evaluations_review.cancel_edited_assessment_button",onClick:n,children:(0,k.Y)(_.sA,{id:"5e1r3Y",defaultMessage:"Cancel"})})]})]})},xt=(e,s)=>{const t=(0,_.tz)(),[n,o]=(0,m.useState)(void 0),[a,l]=(0,m.useState)(!1),[i,r]=(0,m.useState)([]),d=(0,m.useCallback)(((n,a)=>{o(a),l(n),r((0,I.rU)(t,a,e,s))}),[t,s,e]),c=(0,m.useCallback)((e=>d(!0,e)),[d]);return{suggestions:i,editingAssessment:n,showUpsertForm:a,addAssessment:(0,m.useCallback)((()=>d(!0,void 0)),[d]),editAssessment:c,closeForm:(0,m.useCallback)((()=>{o(void 0),l(!1)}),[])}};var It={name:"49aokf",styles:"display:contents"};const Yt=({assessmentsType:e,assessmentName:s,assessmentHistory:t,rootCauseAssessment:o,onUpsertAssessment:a,allowEditing:l=!1,options:i,inputs:r,assessmentInfo:d,assessmentInfos:c})=>{const{theme:u}=(0,A.u)(),p=(0,_.tz)(),g="overall"===e,{suggestions:v,editingAssessment:h,showUpsertForm:f,editAssessment:y,closeForm:w}=xt(t,c);(0,m.useEffect)((()=>{w()}),[r,w]);const b=(0,n.first)(t),x=I.c9[s],Y=x?p.formatMessage(x):s,T=Boolean(b&&(0,I.Zh)(b)),R=Boolean(b&&(0,I.CH)(b)),N=l&&(T||R),{makeHTML:M}=(0,ht.N)(),E=(0,m.useMemo)((()=>{var e;const s=null===b||void 0===b||null===(e=b.rootCauseAssessment)||void 0===e?void 0:e.suggestedActions;return(0,n.isString)(s)?M(s):null}),[b,M]);return(0,k.FD)("div",{css:(0,S.AH)({display:"block",marginBottom:g?void 0:u.spacing.md},""),children:[!f&&(0,k.FD)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm},""),children:[s!==I._1.OVERALL_ASSESSMENT&&(0,k.Y)("div",{css:(0,S.AH)({display:"flex",gap:u.spacing.sm,alignItems:"center"},""),children:(0,k.Y)(Ze.m,{assessment:b,"aria-label":Y,disableJudgeTypeIcon:(0,I.xO)(b),onEdit:N?()=>{const e=(0,n.first)(t);e&&y(e)}:void 0,assessmentInfo:d,type:"assessment-value"})}),(0,k.Y)(yt,{history:t,alwaysExpanded:g}),o&&(0,k.FD)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm,marginTop:u.spacing.xs},""),children:[(0,k.FD)("div",{css:(0,S.AH)({display:"flex",gap:u.spacing.sm,alignItems:"center"},""),children:[(0,k.Y)(C.BugIcon,{color:"danger"}),(0,k.Y)(A.T.Text,{bold:!0,children:(0,k.Y)(_.sA,{id:"M8pHqP",defaultMessage:"Root cause failure:"})}),(0,k.Y)(Ze.m,{assessment:o,isRootCauseAssessment:!0,"aria-label":Y,assessmentInfo:d,type:"assessment-value"})]}),(0,k.Y)(yt,{history:[o],alwaysExpanded:g}),E&&(0,k.FD)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm},""),children:[(0,k.FD)("div",{css:(0,S.AH)({display:"flex",gap:u.spacing.sm,alignItems:"center"},""),children:[(0,k.Y)(C.AssistantIcon,{color:"ai"}),(0,k.Y)(A.T.Text,{bold:!0,children:(0,k.Y)(_.sA,{id:"vCUglz",defaultMessage:"Suggested actions"})})]}),(0,k.Y)("span",{css:It,dangerouslySetInnerHTML:{__html:E}})]})]})]}),f&&(0,k.Y)(k.FK,{children:(0,k.Y)(bt,{editedAssessment:h,valueSuggestions:v,onCancel:w,onSave:({value:e,rationale:s,assessmentName:t})=>{var n;const o=g?I._1.OVERALL_ASSESSMENT:"",l=(0,I.aj)({name:null!==(n=null!==t&&void 0!==t?t:null===h||void 0===h?void 0:h.name)&&void 0!==n?n:o,isOverallAssessment:g,value:e,rationale:s});a(l),w()}},null===h||void 0===h?void 0:h.name)})]},s)};var St={name:"eivff4",styles:"display:none"};const At=({assessmentsType:e,assessmentsByName:s,rootCauseAssessment:t,onUpsertAssessment:n,allowEditing:o=!1,allowMoreThanOne:a=!1,options:l,inputs:i,assessmentInfos:r})=>{const{theme:d}=(0,A.u)(),c="overall"===e,u=s.filter((([e,s])=>s.length>0)),{suggestions:p,editingAssessment:g,showUpsertForm:v,addAssessment:h,closeForm:f}=xt(u.flatMap((([e,s])=>s)),r);(0,m.useEffect)((()=>{f()}),[i,f]);const y=Object.keys(u).length>0,w=o&&(a||!y);return(0,k.FD)(k.FK,{children:[(0,k.FD)("div",{css:(0,S.AH)({display:"block",flexWrap:"wrap",gap:d.spacing.xs},""),children:[u.map((([s,a])=>{const d=r.find((e=>e.name===s));return d?(0,k.Y)(Yt,{assessmentsType:e,assessmentName:s,assessmentHistory:a,rootCauseAssessment:t,onUpsertAssessment:n,allowEditing:o,options:l,inputs:i,assessmentInfo:d,assessmentInfos:r},s):(0,k.Y)("div",{css:St},s)})),w&&(0,k.Y)(A.B,{componentId:`mlflow.evaluations_review.add_assessment_${e}_button`,onClick:h,icon:(0,k.Y)(C.PlusIcon,{}),size:"small",children:(0,k.Y)(_.sA,{id:"vgfy8y",defaultMessage:"Add assessment"})})]}),v&&(0,k.FD)(k.FK,{children:[(0,k.Y)(R.S,{size:"sm"}),(0,k.Y)(bt,{valueSuggestions:p,onCancel:f,onSave:({value:e,rationale:s,assessmentName:t})=>{var o;const a=c?I._1.OVERALL_ASSESSMENT:t||"",l=(0,I.aj)({name:null!==(o=null!==t&&void 0!==t?t:null===g||void 0===g?void 0:g.name)&&void 0!==o?o:a,isOverallAssessment:c,value:e,rationale:s});n(l),f()}})]})]})};var Ct={name:"49aokf",styles:"display:contents"};const Tt=({assessmentsType:e,assessmentsByName:s,onUpsertAssessment:t,allowEditing:o=!1,allowMoreThanOne:a=!1,options:l,inputs:i,assessmentInfos:r})=>{const{theme:d}=(0,A.u)(),c=(0,_.tz)(),u="overall"===e,{suggestions:p,editingAssessment:g,showUpsertForm:v,addAssessment:h,editAssessment:f,closeForm:y}=xt(s.flatMap((([e,s])=>s)),r);(0,m.useEffect)((()=>{y()}),[i,y]);const w=s.filter((([e,s])=>s.length>0)),b=Object.keys(w).length>0,x=o&&(a||!b);return(0,k.FD)(k.FK,{children:[(0,k.FD)("div",{css:(0,S.AH)({display:"flex",flexWrap:"wrap",gap:d.spacing.xs,alignItems:"center"},""),children:[w.map((([e,s])=>{const t=(0,n.first)(s),a=r.find((s=>s.name===e));if(!a)return(0,k.Y)(k.FK,{});const l=I.c9[e],i=l?c.formatMessage(l):e,d=Boolean(t&&(0,I.Zh)(t)),u=Boolean(t&&(0,I.CH)(t)),m=o&&(d||u)&&a.isEditable;return(0,k.Y)("div",{css:Ct,children:(0,k.Y)(wt,{assessmentHistory:s,children:(0,k.Y)(Ze.m,{assessment:t,"aria-label":i,active:(null===g||void 0===g?void 0:g.name)===e&&v,disableJudgeTypeIcon:(0,I.xO)(t),onEdit:m?()=>{const e=(0,n.first)(s);e&&f(e)}:void 0,assessmentInfo:a,type:"assessment-value"})})},e)})),x&&(0,k.Y)(A.B,{componentId:`mlflow.evaluations_review.add_assessment_${e}_button`,onClick:h,icon:(0,k.Y)(C.PlusIcon,{}),size:"small",children:(0,k.Y)(_.sA,{id:"vgfy8y",defaultMessage:"Add assessment"})})]}),v&&(0,k.FD)(k.FK,{children:[(0,k.Y)(R.S,{size:"sm"}),(0,k.Y)(bt,{editedAssessment:g,valueSuggestions:p,onCancel:y,onSave:({value:e,rationale:s,assessmentName:n})=>{var o;const a=u?I._1.OVERALL_ASSESSMENT:n||"",l=(0,I.aj)({name:null!==(o=null!==n&&void 0!==n?n:null===g||void 0===g?void 0:g.name)&&void 0!==o?o:a,isOverallAssessment:u,value:e,rationale:s});t(l),y()}},null===g||void 0===g?void 0:g.name)]})]})},Rt=({assessmentsType:e,assessmentsByName:s,rootCauseAssessment:t,onUpsertAssessment:n,allowEditing:o=!1,allowMoreThanOne:a=!1,alwaysExpanded:l=!1,options:i,inputs:r,assessmentInfos:d})=>{const[c,u]=(0,m.useState)(!1),p=l||c,g=s.filter((([e,s])=>s.length>0));let v=s;"overall"!==e&&(v=s.filter((([e,s])=>e!==I._1.OVERALL_ASSESSMENT)));const h=Object.keys(g).length>0;return(0,k.FD)(k.FK,{children:[p&&(0,k.Y)(At,{assessmentsType:e,assessmentsByName:v,rootCauseAssessment:t,onUpsertAssessment:n,allowEditing:o,allowMoreThanOne:a,options:i,inputs:r,assessmentInfos:d}),!p&&(0,k.Y)(Tt,{assessmentsType:e,assessmentsByName:v,onUpsertAssessment:n,allowEditing:o,allowMoreThanOne:a,options:i,inputs:r,assessmentInfos:d}),h&&!l&&(0,k.FD)(k.FK,{children:[(0,k.Y)(R.S,{size:"sm"}),(0,k.Y)(A.B,{size:"small",type:"tertiary",componentId:`mlflow.evaluations_review.see_assessment_details_${e}_button`,icon:p?(0,k.Y)(C.ChevronUpIcon,{}):(0,k.Y)(A.o,{}),onClick:()=>u((e=>!e)),children:p?(0,k.Y)(_.sA,{id:"G7V4y3",defaultMessage:"Hide details"}):(0,k.Y)(_.sA,{id:"pfyUes",defaultMessage:"See details"})})]})]})},_t=({toBeReviewed:e,containsOverallAssessment:s,isNextResultAvailable:t,overridingExistingReview:n,hasPendingAssessments:o,onClickNext:a,onSave:l,onCancelOverride:i})=>e?o?(0,k.Y)(A.B,{type:"primary",componentId:"mlflow.evaluations_review.save_pending_assessments_button",onClick:l,children:(0,k.Y)(_.sA,{id:"m1Nb7W",defaultMessage:"Save"})}):n?(0,k.Y)(A.B,{componentId:"mlflow.evaluations_review.cancel_override_assessments_button",onClick:i,children:(0,k.Y)(_.sA,{id:"e9qVjz",defaultMessage:"Cancel"})}):(0,k.Y)(A.B,{type:"primary",componentId:"mlflow.evaluations_review.mark_as_reviewed_button",onClick:l,disabled:!s,children:(0,k.Y)(_.sA,{id:"Ls2ris",defaultMessage:"Mark as reviewed"})}):(0,k.Y)(A.B,{type:"primary",componentId:"mlflow.evaluations_review.next_evaluation_result_button",onClick:a,endIcon:(0,k.Y)(A.o,{}),disabled:!t,children:(0,k.Y)(_.sA,{id:"CBnbqy",defaultMessage:"Next"})}),kt=()=>{const{theme:e}=(0,A.u)();return(0,k.Y)("div",{css:(0,S.AH)({width:"1.5px",backgroundColor:e.colors.border},"")})};var Nt={name:"1d3w5wq",styles:"width:100%"},Mt={name:"82a6rk",styles:"flex:1"};const Et=({evaluationResult:e,onUpsertAssessment:s,onSavePendingAssessments:t,onClickNext:o,onResetPendingAssessments:a,isNextAvailable:l,overridingExistingReview:i=!1,pendingAssessments:r=[],setOverridingExistingReview:d,isReadOnly:c=!1,assessmentInfos:u})=>{var m;const{theme:p}=(0,A.u)(),g=(0,_.tz)();if(!e)return null;const v=(0,n.first)(e.overallAssessments),h=null===v||void 0===v||null===(m=v.rootCauseAssessment)||void 0===m?void 0:m.assessmentName,f=h?(0,n.first)(null===e||void 0===e?void 0:e.responseAssessmentsByName[h]):void 0,y=!c&&(!(0,I.vP)(e)||i),w=g.formatMessage({id:"d44IPd",defaultMessage:"Reopen review"}),b=[[I._1.OVERALL_ASSESSMENT,e.overallAssessments]],x=u.find((e=>e.name===I._1.OVERALL_ASSESSMENT));return(0,k.FD)("div",{css:Nt,children:[(0,k.FD)("div",{css:(0,S.AH)({width:"100%",paddingLeft:p.spacing.md,paddingRight:p.spacing.md},""),children:[(0,k.FD)("div",{css:(0,S.AH)({backgroundColor:p.colors.backgroundSecondary,padding:p.spacing.md,paddingBottom:0,display:"flex",flexDirection:"column",gap:p.spacing.sm},""),children:[x&&(0,k.FD)("div",{css:(0,S.AH)({display:"flex",gap:p.spacing.sm,alignItems:"center"},""),children:[(0,k.Y)(C.SparkleDoubleIcon,{color:"ai"}),(0,k.Y)(A.T.Text,{bold:!0,children:(0,k.Y)(_.sA,{id:"ML+mQa",defaultMessage:"Overall assessment:"})}),(0,k.Y)(Ze.m,{assessment:v,"aria-label":I._1.OVERALL_ASSESSMENT,disableJudgeTypeIcon:(0,I.xO)(v),assessmentInfo:x,type:"assessment-value"})]}),(0,k.Y)(Rt,{assessmentsType:"overall",assessmentsByName:b,rootCauseAssessment:f,onUpsertAssessment:s,allowEditing:y,alwaysExpanded:!0,options:[I._1.OVERALL_ASSESSMENT],assessmentInfos:u}),(0,k.FD)("div",{css:(0,S.AH)({border:`1px solid ${p.colors.border}`,borderRadius:p.general.borderRadiusBase,padding:p.spacing.sm},""),children:[(0,k.Y)(A.T.Text,{bold:!0,children:(0,k.Y)(_.sA,{id:"5jXYY4",defaultMessage:"Detailed assessments"})}),(0,k.Y)(R.S,{size:"sm"}),(0,k.Y)(Rt,{assessmentsType:"response",assessmentsByName:(0,I.Xe)(e.responseAssessmentsByName),onUpsertAssessment:s,allowEditing:y,allowMoreThanOne:!0,options:I.PB,assessmentInfos:u})]})]}),(0,k.FD)("div",{css:(0,S.AH)({position:"sticky",backgroundColor:p.colors.backgroundSecondary,padding:p.spacing.md,top:0,display:"flex",justifyContent:"space-between",gap:p.spacing.sm,zIndex:p.options.zIndexBase},""),children:[(0,k.Y)("div",{children:!y&&!c&&(0,k.FD)("div",{css:(0,S.AH)({border:`1px solid ${p.colors.border}`,borderRadius:p.general.borderRadiusBase,display:"flex",alignItems:"center",gap:p.spacing.sm,padding:`${p.spacing.xs}px ${p.spacing.sm}px`},""),children:[(0,k.Y)(C.CheckCircleIcon,{css:(0,S.AH)({color:p.colors.textValidationSuccess},"")}),(0,k.Y)(A.T.Hint,{children:(0,k.Y)(_.sA,{id:"zLTdCZ",defaultMessage:"Reviewed"})}),(0,k.Y)(R.T,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentssection.tsx_149",content:w,children:(0,k.Y)(A.B,{"aria-label":w,componentId:"mlflow.evaluations_review.reopen_review_button",size:"small",icon:(0,k.Y)(C.PencilIcon,{}),onClick:()=>d(!0)})})]})}),(0,k.Y)("div",{css:Mt}),r.length>0&&(0,k.FD)("div",{css:(0,S.AH)({display:"flex",alignItems:"center",gap:p.spacing.sm},""),children:[(0,k.Y)(_.sA,{id:"MB3kda",defaultMessage:"{pendingCount} pending {pendingCount, plural, =1 {change} other {changes}}",values:{pendingCount:r.length}}),(0,k.Y)(A.B,{componentId:"mlflow.evaluations_review.discard_pending_assessments_button",onClick:a,children:(0,k.Y)(_.sA,{id:"eIWfRN",defaultMessage:"Discard"})})]}),(0,k.Y)(_t,{onSave:async()=>{await t(),d(!1)},containsOverallAssessment:Boolean(v),isNextResultAvailable:Boolean(l),onClickNext:o,toBeReviewed:y,hasPendingAssessments:r.length>0,overridingExistingReview:i,onCancelOverride:()=>d(!1)})]})]}),(0,k.Y)(R.S,{size:"md"})]})},Dt=({evaluationResult:e,otherEvaluationResult:s,onUpsertAssessment:t,onSavePendingAssessments:n,onClickNext:o,onResetPendingAssessments:a,isNextAvailable:l,overridingExistingReview:i=!1,pendingAssessments:r=[],setOverridingExistingReview:d,isReadOnly:c=!1,assessmentInfos:u})=>{const{theme:m}=(0,A.u)();return(0,k.FD)("div",{css:(0,S.AH)({display:"flex",width:"100%",gap:m.spacing.sm},""),children:[e&&(0,k.Y)(Et,{evaluationResult:e,onUpsertAssessment:t,onSavePendingAssessments:n,onClickNext:o,onResetPendingAssessments:a,isNextAvailable:l,overridingExistingReview:i,setOverridingExistingReview:d,pendingAssessments:r,isReadOnly:c,assessmentInfos:u}),s&&(0,k.FD)(k.FK,{children:[(0,k.Y)(kt,{}),(0,k.Y)(Et,{evaluationResult:s,onUpsertAssessment:t,onSavePendingAssessments:n,onClickNext:o,onResetPendingAssessments:a,isNextAvailable:l,overridingExistingReview:i,setOverridingExistingReview:d,pendingAssessments:r,isReadOnly:!0,assessmentInfos:u})]})]})},Ft=({requestId:e,onClose:s,trace:t})=>{const{theme:o}=(0,A.u)(),a=(0,k.Y)(A.T.Title,{level:2,withoutMargins:!0,children:e});return(0,k.Y)(C.Drawer.Root,{modal:!0,open:!0,onOpenChange:e=>{e||s()},children:(0,k.Y)(C.Drawer.Content,{componentId:"mlflow.evaluations_review.trace_data_drawer",width:"85vw",title:a,expandContentToFullHeight:!0,children:(()=>{const e=t.data.spans.length>0;return(0,n.isNil)(t)||!e?(0,k.FD)(k.FK,{children:[(0,k.Y)(R.S,{size:"lg"}),(0,k.Y)(C.Empty,{description:null,title:(0,k.Y)(_.sA,{id:"EpFST9",defaultMessage:"No trace data recorded"})})]}):(0,k.Y)("div",{css:(0,S.AH)({height:"100%",marginLeft:-o.spacing.lg,marginRight:-o.spacing.lg,marginBottom:-o.spacing.lg},""),onWheel:e=>e.stopPropagation(),children:(0,k.Y)(ee.ModelTraceExplorer,{modelTrace:t})})})()})})};var Ot={name:"1d3w5wq",styles:"width:100%"};const Ht=({experimentId:e,runDisplayName:s,evaluationResult:t,exportToEvalsInstanceEnabled:o=!1,traceQueryResult:a,getTrace:l})=>{var i,r;const d=(0,_.tz)(),{theme:c}=(0,A.u)(),[u,p]=(0,m.useState)(null),g=null===(i=t.traceInfo)||void 0===i||null===(r=i.trace_metadata)||void 0===r?void 0:r["databricks.tracingserver.dropped_spans_size_bytes"];let v;if(!(0,n.isNil)(g)){const e=2,s=(0,ns.SF)(Number(g),e);v=`${s.value} ${s.unit}`}return(0,k.FD)("div",{css:Ot,children:[(0,k.FD)("div",{css:(0,S.AH)({width:"100%",paddingLeft:c.spacing.md,paddingRight:c.spacing.md,display:"flex",alignItems:"center",justifyContent:"space-between",gap:c.spacing.sm},""),children:[(0,k.Y)(A.T.Title,{level:4,children:s}),t.requestId&&(0,k.FD)("div",{css:(0,S.AH)({display:"flex",gap:c.spacing.sm},""),children:[o&&l&&(0,k.Y)(O,{experimentId:e,selectedTraces:[t],traceInfos:void 0}),(0,k.Y)(R.T,{delayDuration:0,componentId:"mlflow.evaluations_review.see_detailed_trace_view_tooltip",content:g?`The trace spans were not stored due to their large size: ${v}`:void 0,side:"left",children:(0,k.Y)(A.B,{componentId:"mlflow.evaluations_review.see_detailed_trace_view_button",onClick:()=>p(t.requestId),loading:a.isLoading,disabled:!(0,n.isNil)(g),children:(0,k.Y)(_.sA,{id:"HUC492",defaultMessage:"See detailed trace view"})})})]}),u&&((0,n.isNil)(a.data)?(0,k.Y)(k.FK,{children:d.formatMessage({id:"EZfSbs",defaultMessage:"No trace data available"})}):(0,k.Y)(Ft,{onClose:()=>{p(null)},requestId:u,trace:a.data}))]}),(0,k.Y)(R.S,{size:"md"})]})},Vt=({experimentId:e,runDisplayName:s,otherRunDisplayName:t,evaluationResult:n,otherEvaluationResult:o,exportToEvalsInstanceEnabled:a=!1,traceQueryResult:l,compareToTraceQueryResult:i})=>{const{theme:r}=(0,A.u)();return(0,k.FD)("div",{css:(0,S.AH)({display:"flex",width:"100%",gap:r.spacing.sm},""),children:[(0,k.Y)(Ht,{experimentId:e,runDisplayName:s,evaluationResult:n,exportToEvalsInstanceEnabled:a,traceQueryResult:l}),t&&o&&(0,k.FD)(k.FK,{children:[(0,k.Y)(kt,{}),(0,k.Y)(Ht,{experimentId:e,runDisplayName:t,evaluationResult:o,exportToEvalsInstanceEnabled:a,traceQueryResult:i})]})]})},$t=({value:e})=>{const s=(0,m.useMemo)((()=>{if("object"===typeof e&&null!==e)return JSON.stringify(e,null,2);if("string"===typeof e)try{const s=JSON.parse(e);return JSON.stringify(s,null,2)}catch(s){return null}return null}),[e]);return(0,k.Y)("div",{css:(0,S.AH)({whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:s?"monospace":void 0},""),children:s||String(e)})};var Lt={name:"1066lcq",styles:"display:flex;justify-content:space-between;align-items:center"},Bt={name:"1nko30q",styles:"margin-bottom:0 !important"},zt={name:"49aokf",styles:"display:contents"};const Ut=({fieldName:e,title:s,value:t,showCopyIcon:o})=>{const{theme:a}=(0,A.u)(),{makeHTML:l}=(0,ht.N)(),i=(0,m.useMemo)((()=>(0,n.isString)(t)?l(t):null),[t,l]),r=(0,m.useMemo)((()=>(0,n.isString)(t)?null:(0,I.ng)(t)),[t]);return(0,k.FD)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm,flex:1,border:`1px solid ${a.colors.border}`,padding:a.spacing.md,borderRadius:a.general.borderRadiusBase,marginBottom:a.spacing.md},""),children:[(0,k.FD)("div",{css:Lt,children:[(0,k.Y)(A.T.Text,{bold:!0,children:s}),o&&(0,k.Y)(Ne.ad,{copyText:(0,I.ng)(t),componentId:"mlflow.evaluations_review.textbox.copy"})]}),(0,k.Y)(A.T.Paragraph,{css:Bt,children:(0,n.isString)(t)?(0,k.Y)("span",{css:zt,dangerouslySetInnerHTML:{__html:null!==i&&void 0!==i?i:""}}):e===I.UN&&Array.isArray(t)?(0,k.Y)("ul",{children:t.map(((e,s)=>(0,k.Y)("li",{children:(0,k.Y)($t,{value:e},s)},s)))}):(0,k.Y)($t,{value:r})})]})},jt=({evaluationResult:e})=>{const{theme:s}=(0,A.u)(),{inputs:t}=e,n=Object.entries(t),o=0===n.length;return(0,k.FD)("div",{css:(0,S.AH)({width:"100%",paddingLeft:s.spacing.md,paddingRight:s.spacing.md},""),children:[(0,k.Y)(A.T.Text,{bold:!0,children:(0,k.Y)(_.sA,{id:"MQ4Voz",defaultMessage:"{count, plural, one {Input} other {Inputs}}",values:{count:n.length}})}),(0,k.Y)(R.S,{size:"sm"}),o&&(0,k.Y)(A.T.Paragraph,{children:(0,k.Y)(_.sA,{id:"gPhm1b",defaultMessage:"No inputs logged"})}),n.map((([e,s])=>(0,k.Y)(Ut,{fieldName:e,title:e,value:s},e)))]})},Pt=({evaluationResult:e,otherEvaluationResult:s})=>{const{theme:t}=(0,A.u)(),n=(null===e||void 0===e?void 0:e.inputsId)===(null===s||void 0===s?void 0:s.inputsId);return(0,k.FD)("div",{css:(0,S.AH)({display:"flex",width:"100%",gap:t.spacing.sm},""),children:[e&&(0,k.Y)(jt,{evaluationResult:e}),!n&&s&&(0,k.Y)(jt,{evaluationResult:s})]})};var qt={name:"82a6rk",styles:"flex:1"},Kt={name:"82a6rk",styles:"flex:1"};const Wt=({evaluationResult:e})=>{const{theme:s}=(0,A.u)(),{outputs:t,targets:n}=e,o=Object.entries(t).filter((([,e])=>!(0,I.Wp)(e))),a=Object.entries(n).filter((([,e])=>!(0,I.Wp)(e))),l=0===o.length&&0===a.length;return(0,k.FD)("div",{css:(0,S.AH)({paddingLeft:s.spacing.md,paddingRight:s.spacing.md,width:"100%"},""),children:[(0,k.Y)(A.T.Text,{bold:!0,children:(0,k.Y)(_.sA,{id:"x6rkyu",defaultMessage:"Response"})}),(0,k.Y)(R.S,{size:"sm"}),l&&(0,k.Y)(A.T.Paragraph,{children:(0,k.Y)(_.sA,{id:"YvxyMH",defaultMessage:"No responses or targets logged"})}),(0,k.FD)("div",{css:(0,S.AH)({display:"flex",gap:s.spacing.md,alignItems:"flex-start"},""),children:[o.length>0&&(0,k.Y)("div",{css:qt,children:o.map((([e,s])=>{const t=I.eB[e],n=t?(0,k.Y)(_.sA,{...t}):e;return(0,k.Y)(Ut,{fieldName:e,title:n,value:s,showCopyIcon:!0},e)}))}),a.length>0&&(0,k.Y)("div",{css:Kt,children:a.map((([e,s])=>{const t=I.Au[e],n=t?(0,k.Y)(_.sA,{...t}):e;return(0,k.Y)(Ut,{fieldName:e,title:n,value:s,showCopyIcon:!0},e)}))})]})]})},Qt=({evaluationResult:e,otherEvaluationResult:s})=>{const{theme:t}=(0,A.u)();return(0,k.FD)("div",{css:(0,S.AH)({display:"flex",width:"100%",gap:t.spacing.sm},""),children:[e&&(0,k.Y)(Wt,{evaluationResult:e}),s&&(0,k.FD)(k.FK,{children:[(0,k.Y)(kt,{}),(0,k.Y)(Wt,{evaluationResult:s})]})]})},Gt=({assessment:e,chunkRelevanceAssessmentInfo:s})=>{const{theme:t}=(0,A.u)();return e||s?(0,k.Y)("div",{css:(0,S.AH)({paddingLeft:t.spacing.sm,paddingRight:t.spacing.sm,paddingTop:1,paddingBottom:1,backgroundColor:s?(0,u.x2)(t,s,e):"",borderRadius:t.general.borderRadiusBase,svg:{width:12,height:12}},""),children:e?(0,k.Y)(k.FK,{children:(0,I.w_)(e)?(0,k.Y)(C.UserIcon,{}):(0,k.Y)(C.SparkleDoubleIcon,{})}):(0,k.Y)(C.QuestionMarkIcon,{})}):(0,k.Y)(k.FK,{})};function Jt(e){try{const s=new URL(e);return"http:"===s.protocol||"https:"===s.protocol}catch(s){return!1}}var Zt={name:"s5xdrg",styles:"display:flex;align-items:center"};const Xt=({chunk:e,index:s})=>(0,k.FD)("div",{css:Zt,children:[(0,k.FD)(C.Tag,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewretrievalsection.tsx_30",children:["#",s+1]}),Jt(e.docUrl)?(0,k.Y)(A.T.Link,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewretrievalsection.tsx_32",href:e.docUrl,ellipsis:!0,openInNewTab:!0,strong:!0,children:e.docUrl}):(0,k.Y)(A.T.Title,{level:4,withoutMargins:!0,ellipsis:!0,children:e.docUrl})]});var en={name:"1vgo6ev",styles:"flex:2;display:flex;flex-direction:column;width:0"},sn={name:"49aokf",styles:"display:contents"};const tn=({evaluationResult:e,onUpsertAssessment:s,overridingExistingReview:t=!1,isReadOnly:o=!1,assessmentInfos:a,traceQueryResult:l})=>{const{theme:i}=(0,A.u)(),r=(0,_.tz)(),[d,c]=(0,m.useState)(0),{makeHTML:u}=(0,ht.N)(),p=(0,m.useMemo)((()=>!(0,n.isNil)(e.retrievalChunks)&&e.retrievalChunks.length>0?e.retrievalChunks:(0,F.nr)(e.responseAssessmentsByName,l.data)),[e.responseAssessmentsByName,e.retrievalChunks,l.data]),g=(0,m.useMemo)((()=>{var e;return u(null===p||void 0===p||null===(e=p[d])||void 0===e?void 0:e.content)}),[p,d,u]),v=0===(p||[]).length,h=!o&&(!(0,I.vP)(e)||t),f=null===p||void 0===p?void 0:p[d],y=r.formatMessage({id:"iPTAj8",defaultMessage:"Retrieval"});return(0,k.FD)("div",{css:(0,S.AH)({paddingLeft:i.spacing.md,paddingRight:i.spacing.md,width:"100%",display:"flex",flexDirection:"column"},""),role:"region","aria-label":y,children:[(0,k.Y)(A.T.Text,{bold:!0,children:y}),(0,n.isNil)(p)&&l.isFetching?(0,k.Y)(C.TableSkeleton,{lines:3}):v?(0,k.Y)(A.T.Text,{children:(0,k.Y)("i",{children:(0,k.Y)(_.sA,{id:"d00egE",defaultMessage:"No span with type RETRIEVER found in trace."})})}):(0,k.FD)("div",{css:(0,S.AH)({minHeight:400,maxHeight:600,overflow:"hidden",display:"flex",marginTop:i.spacing.sm,border:`1px solid ${i.colors.border}`,borderRadius:i.general.borderRadiusBase},""),children:[(0,k.FD)("div",{css:(0,S.AH)({flex:1,flexShrink:1,maxWidth:300,minWidth:200,overflow:"auto",padding:i.spacing.sm,borderRight:`1px solid ${i.colors.border}`},""),role:"listbox",children:[v&&(0,k.Y)(A.T.Paragraph,{children:(0,k.Y)(_.sA,{id:"0Bee6A",defaultMessage:"No retrieval logged"})}),(p||[]).map(((e,s)=>{var t,o;const l=a.find((e=>e.name===I._1.CHUNK_RELEVANCE));return(0,k.FD)("div",{role:"option","aria-label":null===(t=e.content)||void 0===t?void 0:t.slice(0,255),"aria-selected":s===d,css:(0,S.AH)({backgroundColor:s===d?i.colors.actionIconBackgroundHover:"transparent","&:hover":{backgroundColor:i.colors.actionIconBackgroundHover},padding:`${i.spacing.sm}px ${i.spacing.md}px`,overflow:"hidden",display:"flex",gap:i.spacing.sm,alignItems:"center",cursor:"pointer",width:"100%"},""),onClick:()=>{c(s)},children:[(0,k.Y)(Gt,{chunkRelevanceAssessmentInfo:l,assessment:(0,n.first)(null===e||void 0===e||null===(o=e.retrievalAssessmentsByName)||void 0===o?void 0:o[I._1.CHUNK_RELEVANCE])}),(0,k.Y)(A.T.Text,{ellipsis:!0,css:(0,S.AH)({flex:1,lineHeight:i.typography.lineHeightLg},""),children:e.content})]},[e.docUrl,s].join("-"))}))]}),f&&(0,k.FD)("div",{css:en,children:[(0,k.FD)("div",{css:(0,S.AH)({padding:i.spacing.md,borderBottom:`1px solid ${i.colors.border}`},""),children:[(0,k.Y)(Xt,{chunk:f,index:d}),(0,k.Y)(R.S,{size:"md"}),(0,k.Y)(Rt,{assessmentsType:"retrieval",assessmentsByName:(0,I.Xe)(f.retrievalAssessmentsByName||{}),onUpsertAssessment:e=>{e.metadata||(e.metadata={}),e.metadata[I.bz.CHUNK_INDEX]=d,s(e)},allowEditing:h,allowMoreThanOne:!0,options:I.ER,inputs:[d],assessmentInfos:a})]}),(0,k.Y)("div",{css:(0,S.AH)({padding:i.spacing.md,overflow:"auto"},""),children:(0,k.Y)(A.T.Paragraph,{children:(0,k.Y)("span",{css:sn,dangerouslySetInnerHTML:{__html:null!==g&&void 0!==g?g:""}})})})]})]})]})},nn=({evaluationResult:e,otherEvaluationResult:s,onUpsertAssessment:t,overridingExistingReview:n=!1,isReadOnly:o=!1,assessmentInfos:a,traceQueryResult:l,compareToTraceQueryResult:i})=>{const{theme:r}=(0,A.u)();return(0,k.FD)("div",{css:(0,S.AH)({display:"flex",width:"100%",gap:r.spacing.sm},""),children:[e&&(0,k.Y)(tn,{evaluationResult:e,onUpsertAssessment:t,overridingExistingReview:n,isReadOnly:o,assessmentInfos:a,traceQueryResult:l}),s&&(0,k.FD)(k.FK,{children:[(0,k.Y)(kt,{}),(0,k.Y)(tn,{evaluationResult:s,onUpsertAssessment:t,overridingExistingReview:n,isReadOnly:o,assessmentInfos:a,traceQueryResult:i})]})]})};var on={name:"1cwfdr7",styles:"flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis"};const an=({evaluationResult:e})=>{const{theme:s}=(0,A.u)();return(0,k.Y)("div",{css:(0,S.AH)({display:"flex",alignItems:"center",gap:s.spacing.sm,overflow:"hidden"},""),children:(0,k.Y)(A.T.Title,{level:2,withoutMargins:!0,css:on,children:(0,I.sw)(e)})})},ln=({experimentId:e,evaluationResult:s,otherEvaluationResult:t,onSavePendingAssessments:o,onClickNext:a,runDisplayName:l,compareToRunDisplayName:i,isNextAvailable:r=!1,isReadOnly:d=!1,exportToEvalsInstanceEnabled:c=!1,assessmentInfos:u,traceQueryResult:p,compareToTraceQueryResult:g})=>{(0,_.tz)();const{pendingAssessments:v,draftEvaluationResult:h,upsertAssessment:f,resetPendingAssessments:y}=(e=>{const[s,t]=(0,m.useReducer)(((e,s)=>{switch(s.type){case"resetPendingAssessments":return[];case"upsertAssessment":const t=e.find((e=>e.name===s.payload.name&&(0,I.Pp)(e)===(0,I.Pp)(s.payload)));return t?e.map((e=>e===t?""===(0,I.Zh)(e)&&s.payload.stringValue?{...s.payload,stringValue:"",name:s.payload.stringValue}:s.payload:e)):[s.payload,...e]}}),[]),o=(0,m.useMemo)((()=>{if(!e)return[];const t=s.find(I.hG);return t?[t,...e.overallAssessments]:e.overallAssessments}),[e,s]),a=(0,m.useMemo)((()=>{if(!e)return{};const t=(0,n.uniq)([...Object.keys(e.responseAssessmentsByName),...s.filter((e=>!(0,I.hG)(e)&&!(0,I.II)(e))).map((e=>e.name))]);return Object.fromEntries(t.map((t=>{const n=s.filter((e=>e.name===t));return[t,[...n,...e.responseAssessmentsByName[t]||[]]]})))}),[e,s]),l=(0,m.useMemo)((()=>{var t;const o=s.filter(I.II);return null===(t=e.retrievalChunks)||void 0===t?void 0:t.map(((e,s)=>{var t;const a=o.filter((e=>{var t;return(null===(t=e.metadata)||void 0===t?void 0:t[I.bz.CHUNK_INDEX])===s})),l=(0,n.flatMap)(null!==(t=e.retrievalAssessmentsByName)&&void 0!==t?t:{}),i=(0,n.groupBy)([...a,...l],"name");return Object.keys(i).forEach((e=>{i[e]=(0,n.orderBy)(i[e],"timestamp","desc")})),{...e,retrievalAssessmentsByName:i}}))}),[s,e]),i=(0,m.useMemo)((()=>({...e,overallAssessments:o,responseAssessmentsByName:a,retrievalChunks:l})),[e,o,a,l]),r=(0,m.useCallback)((e=>t({type:"upsertAssessment",payload:e})),[]),d=(0,m.useCallback)((()=>t({type:"resetPendingAssessments"})),[]);return{pendingAssessments:s,draftEvaluationResult:i,upsertAssessment:r,resetPendingAssessments:d}})(s),[w,b]=(v.length,(0,m.useState)(!1)),x=Boolean(s.errorCode),Y=Boolean(s.errorMessage),S=x||Y,[T,N]=(0,m.useState)(!1);return(0,k.FD)(k.FK,{children:[S?(0,k.FD)(k.FK,{children:[(0,k.Y)(C.Alert,{action:Y&&(0,k.Y)(A.B,{componentId:`mlflow.evaluations_review.evaluation_error_alert.show_${T?"less":"more"}_button`,onClick:()=>N((e=>!e)),children:T?(0,k.Y)(_.sA,{id:"qVQYZH",defaultMessage:"Show less"}):(0,k.Y)(_.sA,{id:"U4s/77",defaultMessage:"Show more"})}),closable:!1,componentId:"mlflow.evaluations_review.evaluation_error_alert",message:x?`${s.errorCode}`:"UNKNOWN_ERROR",description:T&&`${s.errorMessage}`,type:"error"}),(0,k.Y)(R.S,{size:"md"})]}):null,(0,k.Y)(Vt,{experimentId:e,runDisplayName:l,otherRunDisplayName:i,evaluationResult:s,otherEvaluationResult:t,exportToEvalsInstanceEnabled:c,traceQueryResult:p,compareToTraceQueryResult:g}),(0,k.Y)(Dt,{evaluationResult:h,otherEvaluationResult:t,onUpsertAssessment:f,onClickNext:a,onSavePendingAssessments:async()=>{await(null===o||void 0===o?void 0:o(s,v)),y()},isNextAvailable:r,overridingExistingReview:w,setOverridingExistingReview:b,pendingAssessments:v,onResetPendingAssessments:y,isReadOnly:d,assessmentInfos:u}),(0,k.Y)(Pt,{evaluationResult:s,otherEvaluationResult:t}),(0,k.Y)(Qt,{evaluationResult:s,otherEvaluationResult:t}),(0,k.Y)(nn,{evaluationResult:h,otherEvaluationResult:t,onUpsertAssessment:f,overridingExistingReview:w,isReadOnly:d,assessmentInfos:u,traceQueryResult:p,compareToTraceQueryResult:g}),(0,k.Y)(R.S,{size:"lg"})]})};var rn={name:"ujpwkd",styles:"display:flex;position:relative;overflow:scroll"},dn={name:"1tc6xju",styles:"flex:1;overflow:auto"};const cn=({experimentId:e,evaluation:s,otherEvaluation:t,className:n,runUuid:o,isReadOnly:a=!1,selectNextEval:l,isNextAvailable:i,runDisplayName:r,compareToRunDisplayName:d,exportToEvalsInstanceEnabled:c=!1,assessmentInfos:u,traceQueryResult:p,compareToTraceQueryResult:g,saveAssessmentsQuery:v})=>{const{theme:h}=(0,A.u)(),f=(0,m.useCallback)((async(e,s)=>{if(!e||a||!o||!v)return;const t=s.slice();if((0,I.ik)(e,s)){const s=(0,I.YZ)(e);s&&t.unshift(s)}return v.savePendingAssessments(o,e.evaluationId,t)}),[o,a,v]),y=(0,m.useRef)(null);return(0,m.useEffect)((()=>{var e;null===(e=y.current)||void 0===e||e.scrollTo(0,0)}),[s.evaluationId]),(0,k.FD)("div",{css:rn,className:n,children:[(0,k.Y)("div",{css:dn,ref:y,children:(0,k.Y)(ln,{experimentId:e,evaluationResult:s,otherEvaluationResult:t,onSavePendingAssessments:f,onClickNext:l,isNextAvailable:i,isReadOnly:a||!o,runDisplayName:r,compareToRunDisplayName:d,exportToEvalsInstanceEnabled:c,assessmentInfos:u,traceQueryResult:p,compareToTraceQueryResult:g},s.evaluationId)}),(null===v||void 0===v?void 0:v.isSaving)&&(0,k.Y)("div",{css:(0,S.AH)({inset:0,position:"absolute",backgroundColor:h.colors.overlayOverlay,display:"flex",justifyContent:"center",alignItems:"center",zIndex:h.options.zIndexBase+1},""),children:(0,k.Y)(A.S,{size:"large",inheritColor:!0,css:(0,S.AH)({color:h.colors.backgroundPrimary},"")})})]})},un=()=>{var e;return{enableRunEvaluationWriteFeatures:null!==(e=(0,D.UK)())&&void 0!==e&&e}},mn=(0,m.createContext)(un()),pn=({config:e={},children:s})=>{const t=un(),o=(0,n.merge)({},t,e);return(0,k.Y)(mn.Provider,{value:o,children:s})};function gn(e,s){const t=(0,m.useMemo)((()=>{var e;if(s)return(0,ee.isV3ModelTraceInfo)(s)?s.trace_id:null!==(e=s.request_id)&&void 0!==e?e:""}),[s]),o=(0,m.useCallback)((s=>!e||(0,n.isNil)(t)?Promise.resolve(void 0):e(t,s)),[e,t]);return(0,se.I)({queryKey:["getTrace",t],queryFn:()=>o(s),enabled:!(0,n.isNil)(e)&&!(0,n.isNil)(t),staleTime:1/0,refetchOnWindowFocus:!1,retry:1,keepPreviousData:!0})}var vn={name:"inxa61",styles:"flex:1;overflow:hidden"};const hn=m.memo((({experimentId:e,runUuid:s,evaluations:t,selectedEvaluationId:o,onChangeEvaluationId:a,runDisplayName:l,otherRunDisplayName:i,exportToEvalsInstanceEnabled:r=!1,assessmentInfos:d,getTrace:c,saveAssessmentsQuery:u})=>{var p,g,v,h,f;const{theme:y,classNamePrefix:w}=(0,A.u)(),b=(0,m.useCallback)((()=>{a(void 0)}),[a]),x=(0,m.useCallback)((e=>{var s,t;return(null===(s=e.currentRunValue)||void 0===s?void 0:s.evaluationId)===o||(null===(t=e.otherRunValue)||void 0===t?void 0:t.evaluationId)===o}),[o]),I=(0,m.useMemo)((()=>t?(null===t||void 0===t?void 0:t.findIndex(x))-1:void 0),[t,x]),Y=(0,m.useMemo)((()=>void 0!==I&&I>=0),[I]),T=(0,m.useMemo)((()=>t?(null===t||void 0===t?void 0:t.findIndex(x))+1:void 0),[t,x]),_=(0,m.useMemo)((()=>void 0!==T&&T<t.length),[T,t]),N=(0,m.useCallback)((()=>{var e,s,n,o;if(null===t||void 0===I)return;const l=(null===(e=t[I])||void 0===e||null===(s=e.currentRunValue)||void 0===s?void 0:s.evaluationId)||(null===(n=t[I])||void 0===n||null===(o=n.otherRunValue)||void 0===o?void 0:o.evaluationId);a(l)}),[t,I,a]),M=(0,m.useCallback)((()=>{var e,s,n,o;if(null===t||void 0===T)return;const l=(null===(e=t[T])||void 0===e||null===(s=e.currentRunValue)||void 0===s?void 0:s.evaluationId)||(null===(n=t[T])||void 0===n||null===(o=n.otherRunValue)||void 0===o?void 0:o.evaluationId);a(l)}),[t,T,a]),E=(0,m.useMemo)((()=>null===t||void 0===t?void 0:t.find(x)),[t,x]),D=(0,m.useMemo)((()=>T&&t?null===t||void 0===t?void 0:t[T]:void 0),[t,T]),F=(0,m.useMemo)((()=>I&&t?null===t||void 0===t?void 0:t[I]:void 0),[t,I]),O=(0,m.useContext)(mn)||un(),H=gn(c,null===E||void 0===E||null===(p=E.currentRunValue)||void 0===p?void 0:p.traceInfo),V=gn(c,null===E||void 0===E||null===(g=E.otherRunValue)||void 0===g?void 0:g.traceInfo);gn(c,null===D||void 0===D||null===(v=D.currentRunValue)||void 0===v?void 0:v.traceInfo),gn(c,null===F||void 0===F||null===(h=F.currentRunValue)||void 0===h?void 0:h.traceInfo);const $=Boolean(null===E||void 0===E?void 0:E.currentRunValue)!==Boolean(null===E||void 0===E?void 0:E.otherRunValue),L=o===(null===E||void 0===E||null===(f=E.currentRunValue)||void 0===f?void 0:f.evaluationId)?H:V;return(0,n.isNil)(E)?(0,k.Y)(k.FK,{}):(0,k.FD)("div",{onKeyDown:e=>{"ArrowLeft"===e.key?N():"ArrowRight"===e.key&&M()},children:[(0,k.FD)(R.d,{componentId:"mlflow.evaluations_review.modal",visible:!0,title:E.currentRunValue?(0,k.Y)(an,{evaluationResult:E.currentRunValue}):E.otherRunValue?(0,k.Y)(an,{evaluationResult:E.otherRunValue}):null,onCancel:b,size:"wide",verticalSizing:"maxed_out",css:(0,S.AH)({width:"100% !important",padding:"0 4rem !important",[`& .${w}-modal-body`]:{flex:1,paddingTop:0},[`& .${w}-modal-header`]:{paddingBottom:y.spacing.sm}},""),footer:null,children:[L.isFetching&&(0,k.Y)(C.GenericSkeleton,{label:"Loading trace...",style:{width:"calc(100% - 45px)",height:"calc(100% - 100px)",position:"absolute",paddingRight:500,zIndex:2100,backgroundColor:y.colors.backgroundPrimary}}),$&&!(0,n.isNil)(L.data)?(0,k.Y)("div",{css:(0,S.AH)({height:"100%",marginLeft:-y.spacing.lg,marginRight:-y.spacing.lg},""),children:(0,k.Y)(fn,{traceData:L.data})}):E.currentRunValue&&(0,k.Y)(cn,{experimentId:e,evaluation:E.currentRunValue,otherEvaluation:E.otherRunValue,selectNextEval:M,isNextAvailable:_,css:vn,runUuid:s,isReadOnly:!O.enableRunEvaluationWriteFeatures,runDisplayName:l,compareToRunDisplayName:i,exportToEvalsInstanceEnabled:r,assessmentInfos:d,traceQueryResult:H,compareToTraceQueryResult:V,saveAssessmentsQuery:u})]}),(0,k.Y)("div",{css:(0,S.AH)({display:"flex",justifyContent:"flex-end",position:"fixed",top:"50%",left:0,zIndex:2e3,opacity:".75",width:"5rem","&:hover":{opacity:"1.0"}},""),children:(0,k.Y)("div",{css:(0,S.AH)({backgroundColor:y.colors.backgroundPrimary,borderRadius:y.legacyBorders.borderRadiusMd,marginRight:y.spacing.sm},""),children:(0,k.Y)(A.B,{disabled:!Y,componentId:"mlflow.evaluations_review.modal.previous_eval",icon:(0,k.Y)(A.n,{}),onClick:()=>N()})})}),(0,k.Y)("div",{css:(0,S.AH)({display:"flex",justifyContent:"flex-start",position:"fixed",top:"50%",right:0,zIndex:2e3,width:"5rem",opacity:".75","&:hover":{opacity:"1.0"}},""),children:(0,k.Y)("div",{css:(0,S.AH)({backgroundColor:y.colors.backgroundPrimary,borderRadius:y.legacyBorders.borderRadiusMd,marginLeft:y.spacing.sm},""),children:(0,k.Y)(A.B,{disabled:!_,componentId:"mlflow.evaluations_review.modal.next_eval",icon:(0,k.Y)(A.o,{}),onClick:()=>M()})})})]})})),fn=({traceData:e})=>(0,k.Y)(ee.ModelTraceExplorer,{modelTrace:e}),yn=m.memo((({experimentId:e,selectedColumns:s,evaluations:t,selectedEvaluationId:o,selectedAssessmentInfos:a,assessmentInfos:l,assessmentFilters:i,tableSort:r,onChangeEvaluationId:d,getRunColor:c,runUuid:u,runDisplayName:p,compareToRunUuid:g,compareToRunDisplayName:v,rowSelection:h,setRowSelection:f,exportToEvalsInstanceEnabled:y=!1,getTrace:w,toggleAssessmentFilter:b,saveAssessmentsQuery:x,disableAssessmentTooltips:I,onTraceTagsEdit:Y,enableRowSelection:R,enableGrouping:M=!1,allColumns:E,displayLoadingOverlay:D})=>{const O=(0,_.tz)(),{theme:H}=(0,A.u)(),[L,B]=(0,m.useState)(!1),z=!(0,n.isNil)(g),U=s.filter((e=>e.type===$.$6.INPUT)),{columns:j}=(0,m.useMemo)((()=>{if(!M){const t=s.map((s=>Ls(s,{evaluationInputs:U,isComparing:z,theme:H,intl:O,experimentId:e,onChangeEvaluationId:d,onTraceTagsEdit:Y})));return{columns:K(t,s)}}const t=new Map;q(s,z).forEach((s=>{const n=s.group||$.w8.INFO;t.has(n)||t.set(n,[]),(t.get(n)||[]).push(Ls(s,{evaluationInputs:U,isComparing:z,theme:H,intl:O,experimentId:e,onChangeEvaluationId:d,onTraceTagsEdit:Y}))}));const n=Array.from(t.entries()).map((([e,s])=>({header:vt,meta:{groupId:e,visibleCount:s.length,totalCount:E.filter((s=>s.group===e)).length,enableGrouping:M},id:`${e}-group`,columns:s})));return{columns:n}}),[s,U,z,d,H,O,e,Y,M,E]),{setTable:P,setSelectedRowIds:W}=m.useContext(N),Q=(0,J.N4)({data:t,columns:j,getCoreRowModel:(0,Z.HT)(),getSortedRowModel:(0,Z.h5)(),enableColumnResizing:!0,columnResizeMode:"onChange",enableRowSelection:R,enableMultiSort:!0,state:{rowSelection:h},meta:{getRunColor:c},onRowSelectionChange:f,getRowId:e=>(0,F.On)(e.currentRunValue)}),G=void 0!==h&&Q.getIsAllRowsSelected(),ee=Q.getIsSomeRowsSelected();(0,m.useEffect)((()=>(P(Q),()=>P(void 0))),[Q,P]),(0,m.useEffect)((()=>{R&&W(Q.getSelectedRowModel().rows.map((e=>e.id)))}),[Q,h,W,R]);const se=O.formatMessage({id:"+mAXPc",defaultMessage:"No traces found. Try clearing your active filters to see more traces."}),te=(0,k.Y)(C.Empty,{description:se,image:(0,k.Y)(T.S,{})});(0,m.useEffect)((()=>{r&&!V.Al.includes(r.key)?r.key===V.yX?Q.setSorting([{id:r.key,desc:!r.asc},{id:V.Te,desc:!1}]):Q.setSorting([{id:r.key,desc:!r.asc}]):Q.setSorting([])}),[r,Q]);const{rows:ne}=Q.getRowModel(),oe=m.useRef(null),ae=(0,X.Te)({count:ne.length,estimateSize:()=>120,getScrollElement:()=>oe.current,measureElement:"undefined"!==typeof window&&-1===navigator.userAgent.indexOf("Firefox")?e=>null===e||void 0===e?void 0:e.getBoundingClientRect().height:void 0,overscan:10}),le=ae.getVirtualItems(),ie=Q.getHeaderGroups(),{columnSizeVars:re,tableWidth:de}=(0,m.useMemo)((()=>{const e={};ie.forEach((s=>{s.headers.forEach((s=>{e[`--header-${(0,ns.Mr)(s.column.id)}-size`]=s.getSize()+"px"}))}));let s=0;if(ne.length>0){ne[0].getVisibleCells().forEach((t=>{e[`--col-${(0,ns.Mr)(t.column.id)}-size`]=t.column.getSize()+"px",s+=t.column.getSize()}))}return{columnSizeVars:e,tableWidth:s+"px"}}),[ie,ne]),ce=(0,m.useMemo)((()=>{const e={};for(const s of a)e[s.name]=(0,ts.pY)(s,t,i);return e}),[a,t,i]);return(0,k.FD)(k.FK,{children:[(0,k.Y)("div",{className:"container",ref:oe,css:(0,S.AH)({height:"100%",position:"relative",overflowY:"auto",overflowX:"auto",minWidth:"100%",width:de},""),children:(0,k.FD)(C.Table,{css:(0,S.AH)({width:"100%",...re},""),empty:0===Q.getRowModel().rows.length?te:void 0,someRowsSelected:R?ee||G:void 0,children:[(0,k.Y)(gt,{headerGroups:Q.getHeaderGroups(),enableRowSelection:R,enableGrouping:M,selectedAssessmentInfos:a,assessmentNameToAggregates:ce,assessmentFilters:i,toggleAssessmentFilter:b,runDisplayName:p,compareToRunUuid:g,compareToRunDisplayName:v,disableAssessmentTooltips:I,collapsedHeader:L,setCollapsedHeader:B,isComparing:z,allRowSelected:G,someRowSelected:ee,toggleAllRowsSelectedHandler:Q.getToggleAllRowsSelectedHandler,setColumnSizing:Q.setColumnSizing}),(0,k.Y)(zs,{rows:ne,isComparing:z,enableRowSelection:R,virtualItems:le,virtualizerTotalSize:ae.getTotalSize(),virtualizerMeasureElement:ae.measureElement,rowSelectionState:h,selectedColumns:s})]})}),D&&(0,k.Y)("div",{css:(0,S.AH)({position:"absolute",inset:0,backgroundColor:H.colors.backgroundPrimary,opacity:.75,pointerEvents:"none",display:"flex",justifyContent:"center",alignItems:"center"},""),children:(0,k.Y)(A.S,{size:"large"})}),o&&(0,k.Y)(hn,{experimentId:e,runUuid:u,runDisplayName:p,otherRunDisplayName:v,evaluations:ne.map((e=>e.original)),selectedEvaluationId:o,onChangeEvaluationId:d,exportToEvalsInstanceEnabled:y,assessmentInfos:l,getTrace:w,saveAssessmentsQuery:x})]})}));function wn({searchQuery:e,setSearchQuery:s}){const t=(0,_.tz)(),[n,o]=(0,m.useState)(e);return(0,m.useEffect)((()=>{o(e)}),[e]),(0,m.useEffect)((()=>{const e=setTimeout((()=>{s(n)}),400);return()=>clearTimeout(e)}),[n,s]),(0,k.Y)(C.TableFilterInput,{componentId:"mlflow.evaluations_review.table_ui.filter_input",placeholder:t.formatMessage({id:"zNWzj6",defaultMessage:"Search traces by request"}),value:n,onChange:e=>o(e.target.value)})}const bn="mlflow.evaluations_review.table_ui.compare_to_run_combobox",xn="mlflow.evaluations_review.table_ui.filter_form",In="mlflow.evaluations_review.table_ui.column_filter_combobox",Yn=({columns:e,selectedColumns:s,setSelectedColumns:t,setSelectedColumnsWithHiddenColumns:n})=>{const o=(0,_.tz)(),{theme:a}=(0,A.u)();return(0,k.FD)(C.DialogCombobox,{componentId:In,label:"Columns",multiSelect:!0,children:[(0,k.Y)(C.DialogComboboxCustomButtonTriggerWrapper,{children:(0,k.Y)(A.B,{endIcon:(0,k.Y)(C.ChevronDownIcon,{}),componentId:"mlflow.evaluations_review.table_ui.filter_button",children:(0,k.FD)("div",{css:(0,S.AH)({display:"flex",gap:a.spacing.sm,alignItems:"center"},""),children:[(0,k.Y)(C.ColumnsIcon,{}),o.formatMessage({id:"wjOGl2",defaultMessage:"Columns"})]})})}),(0,k.Y)(C.DialogComboboxContent,{children:(0,k.Y)(C.DialogComboboxOptionList,{children:e.map((e=>(0,k.Y)(C.DialogComboboxOptionListCheckboxItem,{value:e.label,checked:s.some((s=>s.id===e.id)),onChange:()=>(e=>{if(n)return n([e]);t&&t((s=>s.some((s=>s.id===e.id))?s.filter((s=>s.id!==e.id)):[...s,e]))})(e)},e.id)))})})]})};var Sn={name:"9q39xd",styles:"min-width:32px"};const An=m.memo((({tableSort:e,columns:s=[],onChange:t,enableGrouping:n,isMetadataLoading:o,metadataError:a})=>{const l=(0,_.tz)(),{theme:i}=(0,A.u)(),[r,d]=(0,m.useState)(!1),c=(0,m.useMemo)((()=>{const e=[],t=l.formatMessage({id:"Kkuttk",defaultMessage:"Assessment"});if(n){const t=q(s);for(const s of t)if(s.type===$.$6.ASSESSMENT){const t=s.assessmentInfo.displayName;e.push({label:t,key:s.id,type:$.$6.ASSESSMENT,group:$.w8.ASSESSMENT})}else if(s.type===$.$6.INPUT)e.push({label:s.label,key:s.id,type:$.$6.INPUT,group:$.w8.INFO});else if(s.type===$.$6.TRACE_INFO){const t=s.id===V.yX?l.formatMessage({id:"mrGpVQ",defaultMessage:"Session time"}):s.label;V.My.includes(s.id)&&e.push({label:t,key:s.id,type:$.$6.TRACE_INFO,group:$.w8.INFO})}return e}for(const n of s.filter((e=>e.type===$.$6.ASSESSMENT))){const s=n.assessmentInfo.displayName;e.push({label:`${t} \ufe65 ${s}`,key:n.id,type:$.$6.ASSESSMENT})}const o=l.formatMessage({id:"2plDKs",defaultMessage:"Input"});for(const n of s.filter((e=>e.type===$.$6.INPUT)))e.push({label:`${o} \ufe65 ${n.label}`,key:n.id,type:$.$6.INPUT});for(const n of s.filter((e=>(e.type===$.$6.TRACE_INFO||e.type===$.$6.INTERNAL_MONITOR_REQUEST_TIME)&&V.My.includes(e.id))))e.push({label:n.label,key:n.id,type:$.$6.TRACE_INFO});return e}),[s,l,n]),u=(0,m.useMemo)((()=>{const s=c.find((s=>s.key===(null===e||void 0===e?void 0:e.key)));let t=null===s||void 0===s?void 0:s.label;if(!t){var n;const s=null===e||void 0===e||null===(n=e.key)||void 0===n?void 0:n.match(/^.+\.`(.+)`$/);s&&(t=s[1])}const o=l.formatMessage({id:"sKaamx",defaultMessage:"Sort"});return t?`${o}: ${t}`:o}),[c,l,e]);return(0,k.FD)(C.DropdownMenu.Root,{open:r,onOpenChange:d,modal:!1,children:[(0,k.Y)(C.DropdownMenu.Trigger,{"data-testid":"sort-select-dropdown",asChild:!0,children:(0,k.Y)(A.B,{componentId:"mlflow.experiment_page.sort_select_v2.toggle",icon:e?e.asc?(0,k.Y)(C.SortAscendingIcon,{}):(0,k.Y)(C.SortDescendingIcon,{}):(0,k.Y)(C.SortUnsortedIcon,{}),css:Sn,"aria-label":u,endIcon:(0,k.Y)(C.ChevronDownIcon,{}),children:u})}),(0,k.Y)(C.DropdownMenu.Content,{minWidth:250,children:a?(0,k.FD)("div",{css:(0,S.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:i.spacing.xs,padding:`${i.spacing.md}px`,color:i.colors.textValidationDanger},""),"data-testid":"filter-dropdown-error",children:[(0,k.Y)(A.k,{}),(0,k.Y)(_.sA,{id:"dJaboT",defaultMessage:"Fetching traces failed"})]}):o?(0,k.Y)("div",{css:(0,S.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:i.spacing.xs,padding:`${i.spacing.lg}px`,color:i.colors.textSecondary},""),"data-testid":"sort-dropdown-loading",children:(0,k.Y)(A.S,{size:"small"})}):n?(0,k.Y)(Tn,{sortOptions:c,tableSort:e,onOptionSelected:(e,s)=>{t(e,s),d(!1)}}):(0,k.Y)(kn,{sortOptions:c,tableSort:e,onOptionSelected:(e,s)=>{t(e,s),d(!1)}})})]})}));var Cn={name:"1j5vobt",styles:"display:flex;align-items:center;gap:4px"};const Tn=({sortOptions:e,tableSort:s,onOptionSelected:t})=>{const{theme:n}=(0,A.u)(),o=(0,m.useRef)(null),a=(0,m.useRef)(null),[l,i]=(0,m.useState)(""),r=(0,m.useMemo)((()=>e.filter((e=>e.label.toLowerCase().includes(l.toLowerCase())))),[e,l]),d=(0,m.useMemo)((()=>{const e={};return r.forEach((s=>{var t;const n=null!==(t=s.group)&&void 0!==t?t:$.w8.INFO;e[n]||(e[n]=[]),e[n].push(s)})),e}),[r]),c=(0,m.useCallback)((n=>{var o;const a=e.find((e=>e.key===n));a&&t(a,null===(o=null===s||void 0===s?void 0:s.asc)||void 0===o||o)}),[t,e,null===s||void 0===s?void 0:s.asc]),u=(0,m.useCallback)((n=>{var o;const a=null!==(o=e.find((e=>e.key===(null===s||void 0===s?void 0:s.key))))&&void 0!==o?o:e[0];t(a,n)}),[t,e,null===s||void 0===s?void 0:s.key]);return(0,m.useEffect)((()=>{requestAnimationFrame((()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.focus()}))}),[]),(0,k.FD)(k.FK,{children:[(0,k.FD)("div",{css:(0,S.AH)({padding:`${n.spacing.sm}px ${n.spacing.lg/2}px`,display:"flex",gap:n.spacing.xs},""),children:[(0,k.Y)(T.I,{ref:o,componentId:"mlflow.genai_traces_table.sort_dropdown.search",prefix:(0,k.Y)(T.S,{}),placeholder:"Search",value:l,onChange:e=>i(e.target.value),type:"search",onKeyDown:e=>{var s;"ArrowDown"!==e.key&&"Tab"!==e.key||(null===(s=a.current)||void 0===s||s.focus(),e.preventDefault())}}),(0,k.FD)("div",{css:(0,S.AH)({display:"flex",gap:n.spacing.xs},""),children:[(0,k.Y)(C.ToggleButton,{pressed:!1===(null===s||void 0===s?void 0:s.asc),icon:(0,k.Y)(C.ArrowDownIcon,{}),componentId:"mlflow.genai_traces_table.sort_dropdown.sort_desc",onClick:()=>u(!1),"aria-label":"Sort descending"}),(0,k.Y)(C.ToggleButton,{pressed:!0===(null===s||void 0===s?void 0:s.asc),icon:(0,k.Y)(C.ArrowUpIcon,{}),componentId:"mlflow.experiment_page.sort_dropdown.sort_asc",onClick:()=>u(!0),"aria-label":"Sort ascending"})]})]}),(0,k.FD)("div",{css:(0,S.AH)({maxHeight:400,overflowY:"auto",padding:`0 ${n.spacing.sm}px`},""),children:[Object.entries(d).map((([e,t],n)=>(0,k.Y)(m.Fragment,{children:(0,k.FD)(C.DropdownMenu.Group,{children:[(0,k.Y)(C.DropdownMenu.Label,{children:e===$.w8.INFO?"Attributes":$.RF[e]}),t.map(((e,t)=>(0,k.FD)(C.DropdownMenu.CheckboxItem,{componentId:"mlflow.genai_traces_table.sort_dropdown.sort_option",checked:e.key===(null===s||void 0===s?void 0:s.key),onClick:()=>c(e.key),ref:0===n&&0===t?a:void 0,"data-testid":`sort-select-${e.label}`,children:[(0,k.Y)(C.DropdownMenu.ItemIndicator,{}),(0,k.Y)("span",{css:Cn,children:e.label})]},e.key)))]})},e))),0===r.length&&(0,k.Y)(C.DropdownMenu.Item,{disabled:!0,componentId:"mlflow.genai_traces_table.sort_dropdown.no_results",children:(0,k.Y)(_.sA,{id:"WpNCQl",defaultMessage:"No results"})})]})]})};var Rn={name:"1kxd8xu",styles:"max-height:400px;overflow-y:auto"},_n={name:"1j5vobt",styles:"display:flex;align-items:center;gap:4px"};const kn=({sortOptions:e,tableSort:s,onOptionSelected:t})=>{const{theme:n}=(0,A.u)(),o=(0,m.useRef)(null),[a,l]=(0,m.useState)(""),i=(0,m.useRef)(null),r=(0,m.useMemo)((()=>e.filter((e=>e.label.toLowerCase().includes(a.toLowerCase())))),[e,a]),d=(0,m.useCallback)((n=>{const o=e.find((e=>e.key===n));t(o,(null===s||void 0===s?void 0:s.asc)||!0)}),[t,s,e]),c=(0,m.useCallback)((n=>{const o=e.find((e=>e.key===(null===s||void 0===s?void 0:s.key)));t(o||e[0],n)}),[t,e,s]);return(0,m.useEffect)((()=>{requestAnimationFrame((()=>{var e;null===(e=o.current)||void 0===e||e.focus()}))}),[]),(0,k.FD)(k.FK,{children:[(0,k.FD)("div",{css:(0,S.AH)({padding:`${n.spacing.sm}px ${n.spacing.lg/2}px ${n.spacing.sm}px`,width:"100%",display:"flex",gap:n.spacing.xs},""),children:[(0,k.Y)(T.I,{componentId:"mlflow.experiment_page.sort_dropdown.search",prefix:(0,k.Y)(T.S,{}),value:a,type:"search",onChange:e=>l(e.target.value),placeholder:"Search",autoFocus:!0,ref:o,onKeyDown:e=>{var s;"ArrowDown"!==e.key&&"Tab"!==e.key?e.stopPropagation():null===(s=i.current)||void 0===s||s.focus()}}),(0,k.FD)("div",{css:(0,S.AH)({display:"flex",gap:n.spacing.xs},""),children:[(0,k.Y)(C.ToggleButton,{pressed:!1===(null===s||void 0===s?void 0:s.asc),icon:(0,k.Y)(C.ArrowDownIcon,{}),componentId:"mlflow.experiment_page.sort_dropdown.sort_desc",onClick:()=>c(!1),"aria-label":"Sort descending","data-testid":"sort-select-desc"}),(0,k.Y)(C.ToggleButton,{pressed:!0===(null===s||void 0===s?void 0:s.asc),icon:(0,k.Y)(C.ArrowUpIcon,{}),componentId:"mlflow.experiment_page.sort_dropdown.sort_asc",onClick:()=>c(!0),"aria-label":"Sort ascending","data-testid":"sort-select-asc"})]})]}),(0,k.FD)(C.DropdownMenu.Group,{css:Rn,children:[r.map(((e,t)=>(0,k.FD)(C.DropdownMenu.CheckboxItem,{componentId:"mlflow.experiment_page.sort_dropdown.sort_option",onClick:()=>d(e.key),checked:e.key===(null===s||void 0===s?void 0:s.key),"data-testid":`sort-select-${e.label}`,ref:0===t?i:void 0,children:[(0,k.Y)(C.DropdownMenu.ItemIndicator,{}),(0,k.Y)("span",{css:_n,children:e.label})]},e.key))),!r.length&&(0,k.Y)(C.DropdownMenu.Item,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunssortselectorv2.tsx_151",disabled:!0,children:(0,k.Y)(_.sA,{id:"EkUD0b",defaultMessage:"No results"})})]})]})},Nn=({backgroundColor:e,icon:s,children:t})=>{const{theme:n}=(0,A.u)();return(0,k.FD)("div",{css:(0,S.AH)({display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",padding:"4px 8px",gap:n.spacing.xs,borderRadius:n.borders.borderRadiusMd,color:n.colors.textSecondary,backgroundColor:e||n.colors.backgroundSecondary,fontSize:n.typography.fontSizeSm},""),children:[s||null,t?(0,k.Y)("span",{children:t}):null]})},Mn="selectedEvaluationId",En=()=>{var e;const[s,t]=h(),n=null!==(e=s.get(Mn))&&void 0!==e?e:void 0,o=(0,m.useCallback)((e=>{t((s=>void 0===e?(s.delete(Mn),s):(s.set(Mn,e),s)))}),[t]);return[n,o]},Dn="searchQuery";function Fn(e,s,t,o,a){return e.filter((e=>function(e,s,t,o){const a=null===e||void 0===e?void 0:e.currentRunValue,l=null===e||void 0===e?void 0:e.otherRunValue;let i=!0;for(const m of s){var r,d;const e=m.assessmentName,s=m.filterValue,p=m.run,g=p===t?a:p===o?l:void 0;if(void 0===g)continue;const v=e===I._1.OVERALL_ASSESSMENT?null===(r=g.overallAssessments)||void 0===r?void 0:r[0]:null===(d=g.responseAssessmentsByName[e])||void 0===d?void 0:d[0];if("rca"===m.filterType){var c,u;const s=(null===g||void 0===g||null===(c=g.overallAssessments[0])||void 0===c||null===(u=c.rootCauseAssessment)||void 0===u?void 0:u.assessmentName)===e;i=i&&s}else{let e=v?(0,I.Zh)(v):void 0;(0,n.isNil)(e)&&(e=void 0),i=i&&e===s}}return i}(e,s,o,a))).filter((e=>{var s,o;if((0,n.isNil)(t)||""===t)return!0;const a=t.toLowerCase(),l=JSON.stringify(null===(s=e.currentRunValue)||void 0===s?void 0:s.inputs).toLowerCase().includes(a),i=(null===(o=e.currentRunValue)||void 0===o?void 0:o.inputsId.toLowerCase())===a;return l||i}))}var On={name:"1ykowef",styles:"margin-bottom:0"},Hn={name:"f3vz0n",styles:"font-weight:500"},Vn={name:"969shj",styles:"display:flex;flex:1;overflow-y:hidden;position:relative"};const $n=e=>{const{totalRowCount:s,sampledInfo:t}=e,o=(0,_.tz)();return t?t.maxAllowedCount?s>=t.maxAllowedCount?(0,k.Y)(R.T,{componentId:"mlflow.experiment_list_view.max_traces.tooltip",content:o.formatMessage({id:"BpAyCF",defaultMessage:"Only the top {evalResultsCount} results are shown"},{evalResultsCount:s}),children:(0,k.Y)(A.W,{color:"warning"})}):null:t.logCountLoading||(0,n.isNil)(t.sampledCount)||(0,n.isNil)(t.totalCount)?(0,k.Y)(A.S,{}):(0,k.Y)(Nn,{children:(0,k.FD)(R.T,{componentId:"mlflow.experiment_list_view.sampled_badge.tooltip",content:o.formatMessage({id:"TannO5",defaultMessage:"Retrieved {sampledCount} out of {totalCount} total logs ({percentage}%)"},{sampledCount:t.sampledCount,totalCount:t.totalCount,percentage:(0,ns.$h)(t.sampledCount/t.totalCount)}),children:["Sampled ",(0,ns.$h)(t.sampledCount/t.totalCount),"%"]})}):null},Ln="__any_value__";var Bn={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const zn=m.memo((({assessmentName:e,assessmentInfo:s,assessmentLabel:t,assessmentFilter:n,updateAssessmentFilter:o,removeAssessmentFilter:a,run:l})=>{const i=(0,_.tz)(),{theme:r}=(0,A.u)(),d=n?x(n.filterValue):Ln;return(0,k.Y)("div",{css:Bn,children:(0,k.FD)(C.SegmentedControlGroup,{name:"size-story",value:d,onChange:t=>{if(t.target.value===Ln)return void a(e,l);const n=b(s,t.target.value);o(e,n,l)},size:"middle",componentId:`mlflow.evaluations_review.table_ui.filter_control_${e}`,children:[(0,k.Y)(C.SegmentedControlButton,{value:Ln,children:(0,k.Y)("div",{css:(0,S.AH)({display:"flex",gap:r.spacing.sm,alignItems:"center",color:r.colors.textPrimary},""),children:i.formatMessage({id:"Hq/vjk",defaultMessage:"All"})})}),Array.from(s.uniqueValues.values()).map((e=>{const{content:t,icon:n}=(0,I.uU)(i,r,s,e);return(0,k.Y)(C.SegmentedControlButton,{value:x(e),children:(0,k.FD)("div",{css:(0,S.AH)({display:"flex",gap:r.spacing.sm,alignItems:"center",color:r.colors.textPrimary},""),children:[t,n]})},x(e))}))]})})})),Un=function({experimentId:e,currentEvaluationResults:s,compareToEvaluationResults:t,currentRunDisplayName:n,runUuid:o,compareToRunUuid:a,compareToRunDisplayName:l,compareToRunLoading:i,sampledInfo:r,exportToEvalsInstanceEnabled:d=!1,getTrace:c,saveAssessmentsQuery:u,enableRunEvaluationWriteFeatures:p,defaultSortOption:g,disableAssessmentTooltips:v,onTraceTagsEdit:f,traceActions:w,initialSelectedColumns:Y}){const{theme:R}=(0,A.u)(),N=(0,_.tz)(),M=(0,F.Co)(s),E=(0,F.Co)(t||[]),D=Object.keys(null!==w&&void 0!==w?w:{}).length>0,[H,L]=En(),B=(0,m.useMemo)((()=>G(M,E)),[M,E]),[z,U]=(()=>{var e;const[s,t]=h();return[null!==(e=s.get(Dn))&&void 0!==e?e:"",(0,m.useCallback)((e=>{t((s=>void 0===e||""===e?(s.delete(Dn),s):(s.set(Dn,e),s)))}),[t])]})(),j=(0,m.useMemo)((()=>(0,ts.II)(N,M,E)),[N,M,E]),P=(0,V.XS)(N,M,j,o),[q,K]=(e=>{const[s,t]=h();return[(0,m.useMemo)((()=>{var t;return(null!==(t=s.getAll(y))&&void 0!==t?t:[]).reduce(((s,t)=>{const[n,o,a,l]=t.split("::"),i=null===e||void 0===e?void 0:e.find((e=>e.name===o));if(i){const e=b(i,a);s.push({run:n,assessmentName:o,filterValue:e,filterType:""===l?void 0:l})}return s}),[])}),[e,s]),(0,m.useCallback)(((e,s=!1)=>{t((s=>(s.delete(y),e&&e.forEach((e=>{s.append(y,[e.run,e.assessmentName,x(e.filterValue),e.filterType].join("::"))})),s)),{replace:s})}),[t])]})(P.map((e=>e.assessmentInfo)).filter((e=>void 0!==e))),W=(0,m.useMemo)((()=>""===z&&0===q.length?B:Fn(B,q,z,n,l)),[B,z,q,n,l]),[Q,J]=(0,m.useState)(P),Z=(0,m.useMemo)((()=>{const e=Q.filter((e=>e.type===$.$6.ASSESSMENT)).map((e=>e.assessmentInfo));return(0,ts.aE)(e)}),[Q]),X=P.find((e=>e.type===$.$6.ASSESSMENT&&e.id===I._1.OVERALL_ASSESSMENT)),ee=g||(X?{key:X.id,type:$.$6.ASSESSMENT,asc:!0}:void 0),[se,te]=(0,m.useState)(ee),ne=(0,m.useCallback)(((e,s)=>q.find((t=>t.assessmentName===e&&t.run===s))),[q]),oe=(0,m.useCallback)(((e,s)=>{K(q.filter((t=>t.assessmentName!==e||t.run!==s)))}),[q,K]),ae=(0,m.useCallback)(((e,s,t,n)=>{const o=q.find((s=>s.assessmentName===e&&s.run===t));K(void 0===o?[...q,{assessmentName:e,filterValue:s,filterType:n,run:t}]:q.map((t=>t.assessmentName===e?{...t,filterValue:s,filterType:n}:t)))}),[q,K]),le=(0,m.useCallback)(((e,s,t,n)=>{const o=q.find((s=>s.assessmentName===e&&s.run===t));void 0===o?K([...q,{assessmentName:e,filterValue:s,filterType:n,run:t}]):o.filterValue===s&&o.filterType===n?K(q.filter((s=>s.assessmentName!==e||s.run!==t))):K(q.map((o=>o.assessmentName===e&&o.run===t?{assessmentName:e,filterValue:s,filterType:n,run:t}:o)))}),[q,K]),ie=(0,m.useCallback)((()=>{K([])}),[K]),re=q.length>0,[de,ce]=(0,m.useState)({}),ue=(0,m.useMemo)((()=>{const e=Object.keys(de).filter((e=>de[e]));return W.filter((s=>s.currentRunValue&&e.includes(s.currentRunValue.evaluationId))).map((e=>e.currentRunValue)).filter((e=>void 0!==e))}),[de,W]),me={enableRunEvaluationWriteFeatures:p},pe=M.length;return i?(0,k.Y)(C.LegacySkeleton,{}):(0,k.Y)(pn,{config:me,children:(0,k.Y)("div",{css:(0,S.AH)({display:"flex",flexDirection:"row",gap:R.spacing.lg,overflow:"hidden",height:"100%"},""),children:(0,k.Y)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",gap:R.spacing.xs,overflow:"hidden",flexGrow:1},""),children:(0,k.FD)("div",{css:(0,S.AH)({display:"flex",flex:1,flexDirection:"column",gap:R.spacing.xs,overflow:"hidden"},""),children:[(0,k.FD)("div",{css:(0,S.AH)({display:"flex",width:"100%",alignItems:"flex-end",justifyContent:"space-between",padding:`${R.spacing.xs}px 0px`},""),children:[(0,k.FD)(C.TableFilterLayout,{css:On,children:[(0,k.Y)(wn,{searchQuery:z,setSearchQuery:U}),(0,k.FD)(C.DialogCombobox,{componentId:xn,label:"Filters",value:Array.from(q).map((e=>e.assessmentName)),multiSelect:!0,children:[(0,k.Y)(C.DialogComboboxCustomButtonTriggerWrapper,{children:(0,k.Y)(A.B,{endIcon:(0,k.Y)(C.ChevronDownIcon,{}),componentId:"mlflow.evaluations_review.table_ui.filter_button",css:(0,S.AH)({border:re?`1px solid ${R.colors.actionDefaultBorderFocus} !important`:"",backgroundColor:re?`${R.colors.actionDefaultBackgroundHover} !important`:""},""),children:(0,k.FD)("div",{css:(0,S.AH)({display:"flex",gap:R.spacing.sm,alignItems:"center"},""),children:[(0,k.Y)(C.FilterIcon,{}),N.formatMessage({id:"J961B2",defaultMessage:"Filters{numFilters}"},{numFilters:re?` (${q.length})`:""}),q.length>0&&(0,k.Y)(T.X,{css:(0,S.AH)({fontSize:12,cursor:"pointer",color:R.colors.grey400,"&:hover":{color:R.colors.grey600}},""),onClick:e=>{ie(),e.stopPropagation(),e.preventDefault()}})]})})}),(0,k.Y)(C.DialogComboboxContent,{children:(0,k.Y)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",padding:`${R.spacing.sm}px ${R.spacing.sm}px`,gap:R.spacing.md},""),children:Z.filter((e=>"numeric"!==e.dtype)).map((e=>(0,k.FD)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",gap:R.spacing.sm},""),children:[(0,k.Y)("div",{css:Hn,children:e.displayName}),n&&(0,k.Y)(zn,{assessmentLabel:e.displayName,assessmentName:e.name,assessmentInfo:e,assessmentFilter:ne(e.name,n),updateAssessmentFilter:ae,removeAssessmentFilter:oe,run:n}),a&&l&&(0,k.FD)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",gap:R.spacing.xs},""),children:[(0,k.Y)(A.T.Hint,{children:l}),(0,k.Y)(zn,{assessmentLabel:e.displayName,assessmentName:e.name,assessmentInfo:e,assessmentFilter:ne(e.name,l),updateAssessmentFilter:ae,removeAssessmentFilter:oe,run:l})]})]},e.name)))})})]}),(0,k.Y)(An,{tableSort:se,columns:P,onChange:(e,s)=>{te({key:e.key,type:e.type,asc:s})}}),(0,k.Y)(Yn,{columns:P,selectedColumns:Q,setSelectedColumns:J}),(0,k.Y)(O,{experimentId:e,selectedTraces:ue,setRowSelection:ce,traceActions:w,traceInfos:void 0})]}),(0,k.FD)("div",{css:(0,S.AH)({display:"flex",alignItems:"center",gap:R.spacing.sm},""),children:[(0,k.Y)($n,{totalRowCount:pe,sampledInfo:r}),(0,k.Y)(A.T.Hint,{children:N.formatMessage({id:"FnOQ44",defaultMessage:"{numFilteredEvals} of {numEvals}"},{numEvals:B.length,numFilteredEvals:W.length})})]})]}),(0,k.Y)("div",{css:(0,S.AH)({display:"flex",gap:R.spacing.md,width:"100%",flex:1,overflowY:"hidden"},""),children:(0,k.Y)("div",{css:Vn,children:(0,k.Y)(yn,{experimentId:e,selectedColumns:Q,allColumns:P,evaluations:W,selectedEvaluationId:H,selectedAssessmentInfos:Z,assessmentInfos:j,assessmentFilters:q,onChangeEvaluationId:L,tableSort:se,runUuid:o,compareToRunUuid:a,runDisplayName:n,compareToRunDisplayName:l,enableRowSelection:D,rowSelection:D?de:void 0,setRowSelection:D?ce:void 0,exportToEvalsInstanceEnabled:d,getTrace:c,toggleAssessmentFilter:le,saveAssessmentsQuery:u,disableAssessmentTooltips:v,onTraceTagsEdit:f})})})]})})})})},jn=async({queryKey:[,{experimentId:e}]})=>re("ajax-api/2.0/mlflow/runs/search","POST",{experiment_ids:[e]}),Pn=(e,s=!1)=>{var t;const{data:n,error:o,isLoading:a,isFetching:l}=(0,se.I)((e=>["EXPERIMENT_RUNS_FOR_TRACE_COMPARISON",{experimentId:e}])(e),{queryFn:jn,enabled:!s,cacheTime:1/0,staleTime:1/0});return{requestError:o,isLoading:a,isFetching:l,runInfos:null===n||void 0===n||null===(t=n.runs)||void 0===t?void 0:t.map((e=>{var s,t;return{runUuid:null===(s=e.info)||void 0===s?void 0:s.run_uuid,runName:null===(t=e.info)||void 0===t?void 0:t.run_name}}))}};var qn=t(60062);const Kn=(e,s)=>["GET_TRACE_EVALUATION_ARTIFACT",{runUuid:e,artifactFile:s}],Wn=async({queryKey:[,{runUuid:e,artifactFile:s}]})=>{const t=["ajax-api/2.0/mlflow/get-artifact",new URLSearchParams({run_uuid:e,path:s})].join("?");return re(t,"GET").then((e=>({...e,filename:s})))},Qn=[o.o8.Assessments,o.o8.Evaluations,o.o8.Metrics],Gn=({runUuid:e,artifacts:s=Qn},{disabled:t=!1}={})=>{const i=!t&&Qn.some((e=>s.includes(e))),r=(0,qn.E)({queries:Qn.map((n=>({queryFn:Wn,queryKey:Kn(e,n),enabled:!t&&s.includes(n),refetchOnWindowFocus:!1})))}),u=r.some((e=>e.isLoading)),p=r.some((e=>e.isFetching)),g=r.find((e=>e.error)),[v,h,f]=r.map((e=>e.data)),y=(0,m.useMemo)((()=>c(v)),[v]),w=(0,m.useMemo)((()=>c(h)),[h]),b=(0,m.useMemo)((()=>c(f)),[f]),x=(0,m.useMemo)((()=>{if(w)return function(e,s,t){const i=(s||[]).reduce(((e,s)=>{e[s.evaluation_id]||(e[s.evaluation_id]={});const{key:t,value:n,timestamp:o}=s;return e[s.evaluation_id][t]={key:t,value:n,timestamp:o},e}),{}),r=(t||[]).reduce(((e,s)=>{var t,o,a,l;return e[s.evaluation_id]||(e[s.evaluation_id]=[]),e[s.evaluation_id].push({booleanValue:(0,n.isNil)(s.boolean_value)?s.boolean_value:Boolean(s.boolean_value),numericValue:(0,n.isNil)(s.numeric_value)?s.numeric_value:Number(s.numeric_value),stringValue:(0,n.isNil)(s.string_value)?s.string_value:String(s.string_value),metadata:s.metadata||{},...s.error_code&&{errorCode:s.error_code},...s.error_message&&{errorMessage:s.error_message},name:s.name,rationale:s.rationale||null,source:{metadata:null!==(t=null===(o=s.source)||void 0===o?void 0:o.metadata)&&void 0!==t?t:{},sourceId:null===(a=s.source)||void 0===a?void 0:a.source_id,sourceType:null===(l=s.source)||void 0===l?void 0:l.source_type},timestamp:s.timestamp}),e}),{});return e.map((e=>{var s,t;const c=(0,n.orderBy)(r[e.evaluation_id]||[],"timestamp","desc"),u=c.filter(a).map((e=>{var s,t,o,a;const l=null===(s=e.rationale)||void 0===s?void 0:s.match(/^\[(.*?)\](.*?)(?:\*\*Suggested Actions\*\*:(.*))?$/s),i=l?null===(t=l[1])||void 0===t?void 0:t.trim():void 0,r=l?null===(o=l[2])||void 0===o?void 0:o.trim():void 0,d=l?null===(a=l[3])||void 0===a?void 0:a.trim():void 0;return e.rationale=r||e.rationale,{...e,rootCauseAssessment:(0,n.isNil)(i)?void 0:{assessmentName:i,suggestedActions:d}}}));0===u.length&&u.push({name:o._1.OVERALL_ASSESSMENT,rationale:null,source:{sourceType:"AI_JUDGE",sourceId:"UNKNOWN",metadata:{}},metadata:{},numericValue:null,booleanValue:null,stringValue:null,timestamp:null});const m=c.filter(l),p=(0,n.difference)(c,u,m),g=(0,n.groupBy)(p,"name");return Object.keys(g).forEach((e=>{g[e]=(0,n.orderBy)(g[e],"timestamp","desc")})),{evaluationId:e.evaluation_id,requestId:e.request_id,inputs:e.inputs,inputsId:e.inputs_id,outputs:null!==(s=e.outputs)&&void 0!==s?s:{},targets:null!==(t=e.targets)&&void 0!==t?t:{},...e.error_code&&{errorCode:e.error_code},...e.error_message&&{errorMessage:e.error_message},overallAssessments:u,responseAssessmentsByName:g,metrics:i[e.evaluation_id]||{},retrievalChunks:d(e.outputs,e.targets,m)}}))}(w,b,y)}),[y,w,b]);return{requestError:g,isLoading:u&&i,isFetching:p&&i,data:x}},Jn="searchMlflowTraces",Zn=({queryClient:e})=>{e.invalidateQueries({queryKey:[Jn]})},Xn=({locations:e,runUuid:s,timeRange:t,otherRunUuid:n,filterByLoggedModelId:o,loggedModelId:a,sqlWarehouseId:l,disabled:i,networkFilters:r})=>{const d=(0,_.tz)(),c=to(s,t,r,o),{data:u,isLoading:p,error:g}=so({locations:e,filter:c,loggedModelId:a,sqlWarehouseId:l,enabled:!i}),v=(0,m.useMemo)((()=>(0,F.p6)(u,s)),[u,s]),h=to(n,t),{data:f,isLoading:y,error:w}=so({locations:e,filter:h,enabled:!i&&Boolean(n),loggedModelId:a,sqlWarehouseId:l}),b=(0,m.useMemo)((()=>(0,F.p6)(f,n)),[f,n]),x=(0,m.useMemo)((()=>!v||p||g||!v.length?[]:v.map((e=>(0,F.ih)(e)))),[v,p,g]),I=(0,m.useMemo)((()=>{const e=y&&Boolean(n);return!b||e||w||!b.length?[]:b.map((e=>(0,F.ih)(e)))}),[b,y,w,n]),Y=(0,m.useMemo)((()=>(0,ts.II)(d,x||[],I||[])),[d,x,I]),S=(0,m.useMemo)((()=>{const e=new Map;return null===v||void 0===v||v.forEach((s=>{const t=s.trace_metadata;if(t){const n=t[ge.sourceNameTag];n&&!e.has(n)&&e.set(n,{value:n,renderValue:()=>(0,k.Y)(Te,{traceInfo:s,isComparing:!1,disableLinks:!0})})}})),{source:Array.from(e.values()).sort(((e,s)=>e.value.localeCompare(s.value)))}}),[v]),A=(0,V.XS)(d,x||[],Y,s,void 0,!0);return(0,m.useMemo)((()=>({assessmentInfos:Y,allColumns:A,totalCount:x.length,evaluatedTraces:x,otherEvaluatedTraces:I,isLoading:p&&!i,error:g,isEmpty:0===x.length,tableFilterOptions:S})),[Y,A,p,g,x,S,i,I])},eo=({locations:e,currentRunDisplayName:s,runUuid:t,timeRange:n,searchQuery:o,filters:a,disabled:l,pageSize:i,limit:r,filterByLoggedModelId:d,tableSort:c,loggedModelId:u,sqlWarehouseId:p})=>{const g=!((null===e||void 0===e?void 0:e.some((e=>"UC_SCHEMA"===e.type)))&&(0,D.F9)()),{networkFilters:v,clientFilters:h}=((e,s=!0)=>e.reduce(((e,t)=>(t.column===$.w8.ASSESSMENT&&s?e.clientFilters.push(t):e.networkFilters.push(t),e)),{networkFilters:[],clientFilters:[]}))(a||[],g),f=to(t,n,v,d,g?void 0:o),y=no(c),{data:w,isLoading:b,isFetching:x,error:I,refetch:Y}=so({locations:e,filter:f,enabled:!l,pageSize:i,limit:r,orderBy:y,loggedModelId:u,sqlWarehouseId:p}),S=(0,m.useMemo)((()=>{if(w)return w.map((e=>({currentRunValue:(0,F.ih)(e),otherRunValue:void 0})))}),[w]),A=(0,m.useMemo)((()=>{if(!S)return;if(!g||""===o&&0===(null===h||void 0===h?void 0:h.length))return S.reduce(((e,s)=>{var t;return null!==(t=s.currentRunValue)&&void 0!==t&&t.traceInfo&&e.push(s.currentRunValue.traceInfo),e}),[]);const e=h.map((e=>({assessmentName:e.key||"",filterValue:e.value,run:s||""})));return Fn(S,e||[],o,s,void 0).reduce(((e,s)=>{var t;return null!==(t=s.currentRunValue)&&void 0!==t&&t.traceInfo&&e.push(s.currentRunValue.traceInfo),e}),[])}),[S,g,h,o,s]),C=(0,m.useMemo)((()=>(0,F.p6)(A,t)),[A,t]);return l?{data:[],isLoading:!1,isFetching:!1}:{data:C,isLoading:b,isFetching:x,error:I||void 0,refetchMlflowTraces:Y}},so=({locations:e,filter:s,pageSize:t,limit:o,orderBy:a,loggedModelId:l,sqlWarehouseId:i,enabled:r,...d})=>{const c=(null===e||void 0===e?void 0:e.some((e=>"UC_SCHEMA"===e.type)))&&(0,D.F9)(),u=(0,m.useMemo)((()=>c?{keepPreviousData:!0,refetchOnWindowFocus:!1}:{staleTime:1/0,cacheTime:1/0}),[c]);return(0,se.I)({...u,enabled:r,queryKey:[Jn,{locations:e,filter:s,orderBy:a,loggedModelId:l,sqlWarehouseId:i,pageSize:t}],queryFn:({signal:r})=>(async({signal:e,locations:s,filter:t,pageSize:o,limit:a,orderBy:l,loggedModelId:i,sqlWarehouseId:r})=>{if((null===s||void 0===s?void 0:s.some((e=>"UC_SCHEMA"===e.type)))&&(0,D.F9)())return ee.TracesServiceV4.searchTracesV4({signal:e,orderBy:l,locations:s,filter:t});let d,c=[];const u=o||(0,D.Mq)(),m=a||(0,D.pR)();for(;c.length<m;){const o={locations:s,filter:t,max_results:u,order_by:l};i&&r&&(o.model_id=i,o.sql_warehouse_id=r),d&&(o.page_token=d);const a=await ie("ajax-api/3.0/mlflow/traces/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o),signal:e});if(!a.ok)throw(0,le.Jg)(a);const m=await a.json(),p=m.traces;if((0,n.isNil)(p)||(c=c.concat(p)),d=m.next_page_token,!d)break}return c})({signal:r,locations:e,filter:s,pageSize:t,limit:o,orderBy:a,loggedModelId:l,sqlWarehouseId:i}),...d})},to=(e,s,t,n,o)=>{const a=[];if(e&&a.push(`attributes.run_id = '${e}'`),o&&a.push(`span.attributes.\`mlflow.spanInputs\` ILIKE '%${o}%'`),s){const e="attributes.timestamp_ms";s.startTime&&a.push(`${e} > ${s.startTime}`),s.endTime&&a.push(`${e} < ${s.endTime}`)}if(n&&a.push(`request_metadata."mlflow.modelId" = '${n}'`),t&&t.forEach((e=>{switch(e.column){case $.w8.TAG:if(e.key){const s="tags",t=e.key.includes(".")||e.key.includes(" ")?`${s}.\`${e.key}\``:`${s}.${e.key}`;a.push(`${t} ${e.operator} '${e.value}'`)}break;case V.tj:const s="attributes.execution_time_ms";a.push(`${s} ${e.operator} ${e.value}`);break;case V.$W:const t="attributes.status";a.push(`${t} = '${e.value}'`);break;case V.tP:a.push(`request_metadata."mlflow.trace.user" = '${e.value}'`);break;case V.li:a.push(`attributes.run_id = '${e.value}'`);break;case V.im:a.push(`request_metadata."mlflow.modelId" = '${e.value}'`);break;case V.LV:a.push(`attributes.name ${e.operator} '${e.value}'`);break;case V.FW:a.push(`request_metadata."mlflow.source.name" ${e.operator} '${e.value}'`);break;case $.w8.ASSESSMENT:a.push(`feedback.\`${e.key}\` ${e.operator} '${e.value}'`);break;case $.w8.EXPECTATION:a.push(`expectation.\`${e.key}\` ${e.operator} '${e.value}'`);break;case V.Gq:"="===e.operator?a.push(`span.name ILIKE '${e.value}'`):"CONTAINS"===e.operator?a.push(`span.name ILIKE '%${e.value}%'`):a.push(`span.name ${e.operator} '${e.value}'`);break;case V.Rb:"="===e.operator?a.push(`span.type ILIKE '${e.value}'`):"CONTAINS"===e.operator?a.push(`span.type ILIKE '%${e.value}%'`):a.push(`span.type ${e.operator} '${e.value}'`);break;case V.k0:"CONTAINS"===e.operator&&a.push(`span.content ILIKE '%${e.value}%'`);break;default:if(e.column.startsWith(V.rc)){const s=`request_metadata.${(0,F.v8)(e.column)}`;e.operator===$.tl.CONTAINS?a.push(`${s} ILIKE '%${e.value}%'`):a.push(`${s} ${e.operator} '${e.value}'`)}}})),a.length>0)return a.join(" AND ")},no=e=>{if(e)switch(e.key){case V.tj:return["execution_time "+(e.asc?"ASC":"DESC")];case V.Te:return["timestamp "+(e.asc?"ASC":"DESC")];default:return[]}};var oo=t(884);var ao={name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"},lo={name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"};const io=({id:e,item:s,options:t,query:n,onChange:o,placeholder:a,width:l,canSearchCustomValue:i})=>{const{theme:r}=(0,A.u)(),[d,c]=(0,m.useState)(""),u=(0,m.useMemo)((()=>{var e,s;return null!==(e=null!==(s=null===n||void 0===n?void 0:n.data)&&void 0!==s?s:t)&&void 0!==e?e:[]}),[null===n||void 0===n?void 0:n.data,t]),p=(0,m.useMemo)((()=>u.map((e=>e.value))),[u]);return(0,k.FD)(C.DialogCombobox,{componentId:"mlflow.evaluations_review.table_ui.filter_column",value:null!==s&&void 0!==s&&s.value?[s.value]:[],id:e,children:[(0,k.Y)(C.DialogComboboxTrigger,{withInlineLabel:!1,placeholder:a,renderDisplayedValue:()=>{var e;return null!==(e=null===s||void 0===s?void 0:s.renderValue())&&void 0!==e?e:""},width:l,allowClear:!1}),(0,k.Y)(C.DialogComboboxContent,{width:l,style:{zIndex:r.options.zIndexBase+100},loading:null===n||void 0===n?void 0:n.isLoading,children:(0,k.Y)(C.DialogComboboxOptionList,{children:(0,k.FD)(C.DialogComboboxOptionListSearch,{onSearch:e=>c(e),children:[u.map((e=>(0,k.Y)(C.DialogComboboxOptionListSelectItem,{value:e.value,onChange:o,checked:e.value===(null===s||void 0===s?void 0:s.value),css:ao,children:e.renderValue()},e.value))),i&&d&&!p.includes(d)?(0,k.FD)(C.DialogComboboxOptionListSelectItem,{value:d,onChange:o,checked:d===(null===s||void 0===s?void 0:s.value),css:lo,children:['Use "',d,'"']},d):null]})})})]})};var ro={name:"833hqy",styles:"width:200px"};const co=({index:e,tableFilter:s,assessmentInfos:t,onChange:n,experimentId:o,tableFilterOptions:a})=>{const l=(0,_.tz)(),{theme:i}=(0,A.u)(),r=`filter-value-${e}`,[d,c]=(0,m.useState)(s.value),u=(0,m.useCallback)((()=>{d!==s.value&&n({...s,value:d},e)}),[s,e,n,d]),p=Pn(o),g=(0,m.useMemo)((()=>{var e,s;return{data:null===(e=p.runInfos)||void 0===e||null===(s=e.filter((e=>e.runUuid&&e.runName)))||void 0===s?void 0:s.map((e=>({value:e.runUuid,renderValue:()=>e.runName}))),isLoading:p.isLoading}}),[p]),v=((e,s=!1)=>{const t=["EXPERIMENT_MODEL_VERSIONS",e],{data:n,isLoading:o,error:a}=(0,se.I)({queryKey:t,queryFn:async()=>re("ajax-api/2.0/mlflow/logged-models/search","POST",{experiment_ids:[e]}),staleTime:1/0,cacheTime:1/0,enabled:!s,refetchOnMount:!1,retry:!1});return{data:null===n||void 0===n?void 0:n.models,isLoading:o,error:a||void 0}})(o),h=(0,m.useMemo)((()=>{var e;return{data:null===(e=v.data)||void 0===e?void 0:e.map((e=>({value:e.info.model_id,renderValue:()=>e.info.name}))),isLoading:v.isLoading}}),[v]),f=[{value:"IN_PROGRESS",renderValue:()=>l.formatMessage(Re.IN_PROGRESS)},{value:"OK",renderValue:()=>l.formatMessage(Re.OK)},{value:"ERROR",renderValue:()=>l.formatMessage(Re.ERROR)}];var y,b;if(s.column===V.li)return(0,k.Y)(io,{id:r,item:null===(y=g.data)||void 0===y?void 0:y.find((e=>e.value===s.value)),query:g,onChange:t=>{n({...s,value:t},e)},placeholder:"Select run",width:200,canSearchCustomValue:!1});if(s.column===V.im)return(0,k.Y)(io,{id:r,item:null===(b=h.data)||void 0===b?void 0:b.find((e=>e.value===s.value)),query:h,onChange:t=>{n({...s,value:t},e)},placeholder:"Select version",width:200,canSearchCustomValue:!1});if(s.column===$.w8.ASSESSMENT){const o=t.find((e=>e.name===s.key));if(o&&"numeric"!==o.dtype&&"unknown"!==o.dtype){const t=Array.from(o.uniqueValues.values()).map((e=>({value:x(e),renderValue:()=>(0,I.uU)(l,i,o,e).content})));return(0,k.Y)(io,{id:r,item:t.find((e=>e.value===x(s.value))),options:t,onChange:t=>{n({...s,value:w(t)},e)},placeholder:"Select",width:200,canSearchCustomValue:!1})}}if(s.column===V.$W)return(0,k.Y)(io,{id:r,item:f.find((e=>e.value===s.value)),options:f,onChange:t=>{n({...s,value:t},e)},placeholder:"Select",width:200,canSearchCustomValue:!1});if(s.column===V.FW){const t=a.source;return(0,k.Y)(io,{id:r,item:t.find((e=>e.value===s.value)),options:t,onChange:t=>{n({...s,value:t},e)},placeholder:"Select source",width:200,canSearchCustomValue:!1})}return(0,k.Y)(T.I,{"aria-label":"Value",componentId:"mlflow.evaluations_review.table_ui.filter_value",id:r,placeholder:s.column===V.tj?"Time in milliseconds":"Value",type:s.column===V.tj?"number":"text",value:d,onChange:e=>{c(e.target.value)},onBlur:u,css:ro,disabled:s.column===$.w8.ASSESSMENT})};const uo=[V.tj,V.$W,V.LV,V.tP,V.li,V.im,V.FW],mo=(e,s)=>e===V.tj?[$.tl.EQUALS,$.tl.NOT_EQUALS,$.tl.GREATER_THAN,$.tl.LESS_THAN,$.tl.GREATER_THAN_OR_EQUALS,$.tl.LESS_THAN_OR_EQUALS]:e===V.Gq||e===V.Rb?[$.tl.EQUALS,$.tl.NOT_EQUALS,$.tl.CONTAINS]:e===V.k0?[$.tl.CONTAINS]:[$.tl.EQUALS];var po={name:"1fttcpj",styles:"display:flex;flex-direction:column"},go={name:"1fttcpj",styles:"display:flex;flex-direction:column"},vo={name:"1fttcpj",styles:"display:flex;flex-direction:column"},ho={name:"833hqy",styles:"width:200px"},fo={name:"1fttcpj",styles:"display:flex;flex-direction:column"},yo={name:"1fttcpj",styles:"display:flex;flex-direction:column"},wo={name:"1duj7gx",styles:"align-self:flex-end"};const bo=({tableFilter:e,index:s,onChange:t,onDelete:n,assessmentInfos:o,experimentId:a,tableFilterOptions:l,allColumns:i})=>{const{column:r,operator:d,key:c}=e,{theme:u}=(0,A.u)(),p=(0,m.useMemo)((()=>o.filter((e=>"numeric"!==e.dtype)).map((e=>({value:e.name,renderValue:()=>e.displayName})))),[o]),g=(0,m.useMemo)((()=>{const e=i.filter((e=>uo.includes(e.id)||e.id.startsWith(V.rc))).map((e=>({value:e.id,renderValue:()=>{var s;return null!==(s=e.filterLabel)&&void 0!==s?s:e.label}})));return e.push({value:$.w8.TAG,renderValue:()=>$.RF[$.w8.TAG]},{value:$.w8.ASSESSMENT,renderValue:()=>$.RF[$.w8.ASSESSMENT]}),e.push({value:V.k0,renderValue:()=>"Span content"},{value:V.Gq,renderValue:()=>"Span name"},{value:V.Rb,renderValue:()=>"Span type"}),e}),[i]);return(0,k.Y)(k.FK,{children:(0,k.FD)("div",{css:(0,S.AH)({display:"flex",flexDirection:"row",gap:u.spacing.sm},""),children:[(0,k.FD)("div",{css:po,children:[(0,k.Y)(C.FormUI.Label,{htmlFor:`filter-column-${s}`,children:(0,k.Y)(_.sA,{id:"OlytgO",defaultMessage:"Field"})}),(0,k.Y)(io,{id:`filter-column-${s}`,item:g.find((e=>e.value===r)),options:g,onChange:e=>{if(e!==r){const n=mo(e)[0];t({column:e,operator:n,value:""},s)}},placeholder:"Select column",width:180,canSearchCustomValue:!1})]}),r===$.w8.ASSESSMENT&&(0,k.FD)("div",{css:go,children:[(0,k.Y)(C.FormUI.Label,{htmlFor:`filter-key-${s}`,children:(0,k.Y)(_.sA,{id:"lK4Ay3",defaultMessage:"Name"})}),(0,k.Y)(io,{id:`filter-key-${s}`,item:p.find((e=>e.value===c)),options:p,onChange:n=>{t({...e,key:n},s)},placeholder:"Select name",width:200,canSearchCustomValue:!1})]}),r===$.w8.TAG&&(0,k.FD)("div",{css:vo,children:[(0,k.Y)(C.FormUI.Label,{htmlFor:`filter-key-${s}`,children:(0,k.Y)(_.sA,{id:"gST1At",defaultMessage:"Key"})}),(0,k.Y)(T.I,{"aria-label":"Key",componentId:"mlflow.evaluations_review.table_ui.filter_key",id:"filter-key-"+s,type:"text",css:ho,placeholder:r===$.w8.TAG?"Key":"Name",value:c,onChange:n=>{t({...e,key:n.target.value},s)}})]}),(0,k.FD)("div",{css:fo,children:[(0,k.Y)(C.FormUI.Label,{htmlFor:`filter-operator-${s}`,children:(0,k.Y)(_.sA,{id:"W6Sqio",defaultMessage:"Operator"})}),(()=>{const n=""!==r&&1===mo(r).length;return(0,k.Y)(C.SimpleSelect,{"aria-label":"Operator",componentId:"mlflow.evaluations_review.table_ui.filter_operator",id:"filter-operator-"+s,placeholder:"Select",width:120,contentProps:{style:{zIndex:u.options.zIndexBase+100}},value:n?mo(r)[0]:d,disabled:n,onChange:n=>{t({...e,operator:n.target.value},s)},children:mo(r).map((e=>(0,k.Y)(C.SimpleSelectOption,{value:e,children:e},e)))})})()]}),(0,k.FD)("div",{css:yo,children:[(0,k.Y)(C.FormUI.Label,{htmlFor:`filter-value-${s}`,children:(0,k.Y)(_.sA,{id:"6JOLpj",defaultMessage:"Value"})}),(0,k.Y)(co,{index:s,tableFilter:e,assessmentInfos:o,onChange:t,experimentId:a,tableFilterOptions:l})]}),(0,k.Y)("div",{css:wo,children:(0,k.Y)(A.B,{componentId:"mlflow.evaluations_review.table_ui.filter_delete_button",type:"tertiary",icon:(0,k.Y)(C.CloseSmallIcon,{}),onClick:n})})]})})};const xo=({filters:e,setFilters:s,assessmentInfos:t,experimentId:n,tableFilterOptions:o,allColumns:a,isMetadataLoading:l,metadataError:i})=>{const r=(0,_.tz)(),{theme:d}=(0,A.u)(),c=e.length>0,u=(0,m.useCallback)((()=>{s([])}),[s]);return(0,k.FD)(A.aw.Root,{componentId:xn,children:[(0,k.Y)(A.aw.Trigger,{asChild:!0,children:(0,k.Y)(A.B,{endIcon:(0,k.Y)(C.ChevronDownIcon,{}),componentId:"mlflow.evaluations_review.table_ui.filter_button",css:(0,S.AH)({border:c?`1px solid ${d.colors.actionDefaultBorderFocus} !important`:"",backgroundColor:c?`${d.colors.actionDefaultBackgroundHover} !important`:""},""),children:(0,k.FD)("div",{css:(0,S.AH)({display:"flex",gap:d.spacing.sm,alignItems:"center"},""),children:[(0,k.Y)(C.FilterIcon,{}),r.formatMessage({id:"J961B2",defaultMessage:"Filters{numFilters}"},{numFilters:c?` (${e.length})`:""}),c&&(0,k.Y)(T.X,{css:(0,S.AH)({fontSize:12,cursor:"pointer",color:d.colors.grey400,"&:hover":{color:d.colors.grey600}},""),onClick:()=>{u()}})]})})}),(0,k.Y)(A.aw.Content,{align:"start",css:(0,S.AH)({padding:d.spacing.md},""),children:i?(0,k.FD)("div",{css:(0,S.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:d.spacing.xs,padding:`${d.spacing.md}px`,color:d.colors.textValidationDanger},""),"data-testid":"filter-dropdown-error",children:[(0,k.Y)(A.k,{}),(0,k.Y)(_.sA,{id:"dJaboT",defaultMessage:"Fetching traces failed"})]}):l?(0,k.Y)("div",{css:(0,S.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:d.spacing.xs,padding:`${d.spacing.md}px`,color:d.colors.textSecondary},""),"data-testid":"filter-dropdown-loading",children:(0,k.Y)(A.S,{size:"small"})}):(0,k.Y)(So,{filters:e,assessmentInfos:t,setFilters:s,experimentId:n,tableFilterOptions:o,allColumns:a})})]})};var Io={name:"skgbeu",styles:"display:flex;justify-content:flex-end"},Yo={name:"skgbeu",styles:"display:flex;justify-content:flex-end"};const So=({filters:e,assessmentInfos:s,setFilters:t,experimentId:n,tableFilterOptions:o,allColumns:a})=>{const{theme:l}=(0,A.u)(),i=(e=>(0,oo.mN)({defaultValues:{filters:e.length>0?e:[{column:"",operator:$.tl.EQUALS,value:""}]}}))(e),{setValue:r,watch:d}=i,c=d("filters");return(0,k.Y)(oo.Op,{...i,children:(0,k.FD)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",gap:l.spacing.lg,overflow:"auto"},""),children:[(0,k.Y)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",gap:l.spacing.sm},""),children:c.map(((e,t)=>(0,k.Y)(bo,{tableFilter:e,index:t,onChange:e=>{c[t]=e,r("filters",c)},onDelete:()=>{const e=[...c];e.splice(t,1),0===e.length&&e.push({column:"",operator:$.tl.EQUALS,value:""}),r("filters",e)},assessmentInfos:s,experimentId:n,tableFilterOptions:o,allColumns:a},e.column+e.operator+e.value+t)))}),(0,k.Y)("div",{children:(0,k.Y)(A.B,{componentId:"mlflow.evaluations_review.table_ui.add_filter_button",icon:(0,k.Y)(C.PlusIcon,{}),onClick:()=>{r("filters",[...c,{column:"",operator:$.tl.EQUALS,value:""}])},children:(0,k.Y)(_.sA,{id:"cHgTsd",defaultMessage:"Add filter"})})}),(0,k.Y)("div",{css:Io,children:(0,k.Y)(A.B,{componentId:"mlflow.evaluations_review.table_ui.apply_filters_button",type:"primary",onClick:()=>t(c),css:Yo,children:(0,k.Y)(_.sA,{id:"iZ0M1Y",defaultMessage:"Apply filters"})})})]})})},Ao=e=>e===$.w8.INFO?"Attributes":$.RF[e],Co=({columns:e=[],selectedColumns:s=[],toggleColumns:t,setSelectedColumns:n,isMetadataLoading:o=!1,metadataError:a})=>{const l=(0,_.tz)(),{theme:i}=(0,A.u)(),[r,d]=(0,m.useState)(""),c=(0,m.useMemo)((()=>{const s=q(e),t={};return s.forEach((e=>{var s;const n=null!==(s=e.group)&&void 0!==s?s:$.w8.INFO;t[n]||(t[n]=[]),t[n].push(e)})),t}),[e]),u=(0,m.useMemo)((()=>{if(!r.trim())return c;const e=r.trim().toLowerCase(),s={};return Object.entries(c).forEach((([t,n])=>{const o=Ao(t).toLowerCase().includes(e),a=n.filter((s=>s.label.toLowerCase().includes(e)));(o||a.length)&&(s[t]=o?n:a)})),s}),[c,r]);return(0,k.FD)(C.DialogCombobox,{componentId:In,label:"Columns",multiSelect:!0,children:[(0,k.Y)(C.DialogComboboxCustomButtonTriggerWrapper,{children:(0,k.Y)(A.B,{endIcon:(0,k.Y)(C.ChevronDownIcon,{}),"data-testid":"column-selector-button",componentId:"mlflow.evaluations_review.table_ui.filter_button",children:(0,k.FD)("div",{css:(0,S.AH)({display:"flex",gap:i.spacing.sm,alignItems:"center"},""),children:[(0,k.Y)(C.ColumnsIcon,{}),l.formatMessage({id:"wjOGl2",defaultMessage:"Columns"})]})})}),(0,k.Y)(C.DialogComboboxContent,{maxHeight:496,minWidth:300,maxWidth:500,loading:o&&!a,children:a?(0,k.FD)("div",{css:(0,S.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:i.spacing.xs,padding:`${i.spacing.md}px`,color:i.colors.textValidationDanger},""),"data-testid":"filter-dropdown-error",children:[(0,k.Y)(A.k,{}),(0,k.Y)(_.sA,{id:"dJaboT",defaultMessage:"Fetching traces failed"})]}):(0,k.Y)(C.DialogComboboxOptionList,{children:(0,k.Y)(C.DialogComboboxOptionListSearch,{controlledValue:r,setControlledValue:d,children:Object.entries(u).map((([e,o])=>(0,k.FD)(m.Fragment,{children:[(0,k.Y)(C.DialogComboboxSectionHeader,{children:Ao(e)}),(0,k.Y)(C.DialogComboboxOptionListCheckboxItem,{value:`all-${e}`,checked:o.every((e=>s.some((s=>s.id===e.id)))),onChange:()=>(e=>{if(e.every((e=>s.some((s=>s.id===e.id))))){const t=s.filter((s=>!e.some((e=>e.id===s.id))));n(t)}else{const t=[...s];e.forEach((e=>{t.some((s=>s.id===e.id))||t.push(e)})),n(t)}})(o),children:l.formatMessage({id:"RXL0a5",defaultMessage:"All {groupLabel}"},{groupLabel:Ao(e)})}),o.map((e=>(0,k.Y)(C.DialogComboboxOptionListCheckboxItem,{value:e.label,checked:s.some((s=>s.id===e.id)),onChange:()=>t([e]),children:e.label},e.id)))]},e)))})})})]})};var To={name:"13qopiv",styles:"margin-bottom:0;flex:1"};const Ro=m.memo((e=>{const{searchQuery:s,setSearchQuery:t,filters:n,setFilters:o,tableSort:a,setTableSort:l,selectedColumns:i,toggleColumns:r,setSelectedColumns:d,assessmentInfos:c,experimentId:u,traceInfos:p,tableFilterOptions:g,traceActions:v,allColumns:h,countInfo:f,isMetadataLoading:y,metadataError:w}=e,{theme:b}=(0,A.u)(),x=(0,m.useCallback)(((e,s)=>{l({key:e.key,type:e.type,asc:s})}),[l]);return(0,k.FD)("div",{css:(0,S.AH)({display:"flex",width:"100%",alignItems:"flex-end",gap:b.spacing.sm,paddingBottom:`${b.spacing.xs}px`},""),children:[(0,k.FD)(C.TableFilterLayout,{css:To,children:[(0,k.Y)(wn,{searchQuery:s,setSearchQuery:t}),(0,k.Y)(xo,{filters:n,setFilters:o,assessmentInfos:c,experimentId:u,tableFilterOptions:g,allColumns:h,isMetadataLoading:y,metadataError:w}),(0,k.Y)(An,{tableSort:a,columns:i,onChange:x,enableGrouping:(0,D.ij)(),isMetadataLoading:y,metadataError:w}),(0,k.Y)(Co,{columns:h,selectedColumns:i,toggleColumns:r,setSelectedColumns:d,isMetadataLoading:y,metadataError:w}),v&&(0,k.Y)(O,{experimentId:u,traceActions:v,traceInfos:p})]}),(0,k.Y)(_o,{countInfo:f})]})})),_o=e=>{const{countInfo:s}=e,t=(0,_.tz)(),{theme:o}=(0,A.u)();return s.logCountLoading||(0,n.isNil)(s.currentCount)?(0,k.Y)(A.S,{size:"small"}):(0,k.FD)("div",{css:(0,S.AH)({display:"flex",alignItems:"center",gap:o.spacing.sm},""),children:[s.currentCount>=s.maxAllowedCount&&(0,k.Y)(R.T,{componentId:"mlflow.experiment_list_view.max_traces.tooltip",content:t.formatMessage({id:"BpAyCF",defaultMessage:"Only the top {evalResultsCount} results are shown"},{evalResultsCount:s.maxAllowedCount}),children:(0,k.Y)(A.W,{color:"warning"})}),(0,k.Y)(A.T.Hint,{children:t.formatMessage({id:"FnOQ44",defaultMessage:"{numFilteredEvals} of {numEvals}"},{numFilteredEvals:s.currentCount>=s.maxAllowedCount?s.maxAllowedCount:s.currentCount,numEvals:s.totalCount>=s.maxAllowedCount?`${s.maxAllowedCount}+`:s.totalCount})})]})};var ko={name:"kj840c",styles:"flex:1;overflow-y:hidden;position:relative"};const No=m.memo((e=>{const{experimentId:s,currentTraceInfoV3:t,compareToTraceInfoV3:n,currentRunDisplayName:o,runUuid:a,compareToRunUuid:l,compareToRunDisplayName:i,setFilters:r,filters:d,selectedColumns:c,tableSort:u,assessmentInfos:p,getTrace:g,onTraceTagsEdit:v,allColumns:h,getRunColor:f,enableRowSelection:y=!0,displayLoadingOverlay:w=!1}=e,{theme:b}=(0,A.u)(),x=(0,m.useMemo)((()=>(0,F.Co)(t.map((e=>({evaluationId:e.trace_id,requestId:e.client_request_id||e.trace_id,inputsId:e.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:e}))))),[t]),I=(0,m.useMemo)((()=>(0,F.Co)((n||[]).map((e=>({evaluationId:e.trace_id,requestId:e.client_request_id||e.trace_id,inputsId:e.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:e}))))),[n]),[Y,C]=(0,m.useState)({}),T=(0,m.useCallback)(((e,s,t)=>{const n=d.find((s=>s.column===$.w8.ASSESSMENT&&s.key===e));void 0===n?r([...d,{column:$.w8.ASSESSMENT,key:e,operator:$.tl.EQUALS,value:s}]):n.value===s?r(d.filter((s=>!(s.column===$.w8.ASSESSMENT&&s.key===e)))):r(d.map((t=>t.column===$.w8.ASSESSMENT&&t.key===e?{column:$.w8.ASSESSMENT,key:e,operator:$.tl.EQUALS,value:s}:t)))}),[d,r]),R=(0,m.useMemo)((()=>d.filter((e=>e.column===$.w8.ASSESSMENT)).map((e=>({assessmentName:e.key||"",filterValue:e.value,run:o||F.kf})))),[d,o]),[_,N]=En(),M=(0,m.useMemo)((()=>{const e=c.filter((e=>e.type===$.$6.ASSESSMENT)).map((e=>e.assessmentInfo));return(0,ts.aE)(e)}),[c]),E=(0,m.useMemo)((()=>G(x,I)),[x,I]),O=(0,m.useMemo)((()=>x.flatMap((e=>{var s,t;return null!==(s=null===e||void 0===e||null===(t=e.traceInfo)||void 0===t?void 0:t.assessments)&&void 0!==s?s:[]}))),[x]);return(0,k.Y)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",gap:b.spacing.xs,overflow:"hidden",flexGrow:1},""),children:(0,k.Y)("div",{css:(0,S.AH)({display:"flex",gap:b.spacing.md,width:"100%",flex:1,overflowY:"hidden"},""),children:(0,k.Y)("div",{css:ko,children:(0,k.Y)(ee.AssessmentSchemaContextProvider,{assessments:O,children:(0,k.Y)(yn,{experimentId:s,selectedColumns:c,allColumns:h,evaluations:E,selectedEvaluationId:_,selectedAssessmentInfos:M,assessmentInfos:p,assessmentFilters:R,onChangeEvaluationId:N,getRunColor:f,runUuid:a,compareToRunUuid:l,runDisplayName:o,compareToRunDisplayName:i,enableRowSelection:y,rowSelection:Y,setRowSelection:C,toggleAssessmentFilter:T,tableSort:u,getTrace:g,onTraceTagsEdit:v,enableGrouping:(0,D.ij)(),displayLoadingOverlay:w})})})})})})),Mo="filter",Eo=()=>{const[e,s]=h();return[(0,m.useMemo)((()=>{var s;return(null!==(s=e.getAll(Mo))&&void 0!==s?s:[]).reduce(((e,s)=>{const[t,n,o,a]=s.split("::");if(!t||!n||!o)return e;const l=n;let i=o;return t===$.w8.ASSESSMENT&&(i=w(o)),e.push({column:t,key:a,operator:l,value:i}),e}),[])}),[e]),(0,m.useCallback)(((e,t=!1)=>{s((s=>(s.delete(Mo),e&&e.forEach((e=>{let t=e.value;e.column===$.w8.ASSESSMENT&&(t=x(e.value)),s.append(Mo,[e.column,e.operator,t,e.key].join("::"))})),s)),{replace:t})}),[s])]};var Do=t(93846);const Fo=(e,s)=>s.filter((s=>!e.includes(s))).map((e=>e.id)),Oo=(e,s)=>{let t=((e,s)=>s.filter((s=>!e.includes(s.id))))(e,s);if(t.length>10){const e=t.filter((e=>e.type===$.$6.ASSESSMENT)),s=t.filter((e=>e.type!==$.$6.ASSESSMENT)),n=t.length-10,o=Math.max(0,e.length-n);t=[...s,...e.slice(0,o)]}return Fo(t,s)},Ho=(e,s,t,n)=>{const[o,a]=(0,Do.Mj)({key:`genaiTracesUIState-columns-${e}-${n}`,version:1,initialValue:void 0}),l=(0,m.useMemo)((()=>((e,s)=>Oo(s?Fo(s(e),e):[V.LV,V.FW,V.tj,V.$W],e))(s,t)),[s,t]);return{hiddenColumns:(0,m.useMemo)((()=>{const e=new Set(l);return null!==o&&void 0!==o&&o.columnOverrides?(Object.entries(o.columnOverrides).forEach((([s,t])=>{t?e.delete(s):e.add(s)})),[...e]):l}),[o,l]),toggleColumns:(0,m.useCallback)((e=>{e.length&&a((s=>{var t;const n=null!==(t=null===s||void 0===s?void 0:s.columnOverrides)&&void 0!==t?t:{},o={...n};let a=!1;return e.forEach((e=>{const s=e.id in n?!n[e.id]:l.includes(e.id);o[e.id]!==s&&(o[e.id]=s,a=!0)})),a?{...s,columnOverrides:o}:s}))}),[a,l])}},Vo=(e,s,t,o)=>{const{hiddenColumns:a,toggleColumns:l}=Ho(e,s,t,o),i=(0,m.useMemo)((()=>s.filter((e=>!a.includes(e.id)))),[s,a]),r=(0,m.useCallback)((e=>{if((0,n.isNil)(e))return;const t=new Set(e.map((e=>e.id))),o=[];s.forEach((e=>{!a.includes(e.id)!==t.has(e.id)&&o.push(e)})),o.length&&l(o)}),[s,a,l]);return{selectedColumns:i,toggleColumns:l,setSelectedColumns:r}};const $o=e=>({type:"MLFLOW_EXPERIMENT",mlflow_experiment:{experiment_id:e}});t(59930);var Lo={name:"1gw6v2o",styles:"max-width:100%;overflow:hidden"};const Bo=(e,s)=>{const t=(e=>{const s={};return e.forEach((e=>{var t,n;const o=null===(t=e.trace_metadata)||void 0===t?void 0:t[ee.SESSION_ID_METADATA_KEY];if(!o)return;const a=null!==(n=s[o])&&void 0!==n?n:[];s[o]=[...a,e]})),s})(s);return(0,n.compact)(Object.entries(t).map((([s,t])=>{if(0===t.length)return null;const o=(0,n.sortBy)(t,(e=>new Date(e.request_time))),a=o[0],l=a.request_preview,i=o.reduce(((e,s)=>{var t;return e+(null!==(t=(0,ee.getTotalTokens)(s))&&void 0!==t?t:0)}),0);return{sessionId:s,requestPreview:l,firstTrace:a,experimentId:e,sessionStartTime:ge.formatTimestamp(new Date(a.request_time)),sessionDuration:zo(t),tokens:i,turns:o.length}})))},zo=e=>{const s=e.map((e=>e.execution_duration));if(s.some((e=>(0,n.isNil)(e))))return null;const t=s.map((e=>parseFloat(null!==e&&void 0!==e?e:"0")));if(t.some((e=>isNaN(e))))return null;const o=1e3*t.reduce(((e,s)=>e+s),0);return ge.formatDuration(o)};var Uo=t(40724);const jo=({columns:e,columnVisibility:s,setColumnVisibility:t})=>{const{theme:n}=(0,A.u)();return(0,k.Y)("div",{css:(0,S.AH)({display:"flex",gap:n.spacing.sm},""),children:(0,k.FD)(C.DialogCombobox,{componentId:"mlflow.chat-sessions.table-column-selector",label:(0,k.FD)("div",{css:(0,S.AH)({display:"flex",gap:n.spacing.sm,alignItems:"center"},""),children:[(0,k.Y)(C.ColumnsIcon,{}),(0,k.Y)(Uo.A,{id:"RWVGkL",defaultMessage:"Columns"})]}),multiSelect:!0,children:[(0,k.Y)(C.DialogComboboxTrigger,{}),(0,k.Y)(C.DialogComboboxContent,{children:(0,k.Y)(C.DialogComboboxOptionList,{children:Object.entries(s).map((([n,o])=>{var a;return(0,k.Y)(C.DialogComboboxOptionListCheckboxItem,{value:n,onChange:()=>{const e={...s};e[n]=!o,t(e)},checked:o,children:null===(a=e.find((e=>e.id===n)))||void 0===a?void 0:a.header},n)}))})})]})})},Po=e=>{const{cell:s}=e,t=s.getValue();return(0,k.Y)(C.Tag,{componentId:"mlflow.genai-traces-table.session-tokens",children:t})};var qo=t(30676);const Ko='import mlflow\n\n@mlflow.trace\ndef chat_completion(message: str, user_id: str, session_id: str):\n    # Set these metadata keys to associate the trace to a user and session\n    mlflow.update_current_trace(\n        metadata={\n            "mlflow.trace.user": user_id,\n            "mlflow.trace.session": session_id,\n        }\n    )\n\n    # Replace with your chat logic\n    return "Your response here"\n\n# Depending on your setup, user and session IDs can be passed to your\n# server handler via the network request from your client applications,\n# or derived from some other request context. \nuser_id = "user-123"\nsession_id = "session-123"\n\nchat_completion("Hello, how are you?", user_id, session_id)';var Wo={name:"1blwlv5",styles:"flex:1;flex-direction:column;display:flex;align-items:center;justify-content:center"},Qo={name:"xvginl",styles:"max-width:600px"},Go={name:"bjn8wh",styles:"position:relative"};const Jo=()=>{const{theme:e}=(0,A.u)();return(0,k.FD)("div",{css:Wo,children:[(0,k.Y)(A.T.Title,{level:3,color:"secondary",children:(0,k.Y)(Uo.A,{id:"Qsifda",defaultMessage:"Group traces from the same chat session together"})}),(0,k.FD)(A.T.Paragraph,{color:"secondary",css:Qo,children:[(0,k.Y)(Uo.A,{id:"hkXDZn",defaultMessage:"MLflow allows you associate traces with users and chat sessions. This is useful for analyzing multi-turn conversations, enabling you to inspect what happened at each step. Copy the code snippet below to generate a sample trace, or visit the documentation for a more in-depth example."}),(0,k.Y)(A.T.Link,{componentId:"mlflow.chat_sessions.empty_state.learn_more_link",css:(0,S.AH)({marginLeft:e.spacing.xs},""),href:"https://mlflow.org/docs/latest/genai/tracing/track-users-sessions/",openInNewTab:!0,children:(0,k.Y)(Uo.A,{id:"h2Ejm7",defaultMessage:"Learn more"})})]}),(0,k.FD)("div",{css:Go,children:[(0,k.Y)(qo.VE,{componentId:"mlflow.chat_sessions.empty_state.example_code_copy",css:(0,S.AH)({position:"absolute",top:e.spacing.xs,right:e.spacing.xs},""),copyText:Ko}),(0,k.Y)(qo.z7,{language:"python",showLineNumbers:!0,children:Ko})]})]})},Zo=[{id:"sessionId",header:"Session ID",accessorKey:"sessionId",cell:({row:e})=>{const s=e.original.sessionId;return(0,k.Y)(C.Tag,{componentId:"mlflow.chat-sessions.session-id-tag",color:"indigo",css:Lo,children:(0,k.Y)(A.T.Text,{ellipsis:!0,children:s})})},defaultVisibility:!0,enableSorting:!0,sortingFn:(e,s)=>e.original.sessionId.localeCompare(s.original.sessionId)},{id:"requestPreview",header:"Input",accessorKey:"requestPreview",defaultVisibility:!0},{id:"sessionStartTime",header:"Session start time",accessorKey:"sessionStartTime",defaultVisibility:!0,enableSorting:!0},{id:"sessionDuration",header:"Session duration",accessorKey:"sessionDuration",defaultVisibility:!0,enableSorting:!0},{id:"tokens",header:"Tokens",accessorKey:"tokens",defaultVisibility:!1,enableSorting:!0,cell:Po},{id:"turns",header:"Turns",accessorKey:"turns",defaultVisibility:!1,enableSorting:!0,cell:Po},{id:"source",header:"Source",cell:({row:e})=>{const s=e.original.firstTrace;return(0,k.Y)(Te,{traceInfo:s,isComparing:!1})},defaultVisibility:!1}],Xo=m.memo((({row:e})=>{const{search:s}=v();return(0,k.Y)(f,{to:{pathname:ge.getExperimentChatSessionPageRoute(e.original.experimentId,e.original.sessionId),search:s},children:(0,k.Y)(C.TableRow,{className:"eval-datasets-table-row",children:e.getVisibleCells().map((e=>(0,k.Y)(C.TableCell,{css:(0,S.AH)({backgroundColor:"transparent",flex:`calc(var(--col-${e.column.id}-size) / 100)`,..."actions"===e.column.id&&{paddingLeft:0,paddingRight:0}},""),children:(0,J.Kv)(e.column.columnDef.cell,e.getContext())},e.id)))},e.id)})}),(()=>!1)),ea=({experimentId:e,traces:s,isLoading:t})=>{(0,_.tz)();const{theme:n}=(0,A.u)(),o=(0,m.useMemo)((()=>Bo(e,s)),[e,s]),[a,l]=(0,m.useState)([{id:"sessionStartTime",desc:!0}]),{columnVisibility:i,setColumnVisibility:r}=(({experimentId:e,columns:s})=>{const t=(0,m.useMemo)((()=>s.reduce(((e,s)=>(e[s.id]=s.defaultVisibility,e)),{})),[s]),[n,o]=(0,Do.Mj)({key:`experiment-chat-sessions-table-column-visibility-${e}`,version:1,initialValue:t});return{columnVisibility:n,setColumnVisibility:o}})({experimentId:e,columns:Zo}),d=(0,J.N4)({data:o,columns:Zo,getCoreRowModel:(0,Z.HT)(),getSortedRowModel:(0,Z.h5)(),onSortingChange:l,enableColumnResizing:!0,columnResizeMode:"onChange",state:{sorting:a,columnVisibility:i}}),c=d.getState().columnSizingInfo,u=m.useMemo((()=>{const e=d.getFlatHeaders(),s={};for(const t of e)s[`--col-${t.column.id}-size`]=t.column.getSize();return s}),[c,d,i]);return(0,k.FD)("div",{css:(0,S.AH)({display:"flex",flexDirection:"column",flex:1,minHeight:0,position:"relative",marginTop:n.spacing.sm},""),children:[(0,k.Y)(jo,{columns:Zo,columnVisibility:i,setColumnVisibility:r}),(0,k.FD)(C.Table,{style:{...u},empty:t||0!==o.length?void 0:(0,k.Y)(Jo,{}),scrollable:!0,children:[(0,k.Y)(C.TableRow,{isHeader:!0,children:d.getLeafHeaders().map((e=>(0,k.Y)(C.TableHeader,{componentId:`mlflow.chat-sessions.${e.column.id}-header`,header:e,column:e.column,sortable:e.column.getCanSort(),css:(0,S.AH)({cursor:e.column.getCanSort()?"pointer":"default",flex:`calc(var(--col-${e.id}-size) / 100)`},""),sortDirection:e.column.getIsSorted()||"none",onToggleSort:e.column.getToggleSortingHandler(),children:(0,J.Kv)(e.column.columnDef.header,e.getContext())},e.id)))}),!t&&d.getRowModel().rows.map((e=>(0,k.Y)(Xo,{row:e},e.id))),t&&(0,k.Y)(C.TableSkeletonRows,{table:d})]})]})};function sa(e){var s;return(0,ee.isV3ModelTraceInfo)(e)?e.trace_id:null!==(s=e.request_id)&&void 0!==s?s:""}function ta(e,s){const t=(0,m.useMemo)((()=>s?s.map(sa):[]),[s]);return(0,se.I)({queryKey:["getTrace",t],queryFn:async()=>{const t=await Promise.all((null!==s&&void 0!==s?s:[]).map((s=>null===e||void 0===e?void 0:e(sa(s),s))));return(0,n.compact)(t)},enabled:!(0,n.isNil)(e)&&t.length>0,refetchOnWindowFocus:!1,retry:1,keepPreviousData:!0})}}}]);