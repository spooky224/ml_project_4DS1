"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[8906],{5029:function(e,t,s){s.d(t,{R:function(){return o}});s(46709);var n=s(884),a=s(64836),r=s(87307),i=s(73408);function o({index:e,rules:t,render:s}){const{name:o,keyProperty:l,getTagsValues:d,emptyValue:c,appendIfPossible:u}=(0,r.Y7)();return(0,i.Y)(n.xI,{name:`${o}.${e}.${l}`,rules:t,render:({field:e,fieldState:t,formState:n})=>{var r;const o=e.onChange;return e.onChange=function(e){var t;o(e);const s=d();null!==s&&void 0!==s&&null!==(t=s.at(-1))&&void 0!==t&&t[l]&&u(c,{shouldFocus:!1})},s?s({field:e,fieldState:t,formState:n}):(0,i.Y)(a.w,{componentId:"TagAssignmentKey.Default.Input",errorMessage:null===(r=t.error)||void 0===r?void 0:r.message,...e})}})}},9599:function(e,t,s){s.d(t,{p:function(){return Y}});var n=s(46709),a=s(68248),r=s(27757),i=s(74060),o=s(42747),l=s(73879),d=s(79081),c=s(73408);const u=e=>e?{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}:{whiteSpace:"nowrap"},p=({itemKey:e,itemValue:t,charLimit:s=18,maxWidth:n=150,className:o})=>{const{shouldTruncateKey:l,shouldTruncateValue:p}=function(e,t,s){const n=e.length+t.length,a=e.length>t.length,r=a?t.length:e.length;return n<=s?{shouldTruncateKey:!1,shouldTruncateValue:!1}:r>s/2?{shouldTruncateKey:!0,shouldTruncateValue:!0}:{shouldTruncateKey:a,shouldTruncateValue:!a}}(e,t,s);return(0,c.Y)(d.T,{componentId:"shared.model-trace-explorer.key-value-tag.hover-tooltip",content:`${e}: ${t}`,children:(0,c.Y)(i.Tag,{componentId:"shared.model-trace-explorer.key-value-tag",className:o,children:(0,c.FD)("span",{css:(0,a.AH)({maxWidth:n,display:"inline-flex"},""),children:[(0,c.Y)(r.T.Text,{bold:!0,css:u(l),size:"sm",children:e}),":\xa0",(0,c.Y)(r.T.Text,{css:u(p),size:"sm",children:t})]})})})};var m={name:"1fttcpj",styles:"display:flex;flex-direction:column"};function g({text:e,metadataTags:t,setExpanded:s,logDocumentClick:n}){const{theme:d}=(0,r.u)();return(0,c.FD)("div",{css:m,children:[(0,c.Y)("div",{role:"button",onClick:()=>{s(!1),null===n||void 0===n||n("collapse")},css:(0,a.AH)({display:"flex",flexDirection:"row",alignItems:"center",cursor:"pointer",padding:`${d.spacing.sm}px ${d.spacing.md}px`,height:d.typography.lineHeightBase,boxSizing:"content-box","&:hover":{backgroundColor:d.colors.backgroundSecondary}},""),children:(0,c.Y)(i.FileDocumentIcon,{})}),(0,c.Y)("div",{css:(0,a.AH)({padding:d.spacing.md,paddingBottom:0},""),children:(0,c.Y)(l.V,{children:e})}),(0,c.Y)("div",{css:(0,a.AH)({padding:d.spacing.md,paddingTop:0},""),children:t.map((({key:e,value:t})=>(0,c.Y)(p,{itemKey:e,itemValue:t},e)))}),(0,c.Y)(r.B,{css:(0,a.AH)({width:"100%",padding:d.spacing.sm},""),componentId:"shared.model-trace-explorer.retriever-document-collapse",icon:(0,c.Y)(i.ChevronUpIcon,{}),type:"tertiary",onClick:()=>s(!1),children:(0,c.Y)(o.sA,{id:"AgjhWE",defaultMessage:"See less"})})]})}var h={name:"ti75j2",styles:"margin:0"},f={name:"1r5gb7q",styles:"display:inline-block"},v={name:"1tma7dt",styles:"white-space:nowrap;margin:0"};function x({text:e,metadataTags:t,setExpanded:s,logDocumentClick:n}){const{theme:o}=(0,r.u)();return(0,c.FD)("div",{role:"button",onClick:()=>{s(!0),null===n||void 0===n||n("expand")},css:(0,a.AH)({display:"flex",flexDirection:"row",padding:`${o.spacing.sm}px ${o.spacing.md}px`,gap:o.spacing.sm,alignItems:"center",justifyContent:"space-between",cursor:"pointer","&:hover":{backgroundColor:o.colors.backgroundSecondary}},""),children:[(0,c.FD)("div",{css:(0,a.AH)({display:"flex",flexDirection:"row",gap:o.spacing.sm,alignItems:"center",minWidth:0,flexShrink:1},""),children:[(0,c.Y)(i.FileDocumentIcon,{}),(0,c.Y)(r.T.Text,{ellipsis:!0,size:"md",children:e})]}),(0,c.FD)("div",{css:(0,a.AH)({display:"flex",flexDirection:"row",gap:o.spacing.sm},""),children:[t.length>0?(0,c.Y)(p,{css:h,itemKey:t[0].key,itemValue:t[0].value}):null,t.length>1?(0,c.Y)(d.T,{componentId:"shared.model-trace-explorer.tag-count.hover-tooltip",content:t.slice(1).map((({key:e,value:t})=>(0,c.Y)("span",{css:f,children:`${e}: ${t}`},e))),children:(0,c.FD)(i.Tag,{componentId:"shared.model-trace-explorer.tag-count",css:v,children:["+",t.length-1]})}):null]})]})}var y=s(86125);function Y({text:e,metadata:t}){const[s,a]=(0,n.useState)(!1),r=(0,y.g_)(t);return s?(0,c.Y)(g,{text:e,metadataTags:r,setExpanded:a}):(0,c.Y)(x,{text:e,metadataTags:r,setExpanded:a})}},14905:function(e,t,s){s.d(t,{a:function(){return ms}});var n=s(68248),a=s(46709),r=s(89949),i=s(27757),o=s(74060),l=s(42747),d=s(27882),c=s(86125),u=s(76118),p=s(26059),m=s(27556),g=s(66916),h=s(73408);var f={name:"2wv1be",styles:"width:100%;box-sizing:border-box"};var v=({searchFilter:e,setSearchFilter:t,matchData:s,handleNextSearchMatch:r,handlePreviousSearchMatch:l})=>{const[d,c]=(0,a.useState)(e),u=(0,m.YQ)(t,350),{theme:p}=(0,i.u)();return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",gap:p.spacing.sm},""),children:[(0,h.Y)(g.I,{componentId:"shared.model-trace-explorer.search-input",allowClear:!0,placeholder:"Search",value:d,onClear:()=>{t(""),c("")},onChange:e=>{c(e.target.value),u(e.target.value.toLowerCase())},prefix:(0,h.Y)(g.S,{}),css:f}),s.match&&(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",marginLeft:p.spacing.xs,marginRight:p.spacing.sm,alignItems:"center"},""),children:[(0,h.FD)(i.T.Text,{css:(0,n.AH)({whiteSpace:"nowrap",marginRight:p.spacing.sm},""),children:[s.currentMatchIndex+1," / ",s.totalMatches]}),(0,h.Y)(i.B,{"data-testid":"prev-search-match",icon:(0,h.Y)(o.ChevronUpIcon,{}),onClick:l,componentId:"shared.model-trace-explorer.prev-search-match"}),(0,h.Y)(i.B,{"data-testid":"next-search-match",icon:(0,h.Y)(o.ChevronDownIcon,{}),onClick:r,componentId:"shared.model-trace-explorer.next-search-match"})]})]})},x=s(81390);const y=(0,a.createContext)({rootNode:null,nodeMap:{},activeView:"summary",setActiveView:()=>{},selectedNode:void 0,setSelectedNode:()=>{},activeTab:"content",setActiveTab:()=>{},showTimelineTreeGantt:!1,setShowTimelineTreeGantt:()=>{},assessmentsPaneExpanded:!1,setAssessmentsPaneExpanded:()=>{},assessmentsPaneEnabled:!0}),Y=()=>(0,a.useContext)(y),b=({modelTrace:e,initialActiveView:t,selectedSpanIdOnRender:s,assessmentsPaneEnabled:n,children:r})=>{var i,o,l;const d=(0,a.useMemo)((()=>(0,c.jW)(e)),[e]),p=(0,a.useMemo)((()=>d?(0,x.dM)([d]):{}),[d]),m=(0,c.f7)(d,s),g=null!==(i=null!==m&&void 0!==m?m:d)&&void 0!==i?i:void 0,f=(null!==(o=null===g||void 0===g||null===(l=g.assessments)||void 0===l?void 0:l.length)&&void 0!==o?o:0)>0,v=!(0,u.isNil)(null===d||void 0===d?void 0:d.inputs)||!(0,u.isNil)(null===d||void 0===d?void 0:d.outputs),[Y,b]=(0,a.useState)(null!==t&&void 0!==t?t:v?"summary":"detail"),[S,A]=(0,a.useState)(g),T=(0,c.pQ)(S),[w,M]=(0,a.useState)(T),[D,k]=(0,a.useState)(!1),[I,C]=(0,a.useState)(f);(0,a.useEffect)((()=>{const e=(0,c.pQ)(S);M(e)}),[S]);const F=(0,a.useMemo)((()=>({rootNode:d,nodeMap:p,activeView:Y,setActiveView:b,activeTab:w,setActiveTab:M,selectedNode:S,setSelectedNode:A,showTimelineTreeGantt:D,setShowTimelineTreeGantt:k,assessmentsPaneExpanded:I,setAssessmentsPaneExpanded:C,assessmentsPaneEnabled:n})),[Y,p,w,d,S,D,k,I,C,n]);return(0,h.Y)(y.Provider,{value:F,children:r})},S=e=>{switch(e.section){case"inputs":case"outputs":default:return"content";case"attributes":return"attributes";case"events":return"events"}},A=({treeNode:e,selectedNode:t,setSelectedNode:s,setActiveTab:n,setExpandedKeys:r,modelTraceInfo:i})=>{var o;const[l,d]=(0,a.useState)(""),[p,m]=(0,a.useState)((()=>(e=>{const t={};e&&(0,u.compact)((0,x.VC)([e]).map((e=>e.type))).forEach((e=>{t[e]=!0}));return{showParents:!0,showExceptions:!0,spanTypeDisplayState:t}})(e))),[g,h]=(0,a.useState)(0),{filteredTreeNodes:f,matches:v}=(0,a.useMemo)((()=>(0,u.isNil)(e)?{filteredTreeNodes:[],matches:[]}:(0,c.vL)(e,l,p)),[null===e||void 0===e?void 0:e.key,l,p,i]),y=(0,a.useMemo)((()=>(0,x.dM)(f)),[f]),Y=(0,a.useCallback)((e=>{if(e>=v.length||e<0)return;h(e);const t=v[e];s(t.span),n(S(t));const a=(0,x.NP)(t.span,y);r((e=>new Set([...e,...a])))}),[v,s,n,y,r]),b=(0,a.useCallback)((()=>{Y(g+1)}),[g,Y]),A=(0,a.useCallback)((()=>{Y(g-1)}),[g,Y]);return(0,a.useLayoutEffect)((()=>{if(0!==f.length)if(0!==v.length)h(0),s(v[0].span),n(S(v[0]));else{var e;const a=null!==(e=null===t||void 0===t?void 0:t.key)&&void 0!==e?e:"";if(a in y)s(y[a]);else{const e=f[0];s(e),n(null!==e&&void 0!==e&&e.chatMessages?"chat":"content")}}}),[f,v,s]),{matchData:{match:null!==(o=v[g])&&void 0!==o?o:null,totalMatches:v.length,currentMatchIndex:g},searchFilter:l.toLowerCase().trim(),setSearchFilter:d,spanFilterState:p,setSpanFilterState:m,filteredTreeNodes:f,handleNextSearchMatch:b,handlePreviousSearchMatch:A}};var T=s(49425);function w({activeSpan:e,searchFilter:t,activeMatch:s}){const{theme:a}=(0,i.u)(),{attributes:r}=e,d=(0,u.keys)(r).length>0,c=!(0,u.isNil)(s)&&s.span.key===e.key;return!d||(0,u.isNil)(r)?(0,h.Y)("div",{css:(0,n.AH)({marginTop:a.spacing.md},""),children:(0,h.Y)(o.Empty,{description:(0,h.Y)(l.sA,{id:"B5K1Ix",defaultMessage:"No attributes found"})})}):(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm,padding:a.spacing.md},""),children:Object.entries(r).map((([e,n])=>(0,h.Y)(T.C,{title:e,data:JSON.stringify(n,null,2),searchFilter:t,activeMatch:s,containsActiveMatch:c&&"attributes"===s.section&&s.key===e},e)))})}var M=s(91461),D=s(33669),k=s(21209);function I({chatMessages:e,chatTools:t}){const{theme:s}=(0,i.u)();return(0,h.FD)("div",{css:(0,n.AH)({overflowY:"auto",padding:s.spacing.md},""),"data-testid":"model-trace-explorer-chat-tab",children:[t&&(0,h.Y)(k.p,{css:(0,n.AH)({marginBottom:s.spacing.sm},""),title:(0,h.Y)(l.sA,{id:"Cjq57+",defaultMessage:"Tools"}),sectionKey:"messages",children:(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm},""),children:t.map((e=>(0,h.Y)(M.E,{tool:e},e.function.name)))})}),(0,h.Y)(k.p,{title:(0,h.Y)(l.sA,{id:"AAdQxU",defaultMessage:"Messages"}),sectionKey:"messages",children:(0,h.Y)(D.J,{messages:e})})]})}var C={name:"1s4awny",styles:"display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%"},F={name:"uqztsn",styles:"display:flex;flex-direction:row;justify-content:space-between;width:100%"};function H({activeSpan:e,className:t,searchFilter:s,activeMatch:r}){const{theme:o}=(0,i.u)(),d=(0,a.useMemo)((()=>(0,c.g_)(null===e||void 0===e?void 0:e.inputs)),[e]),p=(0,a.useMemo)((()=>(0,c.g_)(null===e||void 0===e?void 0:e.outputs)),[e]);if((0,u.isNil)(e))return null;const m=d.length>0,g=p.length>0,f=!(0,u.isNil)(r)&&r.span.key===e.key;return(0,h.FD)("div",{"data-testid":"model-trace-explorer-default-span-view",children:[m&&(0,h.Y)(k.p,{withBorder:!0,css:(0,n.AH)({marginBottom:o.spacing.sm},""),sectionKey:"input",title:(0,h.Y)("div",{css:C,children:(0,h.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"})}),children:(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:o.spacing.sm},""),children:d.map((({key:e,value:t},n)=>(0,h.Y)(T.C,{title:e,data:t,searchFilter:s,activeMatch:r,containsActiveMatch:f&&"inputs"===r.section&&r.key===e},e||n)))})}),g&&(0,h.Y)(k.p,{withBorder:!0,sectionKey:"output",title:(0,h.Y)("div",{css:F,children:(0,h.Y)(l.sA,{id:"ZstVNI",defaultMessage:"Outputs"})}),children:(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:o.spacing.sm},""),children:p.map((({key:e,value:t})=>(0,h.Y)(T.C,{title:e,data:t,searchFilter:s,activeMatch:r,containsActiveMatch:f&&"outputs"===r.section&&r.key===e},e)))})})]})}var N=s(9599),R=s(79081);var E={name:"s5xdrg",styles:"display:flex;align-items:center"},B={name:"s5xdrg",styles:"display:flex;align-items:center"};function L({shouldRenderMarkdown:e,setShouldRenderMarkdown:t}){const{theme:s}=(0,i.u)();return(0,h.FD)(o.SegmentedControlGroup,{"data-testid":"model-trace-explorer-render-mode-toggle",name:"render-mode",size:"small",componentId:`shared.model-trace-explorer.toggle-markdown-rendering-${!e}`,value:e,onChange:e=>{t(e.target.value)},children:[(0,h.Y)(o.SegmentedControlButton,{"data-testid":"model-trace-explorer-render-raw-input-button",value:!1,children:(0,h.Y)(R.T,{componentId:"shared.model-trace-explorer.raw-input-rendering-tooltip",content:(0,h.Y)(l.sA,{id:"NMxAot",defaultMessage:"Raw input"}),children:(0,h.Y)("div",{css:E,children:(0,h.Y)(o.TextBoxIcon,{css:(0,n.AH)({fontSize:s.typography.fontSizeLg},"")})})})}),(0,h.Y)(o.SegmentedControlButton,{"data-testid":"model-trace-explorer-render-default-button",value:!0,children:(0,h.Y)(R.T,{componentId:"shared.model-trace-explorer.default-rendering-tooltip",content:(0,h.Y)(l.sA,{id:"xwe7WH",defaultMessage:"Default rendering"}),children:(0,h.Y)("div",{css:B,children:(0,h.Y)(o.MIcon,{css:(0,n.AH)({fontSize:s.typography.fontSizeLg},"")})})})})]})}var z={name:"1s4awny",styles:"display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%"};function O({activeSpan:e,className:t,searchFilter:s,activeMatch:r}){const{theme:d}=(0,i.u)(),[p,m]=(0,a.useState)(!0),g=(0,a.useMemo)((()=>(0,c.g_)(e.inputs)),[e]),f=e.outputs,v=g.length>0,x=!(0,u.isNil)(r)&&r.span.key===e.key,y=x&&"outputs"===r.section;return(0,h.FD)("div",{className:t,"data-testid":"model-trace-explorer-retriever-span-view",children:[v&&(0,h.Y)(k.p,{sectionKey:"input",css:(0,n.AH)({marginBottom:d.spacing.sm},""),title:(0,h.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:d.spacing.sm},""),children:g.map((({key:e,value:t},n)=>(0,h.Y)(T.C,{title:e,data:t,searchFilter:s,activeMatch:r,containsActiveMatch:x&&"inputs"===r.section&&r.key===e},e||n)))})}),(0,h.Y)(k.p,{sectionKey:"output",title:(0,h.FD)("div",{css:z,children:[(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",gap:d.spacing.sm},""),children:[(0,h.Y)(l.sA,{id:"ThYYz6",defaultMessage:"Documents"}),(0,h.Y)(o.Tag,{componentId:"shared.model-trace-explorer.document-count",children:f.length})]}),!y&&(0,h.Y)(L,{shouldRenderMarkdown:p,setShouldRenderMarkdown:m})]}),children:p&&!y?(0,h.Y)("div",{css:(0,n.AH)({border:`1px solid ${d.colors.border}`,borderRadius:d.legacyBorders.borderRadiusMd},""),children:f.map(((e,t)=>(0,h.Y)("div",{css:(0,n.AH)({borderBottom:t!==f.length-1?`1px solid ${d.colors.border}`:""},""),children:(0,h.Y)(N.p,{text:e.page_content,metadata:e.metadata},t)},t)))}):(0,h.Y)("div",{css:(0,n.AH)({border:`1px solid ${d.colors.border}`,borderRadius:d.legacyBorders.borderRadiusMd,padding:d.spacing.md},""),children:(0,h.Y)(T.C,{title:"",data:JSON.stringify(f,null,2),searchFilter:s,activeMatch:r,containsActiveMatch:x&&"outputs"===r.section})})})]})}function K({activeSpan:e,className:t,searchFilter:s,activeMatch:a}){const{theme:r}=(0,i.u)();return!(0,u.isNil)(e)&&(0,c.vl)(e)?(0,h.Y)("div",{css:(0,n.AH)({overflowY:"auto",padding:r.spacing.md},""),className:t,"data-testid":"model-trace-explorer-content-tab",children:(0,h.Y)(O,{activeSpan:e,className:t,searchFilter:s,activeMatch:a})}):(0,h.Y)("div",{css:(0,n.AH)({overflowY:"auto",padding:r.spacing.md},""),className:t,"data-testid":"model-trace-explorer-content-tab",children:(0,h.Y)(H,{activeSpan:e,className:t,searchFilter:s,activeMatch:a})})}var V=s(94664);function j({activeSpan:e,searchFilter:t,activeMatch:s}){const{theme:a}=(0,i.u)(),{events:r}=e,d=!(0,u.isNil)(s)&&s.span.key===e.key;return Array.isArray(r)&&0!==r.length?(0,h.Y)("div",{css:(0,n.AH)({padding:a.spacing.md},""),children:r.map(((e,r)=>{const l=e.attributes,u="exception"===e.name?(0,h.FD)(h.FK,{children:[(0,h.Y)(o.XCircleIcon,{css:(0,n.AH)({marginRight:a.spacing.sm},""),color:"danger"}),(0,h.Y)(i.T.Text,{color:"error",bold:!0,children:"Exception"})]}):e.name;return l?(0,h.Y)(k.p,{sectionKey:e.name,title:u,withBorder:!0,children:(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm},""),children:Object.keys(l).map((n=>{const a=(0,c.Q0)(e.name,r,n);return(0,h.Y)(T.C,{title:n,data:JSON.stringify(l[n],null,2),searchFilter:t,activeMatch:s,containsActiveMatch:d&&"events"===s.section&&s.key===a,initialRenderMode:V.cC.TEXT},a)}))})},`${e.name}-${r}`):null}))}):(0,h.Y)("div",{css:(0,n.AH)({marginTop:a.spacing.md},""),children:(0,h.Y)(o.Empty,{description:(0,h.Y)(l.sA,{id:"xnr5KT",defaultMessage:"No events found"})})})}function _({count:e}){const{theme:t}=(0,i.u)();return(0,h.Y)("div",{css:(0,n.AH)({display:"flex",alignItems:"center",justifyContent:"center",borderRadius:t.typography.fontSizeBase,height:t.typography.fontSizeBase,backgroundColor:t.colors.actionDangerPrimaryBackgroundDefault,padding:t.spacing.xs,marginLeft:t.spacing.xs,boxSizing:"border-box"},""),children:(0,h.Y)("span",{css:(0,n.AH)({color:t.colors.actionPrimaryTextDefault,fontSize:11},""),children:e})})}var $={name:"4zleql",styles:"display:block"},P={name:"oit39a",styles:"& > span{display:flex;align-items:center;}"};const W=()=>{const{assessmentsPaneExpanded:e,setAssessmentsPaneExpanded:t,assessmentsPaneEnabled:s}=Y();return(0,h.Y)(o.SegmentedControlGroup,{css:$,name:"shared.model-trace-explorer.assessments-pane-toggle",componentId:"shared.model-trace-explorer.assessments-pane-toggle",value:e,size:"small",children:(0,h.Y)(o.SegmentedControlButton,{value:!0,disabled:!s,icon:(0,h.Y)(o.GavelIcon,{}),onClick:()=>null===t||void 0===t?void 0:t(!e),css:P,children:!e&&(0,h.Y)(l.sA,{id:"r/fxMt",defaultMessage:"Assessments"})})})};var J=s(44666),U=s(57248);const G=({name:e,setName:t,nameError:s,setNameError:n,handleChangeSchema:r})=>{const{schemas:i}=(0,U.a)(),d=(0,l.tz)(),c=i.map((e=>{var t;return null!==(t=e.name)&&void 0!==t?t:""})),[u,p]=(0,a.useState)(null),[m,g]=(0,a.useState)(i),f=(0,a.useMemo)((()=>{const t=[...m];if(e&&!c.includes(e)){const s=(e=>({name:e,assessmentType:"feedback",dataType:"boolean"}))(e);t.unshift(s)}return t}),[e,m,c]),v=(0,a.useCallback)((e=>{p(e),r(e),n(null)}),[r,n]),x=(0,o.useComboboxState)({componentId:"shared.model-trace-explorer.assessment-name-typeahead",allItems:i,items:f,setItems:g,multiSelect:!1,setInputValue:e=>{t(e),n(null)},itemToString:e=>{var t;return null!==(t=null===e||void 0===e?void 0:e.name)&&void 0!==t?t:""},matcher:(e,t)=>{var s,n;return null!==(s=null===e||void 0===e||null===(n=e.name)||void 0===n?void 0:n.toLowerCase().includes(t.toLowerCase()))&&void 0!==s&&s},formValue:u,formOnChange:v,preventUnsetOnBlur:!0});return(0,h.FD)(o.TypeaheadComboboxRoot,{onKeyDown:e=>{"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||e.stopPropagation()},id:"shared.model-trace-explorer.assessment-name-typeahead",comboboxState:x,children:[(0,h.Y)(o.TypeaheadComboboxInput,{"data-testid":"assessment-name-typeahead-input",placeholder:d.formatMessage({id:"gN67TK",defaultMessage:"Enter an assessment name"}),validationState:s?"error":void 0,comboboxState:x,formOnChange:v,onPressEnter:()=>{f.length>0&&v(f[0])},allowClear:!0,showComboboxToggleButton:!0}),s&&(0,h.Y)(o.FormUI.Message,{type:"error",message:s}),(0,h.Y)(o.TypeaheadComboboxMenu,{comboboxState:x,children:f.map(((e,t)=>{var s,n,a;return(0,h.Y)(o.TypeaheadComboboxMenuItem,{"data-testid":`assessment-name-typeahead-item-${null!==(s=null===e||void 0===e?void 0:e.name)&&void 0!==s?s:""}`,item:e,index:t,comboboxState:x,children:null!==(a=null===e||void 0===e?void 0:e.name)&&void 0!==a?a:""},`assessment-name-typeahead-${null!==(n=null===e||void 0===e?void 0:e.name)&&void 0!==n?n:""}`)}))})]})},q=250,X=(e,t=new Date)=>{const s=Math.max(0,Math.floor((t.getTime()-e)/1e3));let n=Math.floor(s/31536e3);return n>=1?(0,h.Y)(l.sA,{id:"16BvfJ",defaultMessage:"{timeSince, plural, =1 {1 year} other {# years}} ago",values:{timeSince:n}}):(n=Math.floor(s/2592e3),n>=1?(0,h.Y)(l.sA,{id:"5ZAXeS",defaultMessage:"{timeSince, plural, =1 {1 month} other {# months}} ago",values:{timeSince:n}}):(n=Math.floor(s/86400),n>=1?(0,h.Y)(l.sA,{id:"tLb7+M",defaultMessage:"{timeSince, plural, =1 {1 day} other {# days}} ago",values:{timeSince:n}}):(n=Math.floor(s/3600),n>=1?(0,h.Y)(l.sA,{id:"aOW396",defaultMessage:"{timeSince, plural, =1 {1 hour} other {# hours}} ago",values:{timeSince:n}}):(n=Math.floor(s/60),n>=1?(0,h.Y)(l.sA,{id:"7jsqqe",defaultMessage:"{timeSince, plural, =1 {1 minute} other {# minutes}} ago",values:{timeSince:n}}):(0,h.Y)(l.sA,{id:"93iLUV",defaultMessage:"{timeSince, plural, =1 {1 second} other {# seconds}} ago",values:{timeSince:s}})))))},Q=({formValue:e,dataType:t,isFeedback:s})=>s?{feedback:{value:e}}:"json"===t?{expectation:{serialized_value:{value:String(e),serialization_format:"JSON_FORMAT"}}}:{expectation:{value:e}};var Z={name:"t152af",styles:"margin-top:8px;color:red"};var ee={name:"t152af",styles:"margin-top:8px;color:red"};var te={name:"t152af",styles:"margin-top:8px;color:red"};var se=s(39595),ne=s(61060),ae=s(13433);const re={json:({value:e,valueError:t,setValue:s,setValueError:n,isSubmitting:a})=>(0,h.FD)("div",{children:[(0,h.Y)(g.I.TextArea,{"data-testid":"assessment-value-json-input",componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(e),autoSize:{minRows:1,maxRows:5},onKeyDown:e=>e.stopPropagation(),onChange:e=>{s(e.target.value),n(null)},validationState:t?"error":void 0,disabled:a}),t&&(0,h.Y)(o.FormUI.Message,{id:"shared.model-trace-explorer.assessment-edit-value-json-error",message:t,type:"error"})]}),string:({value:e,valueError:t,setValue:s,setValueError:n,isSubmitting:a})=>(0,h.FD)("div",{children:[(0,h.Y)(g.I,{"data-testid":"assessment-value-string-input",componentId:"shared.model-trace-explorer.assessment-value-string-input",value:String(e),onKeyDown:e=>e.stopPropagation(),onChange:e=>{s(e.target.value),n(null)},disabled:a,allowClear:!0}),t&&(0,h.Y)("div",{css:te,children:t})]}),boolean:({value:e,valueError:t,setValue:s,setValueError:n,isSubmitting:a})=>(0,h.FD)("div",{children:[(0,h.FD)(o.SegmentedControlGroup,{"data-testid":"assessment-value-boolean-input",componentId:"shared.model-trace-explorer.assessment-value-boolean-input",name:"shared.model-trace-explorer.assessment-value-boolean-input",value:e,disabled:a,onChange:e=>{s(e.target.value),n(null)},children:[(0,h.Y)(o.SegmentedControlButton,{value:!0,children:"True"}),(0,h.Y)(o.SegmentedControlButton,{value:!1,children:"False"})]}),t&&(0,h.Y)("div",{css:Z,children:t})]}),number:({value:e,valueError:t,setValue:s,setValueError:n,isSubmitting:a})=>(0,h.FD)("div",{children:[(0,h.Y)(g.I,{"data-testid":"assessment-value-number-input",componentId:"shared.model-trace-explorer.assessment-value-number-input",value:String(e),onKeyDown:e=>e.stopPropagation(),onChange:e=>{s(e.target.value?Number(e.target.value):""),n(null)},type:"number",disabled:a,allowClear:!0}),t&&(0,h.Y)("div",{css:ee,children:t})]})},ie=(0,a.forwardRef)((({assessmentName:e,spanId:t,traceId:s,setExpanded:r},d)=>{var p;const{theme:m}=(0,i.u)(),{schemas:f}=(0,U.a)(),[v,x]=(0,a.useState)(""),[y,Y]=(0,a.useState)("feedback"),[b,S]=(0,a.useState)("boolean"),[A,T]=(0,a.useState)(!0),[w,M]=(0,a.useState)(""),[D,k]=(0,a.useState)(null),[I,C]=(0,a.useState)(null),F=!(0,u.isNil)(e),H=null!==(p=re[b])&&void 0!==p?p:re.string,{createAssessmentMutation:N,isLoading:R}=(({traceId:e,onSuccess:t,onError:s,onSettled:n})=>{const a=(0,l.tz)(),r=(0,se.jE)(),{mutate:i,isLoading:o}=(0,ne.n)({mutationFn:e=>(0,ae.bU)({payload:e}),onSuccess:()=>{r.invalidateQueries({queryKey:[c.BS,e]}),null===t||void 0===t||t()},onError:e=>{(0,c.ij)(a.formatMessage({id:"L3szkg",defaultMessage:"Failed to create assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===s||void 0===s||s(e)},onSettled:()=>{null===n||void 0===n||n()}});return{createAssessmentMutation:i,isLoading:o}})({traceId:s,onSettled:()=>{r(!1)}}),E=(0,a.useCallback)((async()=>{var n;if("json"===b)try{JSON.parse(A)}catch(i){return void C((0,h.Y)(l.sA,{id:"VXduJD",defaultMessage:"The provided value is not valid JSON"}))}if(!F&&""===v)return void k((0,h.Y)(l.sA,{id:"WHf+VX",defaultMessage:"Please enter a name"}));const a=Q({formValue:A,dataType:b,isFeedback:"feedback"===y}),r={assessment:{assessment_name:F?e:v,trace_id:s,source:{source_type:"HUMAN",source_id:null!==(n=(0,J.w)())&&void 0!==n?n:""},span_id:t,rationale:w,...a}};N(r)}),[b,A,y,F,e,v,s,t,w,N]),B=(0,a.useCallback)((e=>{if(!e)return x(""),Y("feedback"),S("boolean"),T(!0),M(""),void C(null);if(f.some((t=>t.name===e.name)))switch(x(e.name),Y(e.assessmentType),S(e.dataType),e.dataType){case"string":case"json":T("");break;case"number":T(0);break;case"boolean":T(!0)}else x(e.name)}),[f]);return(0,h.FD)("div",{ref:d,css:(0,n.AH)({display:"flex",flexDirection:"column",gap:m.spacing.xs,marginTop:m.spacing.sm,border:`1px solid ${m.colors.border}`,padding:m.spacing.sm,borderRadius:m.borders.borderRadiusSm},""),children:[(0,h.Y)(i.T.Text,{size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"+SBxBK",defaultMessage:"Assessment Type"})}),(0,h.FD)(o.SimpleSelect,{id:"shared.model-trace-explorer.assessment-type-select",componentId:"shared.model-trace-explorer.assessment-type-select",label:"Assessment Type",value:y,disabled:R,onChange:e=>{Y(e.target.value),"feedback"===e.target.value&&"json"===b&&S("string")},children:[(0,h.Y)(o.SimpleSelectOption,{value:"feedback",children:(0,h.Y)(l.sA,{id:"0AOcOr",defaultMessage:"Feedback"})}),(0,h.Y)(o.SimpleSelectOption,{value:"expectation",children:(0,h.Y)(l.sA,{id:"tEaqGu",defaultMessage:"Expectation"})})]}),(0,h.Y)(i.T.Text,{css:(0,n.AH)({marginTop:m.spacing.xs},""),size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"AdlJNW",defaultMessage:"Assessment Name"})}),F?(0,h.Y)(i.T.Text,{children:e}):(0,h.Y)(G,{name:v,setName:x,handleChangeSchema:B,nameError:D,setNameError:k}),(0,h.Y)(i.T.Text,{css:(0,n.AH)({marginTop:m.spacing.xs},""),size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"q8rYCQ",defaultMessage:"Data Type"})}),(0,h.FD)(o.SimpleSelect,{id:"shared.model-trace-explorer.assessment-data-type-select",componentId:"shared.model-trace-explorer.assessment-data-type-select",label:"Data Type",value:b,disabled:R,onChange:e=>{S(e.target.value),C(null)},children:["expectation"===y&&(0,h.Y)(o.SimpleSelectOption,{value:"json",children:(0,h.Y)(l.sA,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,h.Y)(o.SimpleSelectOption,{value:"string",children:(0,h.Y)(l.sA,{id:"cBSSLp",defaultMessage:"String"})}),(0,h.Y)(o.SimpleSelectOption,{value:"boolean",children:(0,h.Y)(l.sA,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,h.Y)(o.SimpleSelectOption,{value:"number",children:(0,h.Y)(l.sA,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,h.Y)(i.T.Text,{css:(0,n.AH)({marginTop:m.spacing.xs},""),size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"ms+6Z2",defaultMessage:"Value"})}),(0,h.Y)(H,{value:A,valueError:I,setValue:T,setValueError:C,isSubmitting:R}),(0,h.Y)(i.T.Text,{css:(0,n.AH)({marginTop:m.spacing.xs},""),size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"wDMTm8",defaultMessage:"Rationale"})}),(0,h.Y)(g.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-rationale-input",value:w,autoSize:{minRows:1,maxRows:5},disabled:R,onKeyDown:e=>e.stopPropagation(),onChange:e=>M(e.target.value)}),(0,h.FD)("div",{css:(0,n.AH)({display:"flex",justifyContent:"flex-end",marginTop:m.spacing.xs},""),children:[(0,h.Y)(i.B,{componentId:"shared.model-trace-explorer.assessment-create-button",disabled:R,onClick:()=>r(!1),children:(0,h.Y)(l.sA,{id:"+33ShX",defaultMessage:"Cancel"})}),(0,h.Y)(i.B,{css:(0,n.AH)({marginLeft:m.spacing.sm},""),type:"primary",componentId:"shared.model-trace-explorer.assessment-create-button",onClick:E,loading:R,children:(0,h.Y)(l.sA,{id:"Me7xpG",defaultMessage:"Create"})})]})]})})),oe=({title:e,assessmentName:t,spanId:s,traceId:n})=>{const[r,l]=(0,a.useState)(!1),d=(0,a.useRef)(null);return(0,a.useEffect)((()=>{r&&d.current&&d.current.scrollIntoView({behavior:"smooth",block:"start"})}),[r]),(0,h.FD)("div",{children:[(0,h.Y)(i.B,{size:"small",componentId:"shared.model-trace-explorer.add-new-assessment",icon:(0,h.Y)(o.PlusIcon,{}),onClick:()=>l(!0),children:e}),r&&(0,h.Y)(ie,{ref:d,assessmentName:t,spanId:s,traceId:n,setExpanded:l})]})},le=({assessment:e,setIsEditing:t,setShowDeleteModal:s})=>{var n;const a="feedback"in e,r=((null!==(n=(0,J.w)())&&void 0!==n?n:"")===e.source.source_id||a&&"HUMAN"!==e.source.source_type)&&t;return(0,h.FD)(o.DropdownMenu.Root,{children:[(0,h.Y)(o.DropdownMenu.Trigger,{asChild:!0,children:(0,h.Y)(i.B,{componentId:"shared.model-trace-explorer.assessment-more-button",icon:(0,h.Y)(o.OverflowIcon,{}),size:"small"})}),(0,h.FD)(o.DropdownMenu.Content,{minWidth:100,children:[r&&(0,h.FD)(o.DropdownMenu.Item,{componentId:"shared.model-trace-explorer.assessment-edit-button",onClick:()=>null===t||void 0===t?void 0:t(!0),children:[(0,h.Y)(o.DropdownMenu.IconWrapper,{children:(0,h.Y)(o.PencilIcon,{})}),(0,h.Y)(l.sA,{id:"UQhorr",defaultMessage:"Edit"})]}),(0,h.FD)(o.DropdownMenu.Item,{componentId:"shared.model-trace-explorer.assessment-delete-button",onClick:()=>s(!0),children:[(0,h.Y)(o.DropdownMenu.IconWrapper,{children:(0,h.Y)(o.TrashIcon,{})}),(0,h.Y)(l.sA,{id:"aZV8M7",defaultMessage:"Delete"})]})]})]})},de=({assessment:e,isModalVisible:t,setIsModalVisible:s})=>{const n=(0,l.tz)(),r=(0,se.jE)(),{mutate:i,isLoading:o}=(0,ne.n)({mutationFn:()=>(0,ae.aG)({traceId:e.trace_id,assessmentId:e.assessment_id}),onSuccess:()=>{r.invalidateQueries({queryKey:[c.BS,e.trace_id]})},onError:e=>{(0,c.ij)(n.formatMessage({id:"iRNZkJ",defaultMessage:"Failed to delete assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)}))},onSettled:()=>{s(!1)}}),d=(0,a.useCallback)((()=>{i()}),[i]);return(0,h.Y)(R.d,{componentId:"shared.model-trace-explorer.assessment-delete-modal",visible:t,onOk:d,okButtonProps:{danger:!0,loading:o},okText:(0,h.Y)(l.sA,{id:"vlUEAo",defaultMessage:"Delete"}),onCancel:()=>{s(!1)},cancelText:(0,h.Y)(l.sA,{id:"gFYM0j",defaultMessage:"Cancel"}),confirmLoading:o,title:(0,h.Y)(l.sA,{id:"mqqEUj",defaultMessage:"Delete assessment"}),children:(0,h.Y)(l.sA,{id:"puATD8",defaultMessage:"Are you sure you want to delete this assessment?"})})};var ce=s(33145);const ue=({assessment:e,onSuccess:t,onSettled:s,onCancel:r})=>{var d;const p="feedback"in e,m=(0,ce.e)(e),f=((e,t)=>{if("string"===typeof e){if(""===e)return"boolean";if(t)return"string";try{return JSON.parse(e),"json"}catch(s){return"string"}}return"boolean"===typeof e||"number"===typeof e?typeof e:"boolean"})(m,p),v=(e=>"string"===typeof e?e||null:"boolean"===typeof e||"number"===typeof e?e:null)(m),x=null!==(d=(0,J.w)())&&void 0!==d?d:"",{theme:y}=(0,i.u)(),[Y,b]=(0,a.useState)(f),[S,A]=(0,a.useState)(v),[T,w]=(0,a.useState)(e.rationale),[M,D]=(0,a.useState)(null),{updateAssessmentMutation:k,isLoading:I}=(({assessment:e,onSuccess:t,onError:s,onSettled:n})=>{const a=(0,l.tz)(),r=(0,se.jE)(),{mutate:i,isLoading:o}=(0,ne.n)({mutationFn:t=>(0,ae.G3)({traceId:e.trace_id,assessmentId:e.assessment_id,payload:t}),onError:e=>{(0,c.ij)(a.formatMessage({id:"+hZB4c",defaultMessage:"Failed to update assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===s||void 0===s||s(e)},onSuccess:()=>{r.invalidateQueries({queryKey:[c.BS,e.trace_id]}),null===t||void 0===t||t()},onSettled:()=>{null===n||void 0===n||n()}});return{updateAssessmentMutation:i,isLoading:o}})({assessment:e,onSuccess:t,onSettled:s}),{overrideAssessmentMutation:C,isLoading:F}=(({traceId:e,onSuccess:t,onError:s,onSettled:n})=>{const a=(0,l.tz)(),r=(0,se.jE)(),{mutate:i,isLoading:o}=(0,ne.n)({mutationFn:({oldAssessment:e,value:t,rationale:s})=>{var n;const a={...e,...t,rationale:s,source:{source_id:null!==(n=(0,J.w)())&&void 0!==n?n:"",source_type:"HUMAN"},overrides:e.assessment_id},r={assessment:(0,u.omit)(a,"assessment_id","create_time","last_update_time","overriddenAssessments")};return(0,ae.bU)({payload:r})},onError:e=>{(0,c.ij)(a.formatMessage({id:"X11caV",defaultMessage:"Failed to override assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===s||void 0===s||s(e)},onSuccess:()=>{r.invalidateQueries({queryKey:[c.BS,e]}),null===t||void 0===t||t()},onSettled:()=>{null===n||void 0===n||n()}});return{overrideAssessmentMutation:i,isLoading:o}})({traceId:e.trace_id,onSuccess:t,onSettled:s}),H=I||F,N=(0,a.useCallback)((async()=>{if("json"===Y)try{JSON.parse(S)}catch(s){return void D((0,h.Y)(l.sA,{id:"8I9ipd",defaultMessage:"The provided value is not valid JSON"}))}const t=Q({formValue:S,dataType:Y,isFeedback:p});if(x!==e.source.source_id&&p)C({oldAssessment:e,value:t,...T?{rationale:T}:{}});else{const e={assessment:{...t,rationale:T},update_mask:(p?"feedback":"expectation")+",rationale"};k(e)}}),[Y,S,p,x,e,T,k,C]);return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:y.spacing.xs,marginTop:y.spacing.sm,border:`1px solid ${y.colors.border}`,padding:y.spacing.sm,borderRadius:y.borders.borderRadiusSm},""),children:[(0,h.Y)(i.T.Text,{css:(0,n.AH)({marginTop:y.spacing.xs},""),size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"b7OpMB",defaultMessage:"Data Type"})}),(0,h.FD)(o.SimpleSelect,{id:"shared.model-trace-explorer.assessment-edit-data-type-select",componentId:"shared.model-trace-explorer.assessment-edit-data-type-select",value:Y,disabled:H,onChange:e=>{b(e.target.value),D(null)},children:[!p&&(0,h.Y)(o.SimpleSelectOption,{value:"json",children:(0,h.Y)(l.sA,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,h.Y)(o.SimpleSelectOption,{value:"string",children:(0,h.Y)(l.sA,{id:"cBSSLp",defaultMessage:"String"})}),(0,h.Y)(o.SimpleSelectOption,{value:"boolean",children:(0,h.Y)(l.sA,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,h.Y)(o.SimpleSelectOption,{value:"number",children:(0,h.Y)(l.sA,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,h.Y)(i.T.Text,{css:(0,n.AH)({marginTop:y.spacing.xs},""),size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"e2AObB",defaultMessage:"Value"})}),"json"===Y&&(0,h.FD)(h.FK,{children:[(0,h.Y)(g.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(S),rows:3,onKeyDown:e=>e.stopPropagation(),onChange:e=>{A(e.target.value),D(null)},validationState:M?"error":void 0,disabled:H}),M&&(0,h.Y)(o.FormUI.Message,{id:"shared.model-trace-explorer.assessment-edit-value-json-error",message:M,type:"error"})]}),"string"===Y&&(0,h.Y)(g.I,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(S),onKeyDown:e=>e.stopPropagation(),onChange:e=>{A(e.target.value),D(null)},disabled:H,allowClear:!0}),"boolean"===Y&&(0,h.FD)(o.SegmentedControlGroup,{componentId:"shared.model-trace-explorer.assessment-edit-value-boolean-input",name:"shared.model-trace-explorer.assessment-edit-value-boolean-input",value:S,disabled:H,onChange:e=>{A(e.target.value),D(null)},children:[(0,h.Y)(o.SegmentedControlButton,{value:!0,children:"True"}),(0,h.Y)(o.SegmentedControlButton,{value:!1,children:"False"})]}),"number"===Y&&(0,h.Y)(g.I,{componentId:"shared.model-trace-explorer.assessment-edit-value-number-input",value:String(S),onKeyDown:e=>e.stopPropagation(),onChange:e=>{A(e.target.value?Number(e.target.value):""),D(null)},type:"number",disabled:H,allowClear:!0}),(0,h.Y)(i.T.Text,{css:(0,n.AH)({marginTop:y.spacing.xs},""),size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"6BRlPU",defaultMessage:"Rationale"})}),(0,h.Y)(g.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-rationale-input",value:T,autoSize:{minRows:1,maxRows:5},disabled:H,onKeyDown:e=>e.stopPropagation(),onChange:e=>w(e.target.value)}),(0,h.FD)("div",{css:(0,n.AH)({display:"flex",justifyContent:"flex-end",marginTop:y.spacing.xs},""),children:[(0,h.Y)(i.B,{componentId:"shared.model-trace-explorer.assessment-edit-cancel-button",disabled:H,onClick:r,children:(0,h.Y)(l.sA,{id:"mIFcgu",defaultMessage:"Cancel"})}),(0,h.Y)(i.B,{css:(0,n.AH)({marginLeft:y.spacing.sm},""),type:"primary",componentId:"shared.model-trace-explorer.assessment-edit-save-button",onClick:N,loading:H,children:(0,h.Y)(l.sA,{id:"M+iC03",defaultMessage:"Save"})})]})]})};var pe=s(777),me=s(51847);const ge=({node:e})=>{var t;const{theme:s}=(0,i.u)(),{setSelectedNode:a,setActiveView:r,setShowTimelineTreeGantt:o}=Y(),l=(0,c.N7)(e)>0;return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",alignItems:"center",marginRight:s.spacing.xs,gap:s.spacing.xs,"&:hover":{textDecoration:"underline",textDecorationColor:l?s.colors.actionDangerDefaultTextDefault:s.colors.actionDefaultTextDefault,cursor:"pointer"}},""),onClick:()=>{a(e),r("detail"),o(!1)},children:[(0,h.Y)(me.P,{hasException:l,type:(0,c.tC)(null!==(t=e.type)&&void 0!==t?t:V.UG.UNKNOWN)}),(0,h.Y)(i.T.Text,{color:l?"error":"primary",css:(0,n.AH)({marginLeft:s.spacing.xs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},""),children:e.title})]})},he=({source:e})=>{const{theme:t}=(0,i.u)();return(0,h.Y)(R.T,{componentId:"shared.model-trace-explorer.assessment-source-name",content:e.source_id,children:(0,h.Y)("span",{css:(0,n.AH)({flexShrink:1,overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap",marginLeft:t.spacing.sm,minWidth:t.spacing.md},""),children:(0,h.Y)(i.T.Text,{children:(0,h.Y)("span",{css:(0,n.AH)({color:t.colors.blue500},""),children:e.source_id})})})})};var fe={name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"},ve={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},xe={name:"s5xdrg",styles:"display:flex;align-items:center"},ye={name:"fxp7t8",styles:"flex:1;min-width:0"};const Ye=({expectation:e})=>{const{theme:t}=(0,i.u)(),[s,r]=(0,a.useState)(!1),[d,c]=(0,a.useState)(!1),[u,p]=(0,a.useState)(!1),{nodeMap:m,activeView:g}=Y(),f=e.span_id?m[e.span_id]:null,v="summary"===g&&f,x=(e=>{if("value"in e)return e.value;try{return JSON.parse(e.serialized_value.value)}catch(t){return e.serialized_value.value}})(e.expectation),y=(0,ce.R)(e.source);return(0,h.FD)("div",{css:(0,n.AH)({padding:t.spacing.sm+t.spacing.xs,paddingTop:t.spacing.sm,border:`1px solid ${t.colors.border}`,borderRadius:t.borders.borderRadiusMd,display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:[(0,h.FD)("div",{css:fe,children:[(0,h.Y)(i.T.Text,{bold:!0,css:ve,children:e.assessment_name}),(0,h.Y)(le,{assessment:e,setIsEditing:r,setShowDeleteModal:c}),(0,h.Y)(de,{assessment:e,isModalVisible:d,setIsModalVisible:c})]}),s?(0,h.Y)(ue,{assessment:e,onSuccess:()=>r(!1),onCancel:()=>r(!1)}):(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:[(0,h.FD)("div",{css:xe,children:[(0,h.Y)(y,{size:t.typography.fontSizeSm,css:(0,n.AH)({padding:2,backgroundColor:t.colors.actionIconBackgroundHover,borderRadius:t.borders.borderRadiusFull},"")}),(0,h.Y)(he,{source:e.source})]}),(0,h.FD)("div",{css:(0,n.AH)({display:"flex",alignItems:u?"flex-start":"center",gap:t.spacing.xs},""),children:[(0,h.Y)(i.B,{componentId:"shared.model-trace-explorer.toggle-expectation-expanded",size:"small",icon:u?(0,h.Y)(o.ChevronDownIcon,{}):(0,h.Y)(i.o,{}),onClick:()=>p(!u)}),(0,h.Y)("div",{css:ye,children:u?(0,h.Y)("div",{css:(0,n.AH)({backgroundColor:t.colors.backgroundSecondary,padding:`${t.spacing.xs}px ${t.spacing.sm}px`,borderRadius:t.borders.borderRadiusMd,whiteSpace:"pre-wrap",wordBreak:"break-word"},""),children:(0,h.Y)(i.T.Text,{children:"string"===typeof x?x:JSON.stringify(x,null,2)})}):(0,h.Y)(pe.S,{parsedValue:x,singleLine:!0})})]})]}),v&&(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,h.Y)(i.T.Text,{size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"+hQbnS",defaultMessage:"Span"})}),(0,h.Y)(ge,{node:f})]})]})};var be={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"};const Se=({jsonValue:e})=>{const{theme:t}=(0,i.u)();if(!e||'""'===e)return null;let s;try{s=JSON.parse(e)}catch(d){s=e}let a="default",r=JSON.stringify(s,null,2);return"yes"===s?(a="lime",r=(0,h.FD)(h.FK,{children:[(0,h.Y)(o.CheckCircleIcon,{css:(0,n.AH)({marginRight:t.spacing.xs},"")}),(0,h.Y)(l.sA,{id:"MhOmZG",defaultMessage:"Yes"})]})):"no"===s?(a="coral",r=(0,h.FD)(h.FK,{children:[(0,h.Y)(o.XCircleIcon,{css:(0,n.AH)({marginRight:t.spacing.xs},"")}),(0,h.Y)(l.sA,{id:"M8cEQy",defaultMessage:"No"})]})):"string"===typeof s?r=s:null===s?(a="coral",r=(0,h.FD)(h.FK,{children:[(0,h.Y)(i.k,{css:(0,n.AH)({marginRight:t.spacing.xs},"")}),(0,h.Y)(l.sA,{id:"zEXwQL",defaultMessage:"Error"})]})):!0===s?(a="lime",r=(0,h.FD)(h.FK,{children:[(0,h.Y)(o.CheckCircleIcon,{css:(0,n.AH)({marginRight:t.spacing.xs},"")}),(0,h.Y)(l.sA,{id:"hWHLjo",defaultMessage:"True"})]})):!1===s&&(a="coral",r=(0,h.FD)(h.FK,{children:[(0,h.Y)(o.XCircleIcon,{css:(0,n.AH)({marginRight:t.spacing.xs},"")}),(0,h.Y)(l.sA,{id:"4U/RVz",defaultMessage:"False"})]})),(0,h.Y)(R.T,{componentId:"shared.model-trace-explorer.assesment-value-tooltip",content:r,children:(0,h.Y)(o.Tag,{css:(0,n.AH)({display:"inline-flex",maxWidth:"100%",minWidth:t.spacing.md,marginRight:0},""),componentId:"shared.model-trace-explorer.assesment-value-tag",color:a,children:(0,h.Y)("span",{css:be,children:r})})})};var Ae={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"};const Te=({renderConnector:e=!0,assessment:t,setIsEditing:s})=>{const{theme:r}=(0,i.u)(),[o,l]=(0,a.useState)(!1),d=(0,ce.R)(t.source);return(0,h.FD)("div",{css:Ae,children:[e&&(0,h.Y)("div",{css:(0,n.AH)({position:"absolute",left:-1,top:0,width:10,height:r.typography.lineHeightBase,boxSizing:"border-box",borderBottomLeftRadius:r.borders.borderRadiusMd,borderBottom:`1px solid ${r.colors.border}`,borderLeft:`1px solid ${r.colors.border}`},"")}),(0,h.Y)(d,{size:r.typography.fontSizeSm,css:(0,n.AH)({padding:2,backgroundColor:r.colors.actionIconBackgroundHover,borderRadius:r.borders.borderRadiusFull},"")}),(0,h.Y)(he,{source:t.source}),(0,h.FD)("div",{css:(0,n.AH)({marginLeft:"auto",display:"flex",flexDirection:"row",alignItems:"center",gap:r.spacing.xs},""),children:[t.last_update_time&&(0,h.Y)(i.T.Text,{color:"secondary",size:"sm",css:(0,n.AH)({marginLeft:r.spacing.sm,overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap"},""),children:X(new Date(t.last_update_time))}),(0,h.Y)(le,{assessment:t,setIsEditing:s,setShowDeleteModal:l}),(0,h.Y)(de,{assessment:t,isModalVisible:o,setIsModalVisible:l})]})]})};var we=s(73879);const Me=({error:e})=>{const{theme:t}=(0,i.u)(),[s,r]=(0,a.useState)(!1);return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,h.Y)(o.Alert,{type:"error",closable:!1,message:e.error_code,componentId:"shared.model-trace-explorer.feedback-error-item",description:(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,h.Y)("span",{children:e.error_message}),e.stack_trace&&(0,h.Y)(i.T.Link,{componentId:"shared.model-trace-explorer.feedback-error-item-stack-trace-link",onClick:()=>r(!0),children:(0,h.Y)(l.sA,{id:"z/CjX4",defaultMessage:"View stack trace"})})]})}),e.stack_trace&&(0,h.Y)(R.d,{title:(0,h.Y)(l.sA,{id:"KqReh3",defaultMessage:"Error stack trace"}),visible:s,componentId:"shared.model-trace-explorer.feedback-error-stack-trace-modal",footer:null,onCancel:()=>r(!1),children:(0,h.Y)(T.C,{data:JSON.stringify(e.stack_trace),title:"",initialRenderMode:V.cC.TEXT})})]})};var De={name:"yqjhl6",styles:"display:flex;flex-direction:column;position:relative"};const ke=({feedback:e})=>{const{theme:t}=(0,i.u)(),s=e.feedback.value;return(0,h.FD)("div",{css:De,children:[(0,h.Y)(Te,{renderConnector:!1,assessment:e}),(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs,marginLeft:10,paddingLeft:t.spacing.md,paddingTop:t.spacing.sm,paddingBottom:t.spacing.md,paddingRight:t.spacing.lg,borderLeft:`1px solid ${t.colors.border}`},""),children:[(0,u.isNil)(e.feedback.error)?(0,h.FD)(h.FK,{children:[(0,h.Y)(i.T.Text,{size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,h.Y)("div",{children:(0,h.Y)(Se,{jsonValue:JSON.stringify(s)})})]}):(0,h.Y)(Me,{error:e.feedback.error}),e.rationale&&(0,h.FD)(h.FK,{children:[(0,h.Y)(i.T.Text,{size:"sm",color:"secondary",css:(0,n.AH)({marginTop:t.spacing.xs},""),children:(0,h.Y)(l.sA,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,h.Y)(we.V,{children:e.rationale})]})]})]})},Ie=({isModalVisible:e,setIsModalVisible:t,feedback:s})=>{const n=(0,a.useMemo)((()=>(e=>{const t=new Set,s=[];let n=e;for(;n&&!t.has(n.assessment_id);)t.add(n.assessment_id),s.push(n),n=n.overriddenAssessment;return s})(s)),[s]);return(0,h.Y)(R.d,{componentId:"shared.model-trace-explorer.feedback-history-modal",visible:e,footer:null,onCancel:()=>{t(!1)},title:(0,h.Y)(l.sA,{id:"n6SrIn",defaultMessage:"Edit history"}),children:n.map((e=>"feedback"in e?(0,h.Y)(ke,{feedback:e},e.assessment_id):null))})};var Ce=s(91105),Fe=s(60284),He=s(21636);var Ne={name:"1cgftv8",styles:"&:hover{text-decoration:underline;cursor:pointer;}"},Re={name:"16mcpms",styles:"& > div:last-of-type{margin-bottom:0;}"},Ee={name:"rnnx2x",styles:"font-size:12px"};const Be=({feedback:e})=>{var t,s;const[r,o]=(0,a.useState)(!1),{theme:d}=(0,i.u)(),{nodeMap:c,activeView:p}=Y(),{experimentId:m}=(0,Ce.g)(),g=e.feedback.value,f=e.span_id?c[e.span_id]:null,v="summary"===p&&f,x=null===(t=e.metadata)||void 0===t?void 0:t[He.gK],y=x&&m?Le(m,x):void 0,b=null===(s=e.metadata)||void 0===s?void 0:s[He.zZ],S=(()=>{if(null===b)return;const e=Number(b);if(!Number.isFinite(e))return;const t=String(b).match(/\.(\d+)/),s=Math.min(Math.max(t?t[1].length:0,2),6);return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:s,maximumFractionDigits:s}).format(e)})(),A=Boolean(S);return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:d.spacing.sm,marginLeft:d.spacing.lg},""),children:[!(0,u.isNil)(e.feedback.error)&&(0,h.Y)(Me,{error:e.feedback.error}),v&&(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:d.spacing.xs},""),children:[(0,h.Y)(i.T.Text,{size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"+hQbnS",defaultMessage:"Span"})}),(0,h.Y)(ge,{node:f})]}),(0,u.isNil)(e.feedback.error)&&(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:d.spacing.xs},""),children:[(0,h.Y)(i.T.Text,{size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,h.FD)("div",{css:(0,n.AH)({display:"flex",gap:d.spacing.xs},""),children:[(0,h.Y)(Se,{jsonValue:JSON.stringify(g)}),e.overriddenAssessment&&(0,h.FD)(h.FK,{children:[(0,h.Y)("span",{onClick:()=>o(!0),children:(0,h.Y)(i.T.Text,{css:Ne,color:"secondary",children:(0,h.Y)(l.sA,{id:"f4CfIz",defaultMessage:"(edited)"})})}),(0,h.Y)(Ie,{isModalVisible:r,setIsModalVisible:o,feedback:e})]})]})]}),e.rationale&&(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:d.spacing.xs},""),children:[(0,h.Y)(i.T.Text,{size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,h.Y)("div",{css:Re,children:(0,h.Y)(we.V,{children:e.rationale})})]}),A&&(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:d.spacing.xs},""),children:[(0,h.Y)(i.T.Text,{size:"sm",color:"secondary",children:(0,h.Y)(l.sA,{id:"oBJ8xc",defaultMessage:"Cost"})}),(0,h.Y)(i.T.Text,{style:{color:d.colors.textSecondary},children:S})]}),y&&(0,h.Y)(Ce.N_,{to:y,target:"_blank",rel:"noreferrer",children:(0,h.FD)("span",{css:(0,n.AH)({display:"flex",alignItems:"center",gap:d.spacing.xs},""),children:[(0,h.Y)(l.sA,{id:"4a2Kqx",defaultMessage:"View trace"}),(0,h.Y)(i.au,{css:Ee})]})})]})},Le=(e,t)=>`${Fe.Ay.getExperimentPageTracesTabRoute(e)}?selectedEvaluationId=${t}`,ze=({feedback:e})=>{const{theme:t}=(0,i.u)(),[s,r]=(0,a.useState)(!1);return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs,paddingLeft:t.spacing.lg/2,marginLeft:t.spacing.lg/2,paddingTop:t.spacing.sm,paddingBottom:t.spacing.sm,borderLeft:`1px solid ${t.colors.border}`,position:"relative"},""),children:[(0,h.Y)(Te,{assessment:e,setIsEditing:r}),s?(0,h.Y)(ue,{assessment:e,onSuccess:()=>r(!1),onCancel:()=>r(!1)}):(0,h.Y)(Be,{feedback:e})]})};const Oe=e=>{const t={"& > svg":{width:12,height:12}};switch(e){case"HUMAN":return(0,h.Y)(o.UserIcon,{css:t});case"LLM_JUDGE":return(0,h.Y)(o.SparkleIcon,{css:t});case"CODE":return(0,h.Y)(o.CodeIcon,{css:t});default:return null}};var Ke={name:"ti75j2",styles:"margin:0"};const Ve=({feedbacks:e})=>{const{theme:t}=(0,i.u)();if(e.length<2)return null;const s=(0,u.countBy)(e,(e=>e.source.source_type));return(0,h.Y)("div",{css:(0,n.AH)({display:"flex",gap:t.spacing.xs,alignItems:"center",marginLeft:t.spacing.xs},""),children:Object.entries(s).map((([e,s])=>(0,h.Y)(o.Tag,{componentId:`shared.model-trace-explorer.feedback-source-count-${e}`,css:Ke,children:(0,h.FD)("div",{css:(0,n.AH)({display:"flex",alignItems:"center",gap:t.spacing.xs},""),children:[Oe(e),(0,h.Y)(i.T.Text,{children:s})]})},e)))})};var je={name:"1fttcpj",styles:"display:flex;flex-direction:column"},_e={name:"ozd7xs",styles:"flex-shrink:0"},$e={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const Pe=({jsonValue:e,feedbacks:t})=>{const{theme:s}=(0,i.u)(),[r,l]=(0,a.useState)(!1);return(0,h.FD)("div",{css:je,children:[(0,h.FD)("div",{css:(0,n.AH)({display:"flex",gap:s.spacing.xs,alignItems:"center"},""),children:[(0,h.Y)(i.B,{componentId:"shared.model-trace-explorer.toggle-assessment-expanded",css:_e,size:"small",icon:r?(0,h.Y)(o.ChevronDownIcon,{}):(0,h.Y)(i.o,{}),onClick:()=>l(!r)}),(0,h.Y)(Se,{jsonValue:e}),(0,h.Y)(Ve,{feedbacks:t})]}),r&&(0,h.Y)("div",{css:$e,children:t.map((e=>!1===(null===e||void 0===e?void 0:e.valid)?null:(0,h.Y)(ze,{feedback:e},e.assessment_id)))})]})};var We={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"},Je={name:"ozd7xs",styles:"flex-shrink:0"};const Ue=({name:e,valuesMap:t,traceId:s,activeSpanId:r})=>{const{theme:l}=(0,i.u)(),d=(e=>{const t=e.split("/");return 1===t.length?e:2===t.length?t[1]:t.slice(2).join("/")})(e),[c,p]=(0,a.useState)(!1),m=Object.values(t).flat().some((e=>!(0,u.isNil)(e.feedback.error)));return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",marginBottom:l.spacing.sm,border:`1px solid ${l.colors.border}`,borderRadius:l.borders.borderRadiusMd,padding:l.spacing.sm+l.spacing.xs,paddingTop:l.spacing.sm,gap:l.spacing.sm},""),children:[(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:l.spacing.sm},""),children:[(0,h.FD)("div",{css:(0,n.AH)({display:"flex",alignItems:"center",gap:l.spacing.sm,flex:1,minWidth:0},""),children:[(0,h.Y)(i.T.Text,{bold:!0,css:We,children:d}),m&&(0,h.Y)(i.k,{css:Je,color:"danger"})]}),(0,h.Y)(R.T,{content:"Add new feedback",componentId:"shared.model-trace-explorer.add-feedback-in-group-tooltip",children:(0,h.Y)(i.B,{componentId:"shared.model-trace-explorer.add-feedback",css:(0,n.AH)({flexShrink:0,marginRight:-l.spacing.xs},""),size:"small",icon:(0,h.Y)(o.PlusIcon,{}),onClick:()=>p(!0)})})]}),Object.entries(t).map((([e,t])=>(0,h.Y)(Pe,{jsonValue:e,feedbacks:t},e))),c&&(0,h.Y)(ie,{assessmentName:e,spanId:r,traceId:s,setExpanded:p})]})};var Ge={name:"4c6dm7",styles:"display:flex;flex-direction:row;justify-content:space-between"};const qe=({assessments:e,traceId:t,activeSpanId:s})=>{const{theme:r}=(0,i.u)(),{setAssessmentsPaneExpanded:o}=Y(),[d,c]=(0,a.useMemo)((()=>(0,u.partition)(e,(e=>"feedback"in e))),[e]),p=(0,a.useMemo)((()=>(e=>{const t={};return e.forEach((e=>{if(!1===e.valid)return;let s=null;""!==e.feedback.value&&(s=JSON.stringify(e.feedback.value));const{assessment_name:n}=e;t[n]||(t[n]={});const a=t[n];(0,u.isNil)(s)||(a[s]||(a[s]=[]),a[s].push(e))})),Object.entries(t).toSorted((([e],[t])=>e.localeCompare(t)))})(d)),[d]),m=c.toSorted(((e,t)=>e.assessment_name.localeCompare(t.assessment_name)));return(0,h.FD)("div",{"data-testid":"assessments-pane",css:(0,n.AH)({display:"flex",flexDirection:"column",padding:r.spacing.sm,paddingTop:r.spacing.xs,height:"100%",borderLeft:`1px solid ${r.colors.border}`,overflowY:"scroll",minWidth:q,width:"100%",boxSizing:"border-box"},""),children:[(0,h.FD)("div",{css:Ge,children:[(0,h.Y)(i.T.Text,{css:(0,n.AH)({marginBottom:r.spacing.sm},""),bold:!0,children:(0,h.Y)(l.sA,{id:"++Ydlz",defaultMessage:"Assessments"})}),o&&(0,h.Y)(R.T,{componentId:"shared.model-trace-explorer.close-assessments-pane-tooltip",content:(0,h.Y)(l.sA,{id:"cQQnzX",defaultMessage:"Hide assessments"}),children:(0,h.Y)(i.B,{"data-testid":"close-assessments-pane-button",componentId:"shared.model-trace-explorer.close-assessments-pane",size:"small",icon:(0,h.Y)(i.C,{}),onClick:()=>o(!1)})})]}),p.map((([e,n])=>(0,h.Y)(Ue,{name:e,valuesMap:n,traceId:t,activeSpanId:s},e))),m.length>0&&(0,h.FD)(h.FK,{children:[(0,h.Y)(i.T.Text,{color:"secondary",css:(0,n.AH)({marginBottom:r.spacing.sm},""),children:(0,h.Y)(l.sA,{id:"UbXw8O",defaultMessage:"Expectations"})}),(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm,marginBottom:r.spacing.sm},""),children:m.map((e=>(0,h.Y)(Ye,{expectation:e},e.assessment_id)))})]}),(0,h.Y)(oe,{title:(0,h.Y)(l.sA,{id:"2+O4wk",defaultMessage:"Add new assessment"}),spanId:s,traceId:t})]})};function Xe({activeSpan:e,searchFilter:t,activeMatch:s,activeTab:r,setActiveTab:d}){const{theme:m}=(0,i.u)(),[g,f]=(0,a.useState)(500),v={flex:1,marginTop:-m.spacing.md,overflowY:"auto"},{assessmentsPaneExpanded:x,assessmentsPaneEnabled:y}=Y();if((0,u.isNil)(e))return(0,h.Y)(o.Empty,{description:"Please select a span to view more information"});const b=(0,c.N7)(e),S=b>0,A=!(0,u.isNil)(null===e||void 0===e?void 0:e.inputs)||!(0,u.isNil)(null===e||void 0===e?void 0:e.outputs),T=(0,h.FD)(o.Tabs.Root,{componentId:"shared.model-trace-explorer.right-pane-tabs",css:(0,n.AH)({display:"flex",flexDirection:"column",flex:1,borderLeft:`1px solid ${m.colors.border}`,minWidth:200,position:"relative"},""),value:r,onValueChange:e=>d(e),children:[(0,h.Y)("div",{css:(0,n.AH)({position:"absolute",right:x?m.spacing.xs:m.spacing.md,top:m.spacing.xs},""),children:(0,h.Y)(W,{})}),(0,h.FD)(o.Tabs.List,{css:(0,n.AH)({padding:0,paddingLeft:m.spacing.md,paddingRight:m.spacing.sm,boxSizing:"border-box",width:"100%"},""),children:[e.chatMessages&&(0,h.Y)(o.Tabs.Trigger,{value:"chat",children:(0,h.Y)(l.sA,{id:"BkDhmT",defaultMessage:"Chat"})}),A&&(0,h.Y)(o.Tabs.Trigger,{value:"content",children:(0,h.Y)(l.sA,{id:"KW2dOC",defaultMessage:"Inputs / Outputs"})}),(0,h.Y)(o.Tabs.Trigger,{value:"attributes",children:"Attributes"}),(0,h.FD)(o.Tabs.Trigger,{value:"events",children:["Events ",S&&(0,h.Y)(_,{count:b})]})]}),e.chatMessages&&(0,h.Y)(o.Tabs.Content,{css:v,value:"chat",children:(0,h.Y)(I,{chatMessages:e.chatMessages,chatTools:e.chatTools})}),(0,h.Y)(o.Tabs.Content,{css:v,value:"content",children:(0,h.Y)(K,{activeSpan:e,searchFilter:t,activeMatch:s})}),(0,h.Y)(o.Tabs.Content,{css:v,value:"attributes",children:(0,h.Y)(w,{activeSpan:e,searchFilter:t,activeMatch:s})}),(0,h.Y)(o.Tabs.Content,{css:v,value:"events",children:(0,h.Y)(j,{activeSpan:e,searchFilter:t,activeMatch:s})})]});return y&&x?(0,h.Y)(p.A,{initialRatio:.7,paneWidth:g,setPaneWidth:f,leftChild:T,leftMinWidth:250,rightChild:(0,h.Y)(qe,{assessments:e.assessments,traceId:e.traceId,activeSpanId:e.parentId?String(e.key):void 0}),rightMinWidth:q}):T}const Qe=a.memo(Xe),Ze=({spanFilterState:e,setSpanFilterState:t})=>{const{theme:s}=(0,i.u)();return(0,h.FD)(i.aw.Root,{componentId:"shared.model-trace-explorer.timeline-tree-filter-popover",children:[(0,h.Y)(i.aw.Trigger,{asChild:!0,children:(0,h.Y)(i.B,{componentId:"shared.model-trace-explorer.timeline-tree-filter-button",icon:(0,h.Y)(o.FilterIcon,{}),size:"small",children:(0,h.Y)(l.sA,{id:"Dm4Ez0",defaultMessage:"Filter"})})}),(0,h.Y)(i.aw.Content,{align:"start",children:(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm,paddingBottom:s.spacing.xs},""),children:[(0,h.Y)(i.T.Text,{bold:!0,children:(0,h.Y)(l.sA,{id:"oy2LTl",defaultMessage:"Filter"})}),(0,h.Y)(i.T.Text,{color:"secondary",children:(0,h.Y)(l.sA,{id:"rgSaFx",defaultMessage:"Span type"})}),Object.entries(e.spanTypeDisplayState).map((([a,r])=>{const l=(0,h.Y)(me.P,{type:(0,c.tC)(a)});return(0,h.FD)(o.Checkbox,{componentId:`shared.model-trace-explorer.toggle-span-filter_${a}-${!r}`,style:{width:"100%"},isChecked:r,onChange:()=>t({...e,spanTypeDisplayState:{...e.spanTypeDisplayState,[a]:!r}}),children:[l,(0,h.Y)(i.T.Text,{css:(0,n.AH)({marginLeft:s.spacing.xs},""),children:(0,c.LS)(a)})]},a)})),(0,h.Y)(i.T.Text,{color:"secondary",children:(0,h.Y)(l.sA,{id:"SrV58C",defaultMessage:"Settings"})}),(0,h.FD)(o.Checkbox,{componentId:`shared.model-trace-explorer.toggle-show-parents_${!e.showParents}`,style:{width:"100%"},isChecked:e.showParents,onChange:()=>t({...e,showParents:!e.showParents}),children:[(0,h.Y)(i.T.Text,{css:(0,n.AH)({marginRight:s.spacing.xs},""),children:(0,h.Y)(l.sA,{id:"nYSJgH",defaultMessage:"Show all parent spans"})}),(0,h.Y)(o.InfoTooltip,{componentId:"shared.model-trace-explorer.show-parents-tooltip",content:(0,h.Y)(l.sA,{id:"H9MulE",defaultMessage:"Always show parents of matched spans, regardless of filter conditions"})})]}),(0,h.FD)(o.Checkbox,{componentId:`shared.model-trace-explorer.toggle-show-parents_${!e.showExceptions}`,style:{width:"100%"},isChecked:e.showExceptions,onChange:()=>t({...e,showExceptions:!e.showExceptions}),children:[(0,h.Y)(i.T.Text,{css:(0,n.AH)({marginRight:s.spacing.xs},""),children:(0,h.Y)(l.sA,{id:"/vhBCt",defaultMessage:"Show exceptions"})}),(0,h.Y)(o.InfoTooltip,{componentId:"shared.model-trace-explorer.show-exceptions-tooltip",content:(0,h.Y)(l.sA,{id:"60b0vW",defaultMessage:"Always show spans with exceptions, regardless of filter conditions"})})]})]})})]})},et=({showTimelineInfo:e,setShowTimelineInfo:t,spanFilterState:s,setSpanFilterState:a})=>{const{theme:r}=(0,i.u)();return(0,h.FD)("div",{css:(0,n.AH)({padding:`${r.spacing.xs}px ${r.spacing.sm}px`,paddingBottom:3,borderBottom:`1px solid ${r.colors.border}`,boxSizing:"border-box",paddingLeft:r.spacing.sm,alignItems:"center",display:"flex",justifyContent:"space-between"},""),children:[(0,h.Y)(i.T.Text,{bold:!0,children:(0,h.Y)(l.sA,{id:"w48V74",defaultMessage:"Trace breakdown"})}),(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",gap:r.spacing.sm},""),children:[(0,h.Y)(Ze,{spanFilterState:s,setSpanFilterState:a}),(0,h.FD)(o.SegmentedControlGroup,{name:"size-story",value:e,onChange:e=>{t(e.target.value)},size:"small",componentId:"shared.model-trace-explorer.toggle-show-timeline",children:[(0,h.Y)(o.SegmentedControlButton,{"data-testid":"hide-timeline-info-button",icon:(0,h.Y)(R.T,{componentId:"shared.model-trace-explorer.hide-timeline-info-tooltip",content:(0,h.Y)(l.sA,{id:"E9fsRD",defaultMessage:"Show span tree"}),children:(0,h.Y)(o.ListBorderIcon,{})}),value:!1}),(0,h.Y)(o.SegmentedControlButton,{"data-testid":"show-timeline-info-button",icon:(0,h.Y)(R.T,{componentId:"shared.model-trace-explorer.show-timeline-info-tooltip",content:(0,h.Y)(l.sA,{id:"r5t1Je",defaultMessage:"Show execution timeline"}),children:(0,h.Y)(o.BarsAscendingVerticalIcon,{})}),value:!0})]})]})]})},tt=({active:e})=>{const{theme:t}=(0,i.u)(),s=e?t.colors.blue500:t.colors.border;return(0,h.Y)("div",{css:(0,n.AH)({position:"absolute",left:"100%",bottom:0,width:x.De/2+1,height:t.spacing.md,boxSizing:"border-box",borderTopRightRadius:t.borders.borderRadiusMd,borderTop:`1px solid ${s}`,borderRight:`1px solid ${s}`,zIndex:x.u4.LOW},"")})},st=({active:e})=>{const{theme:t}=(0,i.u)(),s=e?t.colors.blue500:t.colors.border;return(0,h.Y)("div",{css:(0,n.AH)({position:"absolute",left:"50%",top:0,width:x.De/2,height:t.spacing.md,boxSizing:"border-box",borderBottomLeftRadius:t.borders.borderRadiusMd,borderBottom:`1px solid ${s}`,borderLeft:`1px solid ${s}`,zIndex:e?x.u4.NORMAL:x.u4.LOW},"")})},nt=({active:e})=>{const{theme:t}=(0,i.u)(),s=e?t.colors.blue500:t.colors.border;return(0,h.Y)("div",{css:(0,n.AH)({position:"absolute",width:x.De/2,left:"50%",height:x.QJ,borderLeft:`1px solid ${s}`,boxSizing:"border-box",zIndex:e?x.u4.NORMAL:x.u4.LOW},"")})},at=({isActiveSpan:e,isInActiveChain:t,linesToRender:s,hasChildren:a,isExpanded:r})=>0===s.length?(0,h.Y)("div",{css:(0,n.AH)({width:0,height:x.QJ,boxSizing:"border-box",position:"relative"},""),children:a&&(0,h.Y)(tt,{active:t&&!e})}):(0,h.Y)(h.FK,{children:s.map((({shouldRender:i,isActive:o},l)=>(0,h.FD)("div",{css:(0,n.AH)({width:x.De,height:x.QJ,boxSizing:"border-box",position:"relative"},""),children:[i&&(0,h.Y)(nt,{active:o}),l===s.length-1&&(0,h.FD)(h.FK,{children:[(0,h.Y)(st,{active:t}),a&&r&&(0,h.Y)(tt,{active:t&&!e})]})]},l)))});var rt={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const it=({span:e,children:t})=>{var s;const{theme:a}=(0,i.u)(),r=(0,c.tC)(null!==(s=e.type)&&void 0!==s?s:V.UG.UNKNOWN),o=a.isDarkMode?a.colors.grey800:a.colors.grey100,d=a.isDarkMode?a.colors.grey500:a.colors.grey350;return(0,h.Y)(R.T,{componentId:"shared.model-trace-explorer.timeline-tree-node-tooltip",hideWhenDetached:!1,content:(0,h.FD)("div",{css:rt,children:[(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",gap:a.spacing.xs,alignItems:"center",overflow:"hidden",wordBreak:"break-all"},""),children:[(0,h.Y)(me.P,{type:r,isInTooltip:!0}),(0,h.Y)("span",{css:(0,n.AH)({color:o},""),children:e.title}),(0,h.Y)("span",{css:(0,n.AH)({marginLeft:a.spacing.xs,color:d,fontSize:a.typography.fontSizeSm},""),children:(0,x.X6)(e.end-e.start)})]}),(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",color:o},""),children:[(0,h.Y)(l.sA,{id:"YV6xFB",defaultMessage:"Start:"})," ",(0,x.X6)(e.start)," | ",(0,h.Y)(l.sA,{id:"q90jVU",defaultMessage:"End:"})," ",(0,x.X6)(e.end)]})]}),side:"right",maxWidth:700,children:t})};var ot={name:"18mz9c1",styles:"display:flex;flex-direction:row;align-items:center;overflow:hidden;flex:1"},lt={name:"adzntw",styles:"overflow:hidden;white-space:nowrap;text-overflow:ellipsis;flex:1"};const dt=({node:e,selectedKey:t,expandedKeys:s,setExpandedKeys:a,traceStartTime:r,traceEndTime:l,onSelect:d,linesToRender:u})=>{var p,m;const g=s.has(e.key),{theme:f}=(0,i.u)(),v=(null!==(p=e.children)&&void 0!==p?p:[]).length>0,{setAssessmentsPaneExpanded:y}=Y(),b=t===e.key,S=(0,x.VD)(e,String(t)),A=S>-1,T=(0,c.N7)(e)>0,w=b?f.colors.actionDefaultBackgroundHover:"transparent";return(0,h.FD)(h.FK,{children:[(0,h.Y)(it,{span:e,children:(0,h.Y)("div",{"data-testid":`timeline-tree-node-${e.key}`,css:(0,n.AH)({display:"flex",flexDirection:"column",width:"100%",cursor:"pointer",boxSizing:"border-box",backgroundColor:w,":hover":{backgroundColor:f.colors.actionDefaultBackgroundHover},":active":{backgroundColor:f.colors.actionDefaultBackgroundPress}},""),onClick:()=>{null===d||void 0===d||d(e)},children:(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:`0px ${f.spacing.sm}px`,justifyContent:"space-between",overflow:"hidden",flex:1},""),children:(0,h.FD)("div",{css:ot,children:[v?(0,h.Y)(i.B,{size:"small","data-testid":`toggle-span-expanded-${e.key}`,css:(0,n.AH)({flexShrink:0,marginRight:f.spacing.xs},""),icon:g?(0,h.Y)(o.ChevronDownIcon,{}):(0,h.Y)(i.o,{}),onClick:t=>{t.stopPropagation();const n=new Set(s);g?n.delete(e.key):n.add(e.key),a(n)},componentId:"shared.model-trace-explorer.toggle-span"}):(0,h.Y)("div",{css:(0,n.AH)({width:24,marginRight:f.spacing.xs},"")}),(0,h.Y)(at,{isActiveSpan:b,isInActiveChain:A,linesToRender:u,hasChildren:v,isExpanded:g}),(0,h.Y)("span",{css:(0,n.AH)({flexShrink:0,marginRight:f.spacing.xs,borderRadius:f.borders.borderRadiusSm,border:`1px solid ${S>-1?f.colors.blue500:f.colors.backgroundSecondary}`,zIndex:x.u4.NORMAL},""),children:e.icon}),(0,h.Y)(i.T.Text,{color:T?"error":"primary",css:lt,children:e.title}),e.assessments.length>0&&(0,h.FD)(o.Tag,{color:"indigo","data-testid":`assessment-tag-${e.key}`,componentId:"shared.model-trace-explorer.assessment-count",css:(0,n.AH)({margin:0,borderRadius:f.borders.borderRadiusSm},""),onClick:()=>null===y||void 0===y?void 0:y(!0),children:[(0,h.Y)(o.GavelIcon,{}),(0,h.Y)(i.T.Text,{css:(0,n.AH)({marginLeft:f.spacing.xs},""),children:e.assessments.length})]})]})})})}),g&&(null===(m=e.children)||void 0===m?void 0:m.map(((n,i)=>{var o,c;return(0,h.Y)(dt,{node:n,expandedKeys:s,setExpandedKeys:a,selectedKey:t,traceStartTime:r,traceEndTime:l,onSelect:d,linesToRender:u.concat({shouldRender:i<(null!==(o=null===(c=e.children)||void 0===c?void 0:c.length)&&void 0!==o?o:0)-1,isActive:i<S})},n.key)})))]})};var ct=s(93846);var ut={name:"1j2qjqs",styles:"flex:1;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"};const pt=({node:e,selectedKey:t,leftOffset:s,width:r,onSelect:l,expandedKeys:d,setExpandedKeys:c})=>{var u;const{theme:p}=(0,i.u)(),m=(0,a.useRef)(null),g=(0,a.useRef)(null),f=t===e.key?p.colors.actionDefaultBackgroundHover:"transparent",v=(null!==(u=e.children)&&void 0!==u?u:[]).length>0,y=d.has(e.key);return(0,a.useLayoutEffect)((()=>{if(!m.current||!g.current)return;Math.max(m.current.offsetWidth,g.current.offsetWidth)<r-p.spacing.sm?(m.current.style.display="inline",g.current.style.display="none"):(m.current.style.display="none",g.current.style.display="inline")}),[p.spacing.sm,r]),(0,h.Y)(it,{span:e,children:(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",cursor:"pointer",boxSizing:"border-box",paddingLeft:p.spacing.xs,paddingRight:p.spacing.sm,paddingTop:p.spacing.xs,paddingBottom:p.spacing.xs,backgroundColor:f,alignItems:"center",":hover":{backgroundColor:p.colors.actionDefaultBackgroundHover},":active":{backgroundColor:p.colors.actionDefaultBackgroundPress},zIndex:x.u4.NORMAL},""),onClick:()=>null===l||void 0===l?void 0:l(e),children:[v?(0,h.Y)(i.B,{size:"small","data-testid":`toggle-timeline-span-expanded-${e.key}`,css:(0,n.AH)({flexShrink:0,marginRight:p.spacing.xs},""),icon:y?(0,h.Y)(o.ChevronDownIcon,{}):(0,h.Y)(i.o,{}),onClick:t=>{t.stopPropagation();const s=new Set(d);y?s.delete(e.key):s.add(e.key),c(s)},componentId:"shared.model-trace-explorer.toggle-timeline-span"}):(0,h.Y)("div",{css:(0,n.AH)({width:24,marginRight:p.spacing.xs},"")}),(0,h.Y)("div",{css:(0,n.AH)({width:s,flexShrink:0},"")}),(0,h.Y)("div",{css:(0,n.AH)({position:"relative",width:r,height:p.typography.lineHeightBase,backgroundColor:p.colors.blue600,borderRadius:p.borders.borderRadiusSm,flexShrink:0},""),children:(0,h.Y)(i.T.Text,{children:(0,h.Y)("span",{ref:m,css:(0,n.AH)({marginLeft:p.spacing.xs,color:p.colors.white,display:"none"},""),children:e.title})})}),(0,h.FD)("div",{css:ut,children:[(0,h.Y)(i.T.Text,{children:(0,h.Y)("span",{ref:g,css:(0,n.AH)({marginLeft:p.spacing.xs,color:p.colors.textPrimary},""),children:e.title})}),(0,h.Y)(i.T.Text,{css:(0,n.AH)({marginLeft:p.spacing.xs},""),color:"secondary",children:(0,x.X6)(e.end-e.start)})]})]},e.key)})};var mt={name:"1c2ejnx",styles:"display:flex;flex-direction:column;position:relative;box-sizing:border-box"},gt={name:"bjn8wh",styles:"position:relative"},ht={name:"xyyuvf",styles:"position:absolute;height:100%;width:100%"};const ft=({nodes:e,selectedKey:t,onSelect:s,traceStartTime:r,traceEndTime:o,expandedKeys:l,setExpandedKeys:d})=>{var c,u;const{theme:p}=(0,i.u)(),m=(0,a.useRef)(null),g=null!==(c=null===(u=(0,ct.wY)({ref:m}))||void 0===u?void 0:u.width)&&void 0!==c?c:0,f=(0,a.useMemo)((()=>function(e,t,s,n=60){const a=t-e;if(a<=0||s<=0)return[];const r=Math.floor(s/n);if(r<1)return[];const i=a/r,o=Math.pow(10,Math.floor(Math.log10(i))),l=i/o;let d;d=l<=1?1:l<=2?2:l<=5?5:10;const c=d*o,u=t+2*c,p=[];for(let m=Math.ceil(e/c)*c;m<=u;m+=c)p.push(Number(m.toFixed(10)));return p}(r,o,g)),[o,r,g]),v=Math.min(...f),y=(f[f.length-1]+f[f.length-2])/2,Y=f.slice(0,-1),b=e=>function(e,t,s,n){return(e-t)/(s-t)*n}(e,v,y,g);return(0,h.FD)("div",{css:mt,children:[(0,h.Y)("div",{ref:m,css:(0,n.AH)({display:"flex",width:"100%",flexDirection:"row",height:p.typography.lineHeightBase,paddingLeft:32,paddingRight:p.spacing.lg,boxSizing:"border-box",position:"sticky",top:0,backgroundColor:p.colors.backgroundPrimary,zIndex:x.u4.HIGH},""),children:(0,h.Y)("div",{"data-testid":"time-marker-area",css:gt,children:Y.map((e=>(0,h.Y)(i.T.Text,{css:(0,n.AH)({position:"absolute",transform:"translateX(-50%)",left:b(e),whiteSpace:"nowrap"},""),children:(0,x.X6)(e)},e)))})}),(0,h.Y)("div",{css:(0,n.AH)({flex:1,pointerEvents:"none",zIndex:x.u4.LOW},""),children:(0,h.Y)("div",{css:ht,children:Y.map((e=>(0,h.Y)("div",{css:(0,n.AH)({position:"absolute",left:b(e)+32,borderRight:`1px solid ${p.colors.border}`,height:"100%"},"")},e)))})}),e.map((e=>{const n=b(e.start),a=b(e.end)-n;return(0,h.Y)(pt,{selectedKey:t,onSelect:s,node:e,leftOffset:n,width:a,expandedKeys:l,setExpandedKeys:d},e.key)}))]})};var vt={name:"1v8q7xf",styles:"flex:1;overflow:auto;min-height:100%;box-sizing:border-box;display:flex;flex-direction:column"},xt={name:"1jyk3dc",styles:"overflow:hidden;display:flex;flex-direction:column;flex:1"},yt={name:"13ku56z",styles:"display:flex;flex-direction:column;height:100%"},Yt={name:"9nf0yq",styles:"flex:1;overflow-y:auto;display:flex"};const bt=({rootNodes:e,selectedNode:t,setSelectedNode:s,traceStartTime:r,traceEndTime:o,expandedKeys:d,setExpandedKeys:c,spanFilterState:u,setSpanFilterState:p,className:m})=>{const{theme:g}=(0,i.u)(),f=(0,a.useCallback)((e=>{null===s||void 0===s||s(e)}),[s]),{showTimelineTreeGantt:v,setShowTimelineTreeGantt:y}=Y(),b=(0,a.useMemo)((()=>(0,x.os)(e,d)),[e,d]),S=(0,a.useMemo)((()=>{var s;return(0,h.Y)("div",{css:vt,children:v?(0,h.Y)(ft,{nodes:b,selectedKey:null!==(s=null===t||void 0===t?void 0:t.key)&&void 0!==s?s:"",onSelect:f,traceStartTime:r,traceEndTime:o,expandedKeys:d,setExpandedKeys:c}):e.map((e=>{var s;return(0,h.Y)(dt,{node:e,expandedKeys:d,setExpandedKeys:c,selectedKey:null!==(s=null===t||void 0===t?void 0:t.key)&&void 0!==s?s:"",traceStartTime:r,traceEndTime:o,onSelect:f,linesToRender:[]},e.key)}))})}),[v,b,null===t||void 0===t?void 0:t.key,f,r,o,e,d,c]);return(0,h.Y)("div",{css:(0,n.AH)({height:"100%",borderRadius:g.legacyBorders.borderRadiusMd,overflow:"hidden",display:"flex"},""),className:m,children:(0,h.Y)("div",{css:xt,children:(0,h.FD)("div",{css:yt,children:[(0,h.Y)(et,{showTimelineInfo:v,setShowTimelineInfo:y,spanFilterState:u,setSpanFilterState:p}),e.length>0?(0,h.Y)("div",{css:Yt,children:S}):(0,h.Y)("div",{css:(0,n.AH)({flex:1,display:"flex",justifyContent:"center",padding:g.spacing.md,paddingTop:g.spacing.lg},""),children:(0,h.Y)(l.sA,{id:"4pXg9j",defaultMessage:"No results found. Try using a different search term."})})]})})})};var St={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},At={name:"82a6rk",styles:"flex:1"};const Tt=({modelTrace:e,className:t,selectedSpanId:s,onSelectSpan:r})=>{var o,l;const{theme:d}=(0,i.u)(),c=window.innerWidth<=768?.33:.25,m=(0,a.useRef)(null),[g,f]=(0,a.useState)(500),{rootNode:y,selectedNode:b,setSelectedNode:S,activeTab:T,setActiveTab:w}=Y(),{expandedKeys:M,setExpandedKeys:D}=(0,x.B$)({rootNodes:y?[y]:[],initialExpandDepth:x.vf}),{matchData:k,searchFilter:I,setSearchFilter:C,spanFilterState:F,setSpanFilterState:H,filteredTreeNodes:N,handleNextSearchMatch:R,handlePreviousSearchMatch:E}=A({treeNode:y,selectedNode:b,setSelectedNode:S,setActiveTab:w,setExpandedKeys:D,modelTraceInfo:null===e||void 0===e?void 0:e.info});(0,a.useLayoutEffect)((()=>{const e=(0,u.values)((0,x.dM)(N,x.vf)).map((e=>e.key));D(new Set(e))}),[N,D]);const B=(0,a.useMemo)((()=>{const e=Math.max(...N.map(x.EA))*x.De+7*d.spacing.lg;return Math.max(275,e)}),[N,d.spacing.lg]);return(0,h.FD)("div",{css:St,className:t,children:[(0,h.Y)("div",{css:(0,n.AH)({padding:d.spacing.xs,borderBottom:`1px solid ${d.colors.border}`},""),children:(0,h.Y)(v,{searchFilter:I,setSearchFilter:C,matchData:k,handleNextSearchMatch:R,handlePreviousSearchMatch:E})}),(0,h.Y)(p.A,{ref:m,initialRatio:c,paneWidth:g,setPaneWidth:f,leftChild:(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",flex:1,minWidth:B},""),children:(0,h.Y)(bt,{rootNodes:N,selectedNode:b,traceStartTime:null!==(o=null===y||void 0===y?void 0:y.start)&&void 0!==o?o:0,traceEndTime:null!==(l=null===y||void 0===y?void 0:y.end)&&void 0!==l?l:0,setSelectedNode:e=>{S(e),(0,u.isString)(null===e||void 0===e?void 0:e.key)&&(null===r||void 0===r||r(null===e||void 0===e?void 0:e.key))},css:At,expandedKeys:M,setExpandedKeys:D,spanFilterState:F,setSpanFilterState:H})}),leftMinWidth:B,rightChild:(0,h.Y)(Qe,{activeSpan:b,searchFilter:I,activeMatch:k.match,activeTab:T,setActiveTab:w}),rightMinWidth:500})]})},wt=()=>(0,h.Y)(o.Empty,{title:(0,h.Y)(l.sA,{id:"rjhiii",defaultMessage:"Trace failed to render"}),description:(0,h.Y)(l.sA,{id:"1a1+j5",defaultMessage:"Unfortunately, the trace could not be rendered due to an unknown error. You can reload the page to try again. If the problem persists, please contact support."}),image:(0,h.Y)(i.k,{})});var Mt=s(45547);const Dt=e=>JSON.stringify(`import mlflow\n\n# returns an MLflow Trace object\ntrace = mlflow.get_trace('${e}')\n\n# trace.info contains tags and metadata\ntrace_info = trace.info\n\n# the trace's spans are stored in trace.data\nspans = trace.data.spans`);var kt={name:"b9l38d",styles:"width:min-content"};const It=({traceId:e,setForceDisplay:t})=>{const{theme:s}=(0,i.u)();return(0,h.Y)(o.Empty,{image:(0,h.Y)(i.W,{}),title:(0,h.Y)(l.sA,{id:"4Itm9y",defaultMessage:"Large trace"}),description:(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:s.spacing.md,alignItems:"center"},""),children:[(0,h.Y)(l.sA,{id:"TvjS47",defaultMessage:"This trace is very large, and may cause UI slowness when attempting to render. You can click the button below to attempt to display it anyway."}),(0,h.Y)(i.B,{componentId:"shared.model-trace-explorer.trace-too-large.force-display-button",css:kt,onClick:()=>t(!0),children:(0,h.Y)(l.sA,{id:"rFJSWc",defaultMessage:"Attempt to display"})}),(0,h.Y)("span",{children:(0,h.Y)(l.sA,{id:"1Buj/Q",defaultMessage:"Alternatively, you can interact with this trace via the MLflow Python SDK, using the {code} function. For more information, please check the {documentation_link}.",values:{code:(0,h.Y)(i.T.Text,{code:!0,children:"mlflow.get_trace()"}),documentation_link:(0,h.Y)(i.T.Link,{href:"https://mlflow.org/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.Trace",target:"_blank",openInNewTab:!0,componentId:"shared.model-trace-explorer.trace-too-large.documentation-link",children:(0,h.Y)(l.sA,{id:"7RNlsx",defaultMessage:"MLflow API documentation"})})}})}),(0,h.Y)(Mt.w,{data:Dt(e),renderMode:V.cC.PYTHON,initialExpanded:!0})]})})};var Ct=s(49708),Ft=s(31655);var Ht=s(42401);const Nt=({node:e})=>{var t;const{theme:s}=(0,i.u)(),a=(0,c.bn)(e),r=!e.parentId,l=a[0];return l?(0,h.Y)(k.p,{css:(0,n.AH)({marginBottom:r?s.spacing.sm:0},""),withBorder:r,sectionKey:l.name,title:(0,h.FD)("div",{css:(0,n.AH)({display:"flex",alignItems:"center",gap:s.spacing.sm},""),children:[(0,h.Y)(o.XCircleIcon,{color:"danger"}),(0,h.Y)(i.T.Text,{color:"error",bold:!0,children:"Exception"})]}),children:(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm,paddingBottom:s.spacing.sm,paddingLeft:r?0:s.spacing.lg},""),children:Object.entries(null!==(t=l.attributes)&&void 0!==t?t:{}).map((([e,t])=>(0,h.Y)(Ht.B,{title:e,data:JSON.stringify(t,null,2),renderMode:"text"},e)))})},l.name):null};var Rt={name:"s6cpzs",styles:"display:flex;flex-direction:column;flex:1;min-width:0"},Et={name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"},Bt={name:"1cgftv8",styles:"&:hover{text-decoration:underline;cursor:pointer;}"};const Lt=({node:e,renderMode:t})=>{const{theme:s}=(0,i.u)(),[r,d]=(0,a.useState)(!1),u=(0,a.useMemo)((()=>(0,c.g_)(e.inputs)),[e]),p=(0,a.useMemo)((()=>(0,c.g_)(e.outputs)),[e]),m=(0,c.bn)(e),g=e.chatMessageFormat,f=m.length>0,v=u.length>0,y=p.length>0,{setSelectedNode:b,setActiveView:S,setShowTimelineTreeGantt:A}=Y();return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",minHeight:48,flexShrink:0},""),children:[(0,h.Y)("div",{css:(0,n.AH)({height:48,display:"flex",alignItems:"center"},""),children:(0,h.Y)(i.B,{size:"small","data-testid":`toggle-span-expanded-${e.key}`,css:(0,n.AH)({flexShrink:0,marginRight:s.spacing.xs},""),icon:r?(0,h.Y)(o.ChevronDownIcon,{}):(0,h.Y)(i.o,{}),onClick:()=>d(!r),componentId:"shared.model-trace-explorer.toggle-span"})}),(0,h.Y)("div",{css:(0,n.AH)({position:"relative",boxSizing:"border-box",height:"100%",borderLeft:`2px solid ${s.colors.border}`,width:12},""),children:(0,h.Y)("div",{css:(0,n.AH)({position:"absolute",left:-2,top:14,height:12,width:12,boxSizing:"border-box",borderBottomLeftRadius:s.borders.borderRadiusMd,borderBottom:`2px solid ${s.colors.border}`,borderLeft:`2px solid ${s.colors.border}`},"")})}),(0,h.FD)("div",{css:Rt,children:[(0,h.FD)("div",{css:Et,children:[(0,h.Y)(i.T.Text,{color:"secondary",css:(0,n.AH)({display:"inline-flex",alignItems:"center",height:48},""),children:(0,h.Y)(l.sA,{id:"SbMdmm",defaultMessage:"{spanName} was called",values:{spanName:(0,h.Y)(ge,{node:e})}})}),(0,h.Y)("span",{onClick:()=>{b(e),S("detail"),A(!0)},children:(0,h.Y)(i.T.Text,{css:Bt,color:"secondary",children:(0,x.X6)(e.end-e.start)})})]}),r&&(0,h.FD)("div",{children:[f&&(0,h.Y)(Nt,{node:e}),v&&(0,h.Y)(k.p,{sectionKey:"input",title:(0,h.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm,paddingLeft:s.spacing.lg,marginBottom:s.spacing.sm},""),children:u.map((({key:e,value:s},n)=>(0,h.Y)(Ht.B,{title:e,data:s,renderMode:t,chatMessageFormat:g},e||n)))})}),y&&(0,h.Y)(k.p,{sectionKey:"output",title:(0,h.Y)(l.sA,{id:"ZstVNI",defaultMessage:"Outputs"}),children:(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm,paddingLeft:s.spacing.lg,marginBottom:s.spacing.sm},""),children:p.map((({key:e,value:s})=>(0,h.Y)(Ht.B,{title:e,data:s,renderMode:t,chatMessageFormat:g},e)))})})]})]})]})};var zt=s(47784);const Ot=({rootNode:e,intermediateNodes:t})=>{const{theme:s}=(0,i.u)(),[r,d]=(0,a.useState)("default"),u=e.inputs,p=e.outputs,m=e.chatMessageFormat,g=(0,c.bn)(e),f=t.length>0,v=g.length>0,x=(0,c.g_)(u).filter((({value:e})=>"null"!==e)),y=(0,c.g_)(p).filter((({value:e})=>"null"!==e));return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",flex:1,minHeight:0,padding:s.spacing.md,paddingTop:s.spacing.sm,overflow:"auto",minWidth:400},""),children:[(0,h.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",justifyContent:"flex-end",marginBottom:s.spacing.sm},""),children:(0,h.FD)("div",{css:(0,n.AH)({display:"flex",gap:s.spacing.sm},""),children:[(0,h.FD)(o.SegmentedControlGroup,{name:"render-mode",componentId:"shared.model-trace-explorer.summary-view.render-mode",value:r,size:"small",onChange:e=>d(e.target.value),children:[(0,h.Y)(o.SegmentedControlButton,{value:"default",children:(0,h.Y)(l.sA,{id:"uYkbr+",defaultMessage:"Default"})}),(0,h.Y)(o.SegmentedControlButton,{value:"json",children:(0,h.Y)(l.sA,{id:"XC1Pro",defaultMessage:"JSON"})})]}),(0,h.Y)(W,{})]})}),v&&(0,h.Y)(Nt,{node:e}),(0,h.Y)(zt.l,{title:(0,h.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),css:(0,n.AH)({marginBottom:f?0:s.spacing.md},""),sectionKey:"summary-inputs",data:x,renderMode:r,chatMessageFormat:m}),f&&t.map((e=>(0,h.Y)(Lt,{node:e,renderMode:r},e.key))),(0,h.Y)(zt.l,{title:(0,h.Y)(l.sA,{id:"ZstVNI",defaultMessage:"Outputs"}),sectionKey:"summary-outputs",data:y,renderMode:r,chatMessageFormat:m})]})},Kt=e=>{var t;return!!e.parentId&&([V.UG.AGENT,V.UG.RETRIEVER,V.UG.CHAT_MODEL,V.UG.TOOL,V.UG.LLM].includes(null!==(t=e.type)&&void 0!==t?t:V.UG.UNKNOWN)||(0,c.N7)(e)>0)},Vt=({modelTrace:e})=>{const{theme:t}=(0,i.u)(),[s,r]=(0,a.useState)(500),{rootNode:d,nodeMap:c,assessmentsPaneEnabled:u,assessmentsPaneExpanded:m}=Y(),g=(0,a.useMemo)((()=>Object.values(c).flatMap((e=>e.assessments))),[c]),f=(0,a.useMemo)((()=>{if(!d)return[];return(0,x.VC)([d]).filter(Kt)}),[d]);return d?u&&m?(0,h.Y)(p.A,{initialRatio:.75,paneWidth:s,setPaneWidth:r,leftChild:(0,h.Y)(Ot,{rootNode:d,intermediateNodes:f}),rightChild:(0,h.Y)(qe,{assessments:g,traceId:d.traceId,activeSpanId:void 0}),leftMinWidth:400,rightMinWidth:q}):(0,h.Y)(Ot,{rootNode:d,intermediateNodes:f}):(0,h.Y)("div",{css:(0,n.AH)({marginTop:t.spacing.lg},""),children:(0,h.Y)(o.Empty,{description:(0,h.Y)(l.sA,{id:"hm98EL",defaultMessage:"No span data to display"})})})};var jt=s(7655),_t=s(40724),$t=s(90828);var Pt={name:"dgkyot",styles:"cursor:default;width:fit-content;max-width:100%"},Wt={name:"j601fv",styles:"flex-basis:45%;flex-shrink:0"},Jt={name:"1sdjnkx",styles:"word-break:break-word"};const Ut=({traceMetadata:e,getTruncatedLabel:t=e=>(0,$t.Y7)(e,40),getComponentId:s})=>{const{theme:r}=(0,i.u)(),l=e=>{if(e&&"object"===typeof e)try{return JSON.stringify(e)}catch{return String(e)}if("string"===typeof e){const t=(0,$t.pt)(e);if(t&&"object"===typeof t)try{return JSON.stringify(t)}catch{return e}return e}return String(null!==e&&void 0!==e?e:"")},d=(0,a.useMemo)((()=>Object.entries(e||{}).filter((([e,t])=>null!==t&&""!==t&&!e.startsWith($t.nt))).sort((([e],[t])=>e.localeCompare(t))).map((([e,t])=>({key:e,value:t,displayValue:l(t)})))),[e]);return 0===d.length?null:(0,h.FD)("div",{css:(0,n.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:r.spacing.sm},""),children:[(0,h.Y)(i.T.Text,{size:"md",color:"secondary",children:(0,h.Y)(_t.A,{id:"zRKlAL",defaultMessage:"Metadata"})}),(0,h.Y)(o.Overflow,{noMargin:!0,children:(0,h.Y)(o.HoverCard,{trigger:(0,h.Y)(o.Tag,{componentId:s("metadata-pill"),color:"default",css:Pt,children:(0,h.FD)("span",{css:(0,n.AH)({display:"flex",alignItems:"center",gap:r.spacing.xs},""),children:[(0,h.Y)(R.L,{css:(0,n.AH)({fontSize:12,color:r.colors.textSecondary},"")}),(0,h.Y)("span",{children:d.length})]})}),content:(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:r.spacing.xs,maxWidth:480,maxHeight:320,overflowY:"auto"},""),children:[d.slice(0,100).map((({key:e,displayValue:s,value:a})=>(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",alignItems:"flex-start",gap:r.spacing.xs},""),children:[(0,h.Y)(i.T.Text,{css:Wt,children:t(e)}),(0,h.Y)(i.T.Text,{color:"secondary",css:Jt,children:s})]},`${e}:${a}`))),d.length>100&&(0,h.FD)(i.T.Text,{color:"secondary",children:["+",d.length-100," more"]})]})})})]})};var Gt=s(71102),qt=s(27637);const Xt=Gt.g,Qt=qt.N_,Zt=(e,t)=>`/experiments/${e}/chat-sessions/${t}`;var es={name:"rnnx2x",styles:"font-size:12px"};const ts=({experimentId:e,sessionId:t})=>{const{theme:s}=(0,i.u)(),a=t.length>10?`${t.slice(0,10)}...`:t;return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:s.spacing.sm},""),children:[(0,h.Y)(i.T.Text,{size:"md",color:"secondary",children:(0,h.Y)(_t.A,{id:"XIWwOm",defaultMessage:"Session ID"})}),(0,h.Y)(R.T,{componentId:"mlflow.model-trace-explorer.session-id-tag",content:(0,h.Y)(Qt,{to:Zt(e,t),target:"_blank",rel:"noopener noreferrer",children:(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:s.spacing.sm,color:s.colors.actionPrimaryIcon},""),children:[(0,h.Y)(_t.A,{id:"OUPWd8",defaultMessage:"View chat session"}),(0,h.Y)(i.au,{})]})}),children:(0,h.Y)(Qt,{to:Zt(e,t),target:"_blank",rel:"noopener noreferrer",children:(0,h.Y)(o.Tag,{componentId:"mlflow.model_trace_explorer.header_details.tag-session-id",children:(0,h.FD)("span",{css:(0,n.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:s.spacing.xs},""),children:[(0,h.Y)(o.SpeechBubbleIcon,{css:es}),(0,h.Y)("span",{children:a})]})})})})]})};var ss={name:"e0dnmk",styles:"cursor:pointer"};const ns=({label:e,value:t,icon:s,tagKey:a,color:r="teal",getTruncatedLabel:l,getComponentId:d,onCopy:c})=>{const{theme:u}=(0,i.u)();return(0,h.FD)("div",{css:(0,n.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:u.spacing.sm},""),children:[(0,h.Y)(i.T.Text,{size:"md",color:"secondary",children:e}),(0,h.Y)(R.T,{componentId:d(a),content:t,maxWidth:400,children:(0,h.Y)(o.Tag,{componentId:d(a),color:r,onClick:()=>{navigator.clipboard.writeText(t),c()},css:ss,children:(0,h.FD)("span",{css:(0,n.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:u.spacing.xs},""),children:[s&&(0,h.Y)("span",{children:s}),(0,h.Y)("span",{children:l(t)})]})})})]})};var as={name:"7z0gr8",styles:"font-size:12px;display:flex;align-items:center;justify-content:center"},rs={name:"mqlsmr",styles:"font-size:12px;display:flex"},is={name:"e0dnmk",styles:"cursor:pointer"};const os=({modelTrace:e})=>{var t,s;(0,jt.A)();const{theme:r}=(0,i.u)(),[l,d]=(0,a.useState)(!1),{rootNode:u}=Y(),{experimentId:p}=Xt(),m=Object.entries(null!==(t=e.info.tags)&&void 0!==t?t:{}).filter((([e])=>(0,$t.oD)(e))),f=(0,c.MF)(e),v=(0,a.useMemo)((()=>{var t,s,n;return(0,$t.pt)(null!==(t=null===(s=e.info)||void 0===s||null===(n=s.trace_metadata)||void 0===n?void 0:n[V.OS])&&void 0!==t?t:"{}")}),[e.info]),y=(0,a.useMemo)((()=>null===v||void 0===v?void 0:v.total_tokens),[v]),b=(0,a.useMemo)((()=>{if(u)return(0,x.X6)(u.end-u.start)}),[u]),S=(0,a.useMemo)((()=>{var t,s;return null===(t=e.info)||void 0===t||null===(s=t.trace_metadata)||void 0===s?void 0:s[V.Fg]}),[e.info]),A=(0,a.useMemo)((()=>{var t,s;return null===(t=e.info)||void 0===t||null===(s=t.trace_metadata)||void 0===s?void 0:s[V.E3]}),[e.info]),T=(0,a.useCallback)((e=>`mlflow.model_trace_explorer.header_details.tag-${e}`),[]),w=e=>(0,$t.Y7)(e,40),M=(0,a.useCallback)((()=>{d(!0),setTimeout((()=>d(!1)),2e3)}),[]);return(0,h.FD)(h.FK,{children:[(0,h.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",gap:r.spacing.md,flexWrap:"wrap"},""),children:[f&&(0,h.Y)(ns,{label:(0,h.Y)(_t.A,{id:"imKpxw",defaultMessage:"ID"}),value:f,tagKey:f,color:"pink",getTruncatedLabel:w,getComponentId:T,onCopy:M}),y&&(0,h.Y)(ns,{label:(0,h.Y)(_t.A,{id:"zp4MBw",defaultMessage:"Token count"}),value:y.toString(),tagKey:"token-count",color:"default",getTruncatedLabel:w,getComponentId:T,onCopy:M}),b&&(0,h.Y)(ns,{label:(0,h.Y)(_t.A,{id:"K1JLVU",defaultMessage:"Latency"}),icon:(0,h.Y)(g.C,{css:as}),value:b,tagKey:"latency",color:"default",getTruncatedLabel:w,getComponentId:T,onCopy:M}),S&&p&&(0,h.Y)(ts,{experimentId:p,sessionId:S}),A&&(0,h.Y)(ns,{label:(0,h.Y)(_t.A,{id:"128VYg",defaultMessage:"User"}),icon:(0,h.Y)(o.UserIcon,{css:rs}),value:A,tagKey:"user",color:"default",getTruncatedLabel:w,getComponentId:T,onCopy:M}),(0,h.Y)(Ut,{traceMetadata:null===(s=e.info)||void 0===s?void 0:s.trace_metadata,getTruncatedLabel:w,getComponentId:T}),m.length>0&&(0,h.FD)("div",{css:(0,n.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:r.spacing.sm},""),children:[(0,h.Y)(i.T.Text,{size:"md",color:"secondary",children:(0,h.Y)(_t.A,{id:"7KPJii",defaultMessage:"Tags"})}),(0,h.Y)(o.Overflow,{noMargin:!0,children:m.map((([e,t])=>{const s=`${e}-${t}`,n=`${e}: ${t}`;return(0,h.Y)(R.T,{componentId:T(s),content:n,children:(0,h.Y)(o.Tag,{componentId:T(s),color:"teal",onClick:()=>{var e;e=n,navigator.clipboard.writeText(e),M()},css:is,children:w(`${e}: ${t}`)})},e)}))})]})]}),l&&(0,h.FD)(o.Notification.Provider,{children:[(0,h.Y)(o.Notification.Root,{severity:"success",componentId:"mlflow.model_trace_explorer.header_details.notification",children:(0,h.Y)(o.Notification.Title,{children:(0,h.Y)(_t.A,{id:"xgypqc",defaultMessage:"Copied to clipboard"})})}),(0,h.Y)(o.Notification.Viewport,{})]})]})};var ls={name:"lve99z",styles:"& > div:nth-of-type(2){margin-bottom:0;flex-shrink:0;}display:flex;flex-direction:column;height:100%;overflow:hidden"},ds={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},cs={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"};const us=({modelTrace:e,className:t,selectedSpanId:s,onSelectSpan:a})=>{const{theme:r}=(0,i.u)(),{activeView:d,setActiveView:c}=Y();return(0,h.FD)(o.Tabs.Root,{componentId:"model-trace-explorer",value:d,onValueChange:e=>c(e),css:ls,children:[(0,h.Y)("div",{css:(0,n.AH)({paddingLeft:r.spacing.md,paddingBottom:r.spacing.sm},""),children:(0,h.Y)(os,{modelTrace:e})}),(0,h.FD)(o.Tabs.List,{css:(0,n.AH)({paddingLeft:r.spacing.md,flexShrink:0},""),children:[(0,h.Y)(o.Tabs.Trigger,{value:"summary",children:(0,h.Y)(l.sA,{id:"paolVF",defaultMessage:"Summary"})}),(0,h.Y)(o.Tabs.Trigger,{value:"detail",children:(0,h.Y)(l.sA,{id:"Wh+aKq",defaultMessage:"Details & Timeline"})})]}),(0,h.Y)(o.Tabs.Content,{value:"summary",css:ds,children:(0,h.Y)(Vt,{modelTrace:e})}),(0,h.Y)(o.Tabs.Content,{value:"detail",css:cs,children:(0,h.Y)(Tt,{modelTrace:e,className:t,selectedSpanId:s,onSelectSpan:a})})]})},ps=({children:e})=>(0,h.Y)(r.tH,{fallbackRender:wt,children:e}),ms=({modelTrace:e,className:t,initialActiveView:s,selectedSpanId:n,onSelectSpan:r})=>{var i;const[o,l]=(0,a.useState)(e),[u,p]=(0,a.useState)(!1),m=(0,c.MF)(e),g=null!==(i=(0,c.ob)(e))&&void 0!==i?i:0,f=!(0,d.ny)()||g<(0,d.T9)(),[v,x]=(0,a.useState)(m.startsWith("tr-"));return(({traceId:e,setModelTrace:t,setAssessmentsPaneEnabled:s,enabled:n=!0})=>{const a=[c.BS,e];(0,Ct.I)({queryKey:a,queryFn:()=>(0,ae.N5)({traceId:e}),onSuccess:e=>{t((t=>{var s,n;return{data:t.data,info:null!==(s=null===e||void 0===e||null===(n=e.trace)||void 0===n?void 0:n.trace_info)&&void 0!==s?s:{}}})),s(!0)},onError:()=>{(0,Ft.WE)()&&s(!1)},enabled:n})})({traceId:m,setModelTrace:l,setAssessmentsPaneEnabled:x,enabled:f&&m.startsWith("tr-")}),(0,a.useEffect)((()=>{l(e)}),[m]),f||u?(0,h.Y)(ps,{traceId:m,children:(0,h.Y)(b,{modelTrace:o,initialActiveView:s,selectedSpanIdOnRender:n,assessmentsPaneEnabled:v,children:(0,h.Y)(us,{modelTrace:o,className:t,selectedSpanId:n,onSelectSpan:r})})}):(0,h.Y)(It,{traceId:m,setForceDisplay:p})}},15929:function(e,t,s){s.d(t,{F:function(){return d}});var n=s(68248),a=s(27757),r=s(74060),i=s(73408);var o={name:"15currb",styles:"display:flex;height:100%"},l={name:"82a6rk",styles:"flex:1"};const d=({label:e})=>{const{theme:t}=(0,a.u)();return(0,i.FD)("div",{css:o,children:[(0,i.FD)("div",{css:l,children:[(0,i.Y)("div",{css:(0,n.AH)({padding:t.spacing.sm,borderBottom:`1px solid ${t.colors.border}`},""),children:(0,i.Y)(r.TitleSkeleton,{label:e})}),(0,i.FD)("div",{css:(0,n.AH)({borderRadius:t.legacyBorders.borderRadiusMd,overflow:"hidden",display:"flex"},""),children:[(0,i.Y)("div",{css:(0,n.AH)({flex:1,padding:t.spacing.sm,borderRight:`1px solid ${t.colors.border}`},""),children:(0,i.Y)(r.TableSkeleton,{lines:5})}),(0,i.Y)("div",{css:(0,n.AH)({flex:2,padding:t.spacing.sm},""),children:(0,i.Y)(r.TableSkeleton,{lines:5})})]})]}),(0,i.Y)("div",{css:(0,n.AH)({padding:t.spacing.md,overflowY:"auto",flex:1},""),children:(0,i.Y)(r.TableSkeleton,{lines:12})})]})}},21057:function(e,t,s){s.d(t,{$:function(){return d}});var n=s(59930),a=s.n(n),r=s(46709),i=s(884),o=s(7655);function l(e,t){if(void 0!==e)return 0===e&&a()(!1,"maxLength must be greater than 0"),{maxLength:{value:e,message:t.formatMessage({id:"JW0GbU",defaultMessage:"You can set a maximum of {maxLength} values"},{maxLength:e})}}}function d({name:e,maxLength:t,emptyValue:s,defaultValues:n,loading:d,form:c,keyProperty:u,valueProperty:p}){const[m]=(0,r.useState)(s),g=(0,i.xW)(),h=Boolean(g)&&!c,f=h?g:c;a()(f,"Nest your component on a FormProvider or pass a form prop"),a()(!(n&&h),"Define defaultValues at form context level");const{setValue:v}=f,x=function({name:e,maxLength:t,emptyValue:s,form:n,keyProperty:d}){const c=(0,o.A)(),u=(0,i.xW)(),p=Boolean(u)&&!n?u:n;a()(p,"Nest your component on a FormProvider or pass a form prop");const[m]=(0,r.useState)(s),{append:g,update:h,remove:f,...v}=(0,i.jz)({name:e,control:p.control,rules:l(t,c)}),{getValues:x}=p,y=(0,r.useCallback)((()=>x(e)),[x,e]),Y=(0,r.useCallback)(((e,s)=>{const n=y();t&&n&&n.length>=t||g(e,s)}),[y,t,g]),b=(0,r.useCallback)((e=>{const t=y();if(t&&e===t.length-1)return h(e,m);const s=null===t||void 0===t?void 0:t.at(-1);if(null!==s&&void 0!==s&&s[d])return f(e),void g(m,{shouldFocus:!1});f(e)}),[m,y,d,g,f,h]);return{form:p,...v,originalAppend:g,update:h,originalRemove:f,appendIfPossible:Y,removeOrUpdate:b,getTagsValues:y}}({name:e,maxLength:t,emptyValue:s,form:f,keyProperty:u}),y=x.getTagsValues;return(0,r.useEffect)((()=>{if(!d){if(n){const s=[...n];return(!t||t&&s.length<t)&&s.push(m),void v(e,s)}if(h){var s;const n=null!==(s=y())&&void 0!==s?s:[];return(!t||t&&n.length<t)&&n.push(m),void v(e,n)}v(e,[m])}}),[n,v,d,t,e,m,h,y]),{...x,form:f,maxLength:t,emptyValue:s,name:e,keyProperty:u,valueProperty:p}}},21209:function(e,t,s){s.d(t,{p:function(){return d}});var n=s(68248),a=s(46709),r=s(27757),i=s(74060),o=s(73408);var l={name:"1d3w5wq",styles:"width:100%"};const d=({sectionKey:e,title:t,children:s,withBorder:d=!1,className:c})=>{const[u,p]=(0,a.useState)(!0),{theme:m}=(0,r.u)();return(0,o.FD)("div",{className:c,css:(0,n.AH)({display:"flex",flexDirection:"column",borderRadius:m.borders.borderRadiusMd},""),children:[(0,o.FD)("div",{css:(0,n.AH)({alignItems:"center",display:"flex",flexDirection:"row",gap:m.spacing.xs,padding:d?m.spacing.sm:0,background:d?m.colors.backgroundSecondary:void 0,borderTopLeftRadius:m.borders.borderRadiusMd,borderTopRightRadius:m.borders.borderRadiusMd,borderBottomLeftRadius:u?0:m.borders.borderRadiusMd,borderBottomRightRadius:u?0:m.borders.borderRadiusMd,border:d?`1px solid ${m.colors.border}`:void 0,marginBottom:d?0:m.spacing.sm},""),children:[(0,o.Y)(r.B,{size:"small",componentId:`shared.model-trace-explorer.expand-${e}`,type:"tertiary",icon:u?(0,o.Y)(i.ChevronDownIcon,{}):(0,o.Y)(r.o,{}),onClick:()=>p(!u)}),(0,o.Y)(r.T.Title,{withoutMargins:!0,level:4,css:l,children:t})]}),u&&(0,o.Y)("div",{css:(0,n.AH)({border:d?`1px solid ${m.colors.border}`:void 0,borderTop:"none",borderBottomLeftRadius:d?m.borders.borderRadiusMd:void 0,borderBottomRightRadius:d?m.borders.borderRadiusMd:void 0,padding:d?m.spacing.sm:0},""),children:s})]})}},30679:function(e,t,s){s.d(t,{k:function(){return l}});var n=s(27757),a=s(74060),r=s(73408);function i(e){return(0,r.Y)(n.B,{icon:(0,r.Y)(a.TrashIcon,{}),...e})}var o=s(87307);function l({index:e,...t}){const{removeOrUpdate:s}=(0,o.Y7)();return(0,r.Y)(i,{onClick:()=>s(e),...t})}},33120:function(e,t,s){s.d(t,{ff:function(){return r},we:function(){return i}});var n=s(36476);const a=fetch;const r=async(e,t="GET",s,r)=>{const i={method:t,signal:r,headers:{...s?{"Content-Type":"application/json"}:{},...l(document.cookie)}};s&&(i.body=function(e){if(void 0!==e)return"string"===typeof e||e instanceof FormData||e instanceof Blob?e:JSON.stringify(e)}(s));const o=await a(e,i);if(!o.ok){const e=(0,n.a$)(o);if(e){try{const t=(await o.json()).message;e.message=null!==t&&void 0!==t?t:e.message}catch{}throw e}}return o.json()},i=e=>e;const o=e=>{const t="mlflow-request-header-",s=function(e=document.cookie){return e.split(";").reduce(((e,t)=>{const[s,n]=t.trim().split("=");return e[s]=decodeURIComponent(n||""),e}),{})}(e);return s&&0!==Object.keys(s).length?Object.keys(s).filter((e=>e.startsWith(t))).reduce(((e,t)=>({...e,[t.substring(22)]:s[t]})),{}):{}},l=e=>({...o(e)})},33145:function(e,t,s){s.d(t,{R:function(){return r},e:function(){return a}});var n=s(74060);const a=e=>"feedback"in e?e.feedback.value:"value"in e.expectation?e.expectation.value:e.expectation.serialized_value.value,r=e=>{switch(e.source_type){case"HUMAN":return n.UserIcon;case"LLM_JUDGE":return n.SparkleIcon;default:return n.CodeIcon}}},33669:function(e,t,s){s.d(t,{J:function(){return l}});var n=s(68248),a=s(76118),r=s(27757),i=s(61072),o=s(73408);function l({messages:e}){const{theme:t}=(0,r.u)();return(0,a.isNil)(e)?null:(0,o.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:e.map(((e,t)=>(0,o.Y)(i.X,{message:e},t)))})}},42401:function(e,t,s){s.d(t,{s:function(){return Y},B:function(){return b}});var n=s(68248),a=s(76118),r=s(46709),i=s(27757),o=s(91461),l=s(73408);const d=({title:e,tools:t})=>{const{theme:s}=(0,i.u)();return(0,l.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm,padding:s.spacing.sm,border:`1px solid ${s.colors.border}`,borderRadius:s.borders.borderRadiusSm},""),children:[e&&(0,l.Y)(i.T.Text,{css:(0,n.AH)({marginLeft:s.spacing.xs},""),bold:!0,children:e}),t.map((e=>(0,l.Y)(o.E,{tool:e},e.function.name)))]})};var c=s(9599);const u=({title:e,documents:t})=>{const{theme:s}=(0,i.u)();return(0,l.FD)("div",{css:(0,n.AH)({backgroundColor:s.colors.backgroundPrimary,borderRadius:s.borders.borderRadiusSm,border:`1px solid ${s.colors.border}`},""),children:[e&&(0,l.Y)("div",{css:(0,n.AH)({padding:`${s.spacing.xs}px ${s.spacing.sm}px`,borderBottom:`1px solid ${s.colors.border}`},""),children:(0,l.Y)(i.T.Text,{bold:!0,children:e})}),t.map(((e,a)=>(0,l.Y)("div",{css:(0,n.AH)({borderBottom:a!==t.length-1?`1px solid ${s.colors.border}`:""},""),children:(0,l.Y)(c.p,{text:e.page_content,metadata:e.metadata},a)},a)))]})};var p=s(74060),m=s(42747),g=s(73879);const h=({title:e,value:t})=>{const{theme:s}=(0,i.u)(),[a,o]=(0,r.useState)(!1),d=t.length>400,c=!a&&t.length>400?t.slice(0,400)+"...":t,u=d?{":hover":{backgroundColor:s.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,l.FD)("div",{css:(0,n.AH)({border:`1px solid ${s.colors.border}`,borderRadius:s.borders.borderRadiusSm},""),children:[e&&(0,l.FD)("div",{role:"button",css:(0,n.AH)({display:"flex",justifyContent:"space-between",alignItems:"center",padding:`${s.spacing.sm}px ${s.spacing.sm+s.spacing.xs}px`,...u},""),onClick:()=>o(!a),children:[(0,l.Y)(i.T.Title,{level:4,color:"secondary",withoutMargins:!0,children:e}),d&&(a?(0,l.Y)(p.ChevronDownIcon,{}):(0,l.Y)(i.o,{}))]}),(0,l.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm,paddingLeft:s.spacing.sm+s.spacing.xs,paddingRight:s.spacing.sm+s.spacing.xs,paddingTop:e?0:s.spacing.sm,paddingBottom:s.spacing.sm,"& > div:last-of-type":{marginBottom:0}},""),children:[(0,l.Y)(g.V,{children:c}),d&&(0,l.Y)(i.T.Link,{onClick:()=>o(!a),componentId:"shared.model-trace-explorer.text-field-see-more-link",children:a?(0,l.Y)(m.sA,{id:"Y5Rr5k",defaultMessage:"See less"}):(0,l.Y)(m.sA,{id:"Hyv8Go",defaultMessage:"See more"})})]})]})};var f=s(94664),v=s(86125),x=s(49425),y=s(33669);const Y=3,b=({title:e,data:t,renderMode:s,chatMessageFormat:o,maxVisibleMessages:c=Y})=>{const{theme:p}=(0,i.u)(),[g,b]=(0,r.useState)(!1),S=(0,r.useMemo)((()=>{try{return JSON.parse(t)}catch(e){return t}}),[t]);(0,r.useEffect)((()=>{b(!1)}),[t]);const A=(0,a.isString)(S)||(0,a.isNumber)(S)||(0,a.isBoolean)(S),T=(0,v.Hq)(e?{[e]:S}:S,o),w=Array.isArray(S)&&S.length>0&&(0,a.every)(S,v.PC),M=Array.isArray(S)&&S.length>0&&(0,a.every)(S,v.W0);if(T&&T.length>0){const t=T.length>c,s=g||!t?T:T.slice(-c),a=t?T.length-s.length:0;return(0,l.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:p.spacing.sm,padding:p.spacing.sm,border:`1px solid ${p.colors.border}`,borderRadius:p.borders.borderRadiusSm},""),children:[e&&(0,l.Y)(i.T.Title,{level:4,color:"secondary",withoutMargins:!0,css:(0,n.AH)({marginLeft:p.spacing.xs},""),children:e}),t&&(0,l.Y)(i.T.Link,{css:(0,n.AH)({alignSelf:"flex-start",marginLeft:p.spacing.xs},""),componentId:"shared.model-trace-explorer.conversation-toggle",onClick:()=>b(!g),children:g?(0,l.Y)(m.sA,{id:"nugZSE",defaultMessage:"Show less"}):(0,l.Y)(m.sA,{id:"/akgwX",defaultMessage:"Show {hiddenMessageCount} more",values:{hiddenMessageCount:a}})}),(0,l.Y)(y.J,{messages:s})]})}return"json"===s?(0,l.Y)(x.C,{title:e,data:t,initialRenderMode:f.cC.JSON}):"text"===s?(0,l.Y)(x.C,{title:e,data:t,initialRenderMode:f.cC.TEXT}):A?(0,l.Y)(h,{title:e,value:String(S)}):w?(0,l.Y)(d,{title:e,tools:S}):M?(0,l.Y)(u,{title:e,documents:S}):(0,l.Y)(x.C,{title:e,data:t})}},44666:function(e,t,s){s.d(t,{w:function(){return n}});const n=()=>"User"},47784:function(e,t,s){s.d(t,{l:function(){return d}});var n=s(68248),a=s(27757),r=s(21209),i=s(42401),o=s(46709),l=s(73408);const d=({title:e,data:t,renderMode:s,sectionKey:d,maxVisibleItems:c=3,maxVisibleChatMessages:u=i.s,className:p,chatMessageFormat:m})=>{const{theme:g}=(0,a.u)(),[h,f]=(0,o.useState)(!1),v=t.length>c,x=v&&!h?t.slice(-c):t,y=v?t.length-x.length:0;return(0,l.Y)(r.p,{withBorder:!0,title:e,className:p,sectionKey:d,children:(0,l.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:g.spacing.sm},""),children:[v&&(0,l.Y)(a.T.Link,{css:(0,n.AH)({alignSelf:"flex-start",marginLeft:g.spacing.xs},""),componentId:"shared.model-trace-explorer.conversation-toggle",onClick:()=>f(!h),children:h?"Show less":`Show ${y} more`}),x.map((({key:e,value:t},n)=>(0,l.Y)(i.B,{title:e,data:t,renderMode:s,chatMessageFormat:m,maxVisibleMessages:u},e||n)))]})})}},49425:function(e,t,s){s.d(t,{C:function(){return y}});var n=s(68248),a=s(76118),r=s(46709),i=s(27757),o=s(74060),l=s(94664),d=s(45547),c=s(21636),u=s(73408);const p=({title:e,searchFilter:t,isActiveMatch:s})=>{const{theme:a}=(0,i.u)(),o=(0,r.useCallback)((e=>{null===e||void 0===e||e.scrollIntoView({block:"nearest",inline:"nearest"})}),[]),l=e.toLowerCase();if(!l.includes(t))return(0,u.Y)("div",{children:e});const d=l.indexOf(t),p=d+t.length,m=s?a.colors[c.kj]:a.colors[c.Bt];return(0,u.FD)("div",{children:[e.slice(0,d),(0,u.Y)("span",{ref:s?o:null,css:(0,n.AH)({backgroundColor:m,scrollMarginTop:50},""),children:e.slice(d,p)}),e.slice(p)]})};function m(e,t){return t||(e?l.cC.MARKDOWN:l.cC.JSON)}function g(e){switch(e){case l.cC.JSON:return"JSON";case l.cC.TEXT:return"Text";case l.cC.MARKDOWN:return"Markdown";case l.cC.PYTHON:return"Python"}}var h={name:"bjn8wh",styles:"position:relative"},f={name:"1boj65s",styles:"max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},v={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"},x={name:"2fp7nl",styles:"height:min-content;margin:0"};function y({title:e,tokens:t,data:s,searchFilter:c="",activeMatch:y=null,containsActiveMatch:Y=!1,initialRenderMode:b}){var S;const A=(0,r.useMemo)((()=>JSON.parse(s)),[s]),T=(0,a.isString)(A),{theme:w}=(0,i.u)(),[M,D]=(0,r.useState)(m(T,b)),k=Y&&null!==(S=null===y||void 0===y?void 0:y.isKeyMatch)&&void 0!==S&&S,I=T&&!c;return(0,r.useEffect)((()=>{D(m(T,b))}),[T,b]),(0,u.Y)("div",{css:h,children:(0,u.FD)("div",{css:(0,n.AH)({borderRadius:w.borders.borderRadiusSm,border:`1px solid ${w.colors.border}`,overflow:"hidden"},""),children:[(e||I)&&(0,u.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:w.spacing.sm},""),children:[(0,u.Y)(i.T.Title,{css:f,level:4,color:"secondary",withoutMargins:!0,children:(0,u.Y)(p,{title:e,searchFilter:c,isActiveMatch:k})}),(0,u.Y)("div",{css:v,children:I&&(0,u.FD)(o.DropdownMenu.Root,{children:[(0,u.Y)(o.DropdownMenu.Trigger,{asChild:!0,children:(0,u.Y)(o.Tag,{componentId:"shared.model-trace-explorer.snippet-render-mode-tag",css:x,children:(0,u.FD)("div",{css:(0,n.AH)({paddingLeft:w.spacing.xs,marginRight:w.spacing.xs,cursor:"pointer"},""),children:[(0,u.Y)(i.T.Text,{size:"sm",color:"secondary",children:g(M)}),(0,u.Y)(o.ChevronDownIcon,{})]})})}),(0,u.FD)(o.DropdownMenu.Content,{children:[(0,u.Y)(o.DropdownMenu.RadioGroup,{componentId:"shared.model-trace-explorer.snippet-render-mode-radio",value:M,onValueChange:e=>D(e),children:Object.values(l.cC).map((e=>e===l.cC.PYTHON?null:(0,u.FD)(o.DropdownMenu.RadioItem,{value:e,children:[(0,u.Y)(o.DropdownMenu.ItemIndicator,{}),g(e)]},e)))}),(0,u.Y)(o.DropdownMenu.Arrow,{})]})]})})]}),(0,u.Y)(d.w,{data:s,searchFilter:c,activeMatch:y,containsActiveMatch:Y,renderMode:M})]})})}},51989:function(e,t,s){s.d(t,{E:function(){return u}});var n=s(59930),a=s.n(n),r=s(884),i=s(68248),o=s(27757),l=s(73408);function d({children:e}){const{theme:t}=(0,o.u)();return(0,l.Y)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:e})}var c=s(87307);function u({children:e,...t}){const s=(0,r.xW)(),n=(0,l.Y)(c.Os,{...t,children:(0,l.Y)(d,{children:e})});return s?n:(a()(t.form,"Nest your component on a FormProvider or pass a form prop"),(0,l.Y)(r.Op,{...t.form,children:n}))}},63815:function(e,t,s){s.d(t,{t:function(){return o}});var n=s(884),a=s(64836),r=s(87307),i=s(73408);function o({rules:e,index:t,render:s}){const{name:o,valueProperty:l}=(0,r.Y7)();return(0,i.Y)(n.xI,{rules:e,name:`${o}.${t}.${l}`,render:({field:e,fieldState:t,formState:n})=>{var r;return s?s({field:e,fieldState:t,formState:n}):(0,i.Y)(a.w,{componentId:"TagAssignmentValue.Default.Input",errorMessage:null===(r=t.error)||void 0===r?void 0:r.message,...e})}})}},64836:function(e,t,s){s.d(t,{w:function(){return l}});var n=s(46709),a=s(66916),r=s(74060),i=s(73408);var o={name:"82a6rk",styles:"flex:1"};const l=(0,n.forwardRef)((({errorMessage:e,...t},s)=>(0,i.FD)("div",{css:o,children:[(0,i.Y)(a.I,{validationState:e?"error":"info",...t,ref:s}),e&&(0,i.Y)(r.FormUI.Message,{message:e,type:"error"})]})))},81813:function(e,t,s){s.d(t,{y:function(){return c}});var n=s(68248),a=s(27757),r=s(86125),i=s(61072),o=s(47784),l=s(40724),d=s(73408);const c=({trace:e})=>{var t,s;const{theme:c}=(0,a.u)();if(!(null===(t=e.data)||void 0===t?void 0:t.spans))return null;const u=(0,r.jW)(e);if(!u)return null;const p=u.chatMessages,m=null!==(s=null===p||void 0===p?void 0:p.slice(null===p||void 0===p?void 0:p.findLastIndex((e=>"user"===e.role))))&&void 0!==s?s:[];if(0!==m.length)return(0,d.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:c.spacing.sm},""),children:null===m||void 0===m?void 0:m.map(((e,t)=>(0,d.Y)(i.X,{message:e,css:(0,n.AH)({maxWidth:"80%",alignSelf:"user"===e.role?"flex-start":"flex-end"},"")},t)))});const g=(0,r.g_)(u.inputs).filter((e=>"null"!==e.value)).reverse(),h=(0,r.g_)(u.outputs).filter((e=>"null"!==e.value)).reverse();return(0,d.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:c.spacing.sm},""),children:[(0,d.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:c.spacing.sm,width:"80%",alignSelf:"flex-start",backgroundColor:c.colors.backgroundPrimary},""),children:(0,d.Y)(o.l,{title:(0,d.Y)(l.A,{id:"nJxDSh",defaultMessage:"Inputs"}),data:g,renderMode:"default",sectionKey:"summary-inputs",maxVisibleItems:1,maxVisibleChatMessages:1})}),(0,d.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:c.spacing.sm,width:"80%",alignSelf:"flex-end",backgroundColor:c.colors.backgroundPrimary},""),children:(0,d.Y)(o.l,{title:(0,d.Y)(l.A,{id:"adVHxN",defaultMessage:"Outputs"}),data:h,renderMode:"default",sectionKey:"summary-outputs",maxVisibleItems:1,maxVisibleChatMessages:1})})]})}},86916:function(e,t,s){s.d(t,{q:function(){return d}});var n=s(68248),a=s(59930),r=s.n(a),i=s(46709),o=s(27757),l=s(73408);function d({children:e}){const{theme:t}=(0,o.u)(),s=i.Children.toArray(e);r()(s.length<=3,"TagAssignmentRow must have 3 children or less");const a=Array(3).fill(null).map(((e,n)=>{var a;return null!==(a=s[n])&&void 0!==a?a:(0,l.Y)("span",{style:{width:t.general.heightSm}},n)}));return(0,l.Y)("div",{css:(0,n.AH)({display:"grid",gridTemplateColumns:"1fr 1fr min-content",gap:t.spacing.sm},""),children:a})}},87307:function(e,t,s){s.d(t,{Os:function(){return l},Y7:function(){return d}});var n=s(59930),a=s.n(n),r=s(46709),i=s(73408);const o=(0,r.createContext)(null);function l({children:e,...t}){return(0,i.Y)(o.Provider,{value:t,children:e})}function d(){const e=(0,r.useContext)(o);return a()(e,"useTagAssignmentContext must be used within a TagAssignmentRoot"),e}},89602:function(e,t,s){s.d(t,{C:function(){return r}});var n=s(27757),a=s(73408);function r({children:e}){return(0,a.Y)(n.T.Text,{bold:!0,children:e})}},91461:function(e,t,s){s.d(t,{E:function(){return c}});var n=s(68248),a=s(46709),r=s(27757),i=s(74060),o=s(42747),l=s(73408);function d({paramName:e,paramProperties:t,isRequired:s}){const{theme:a}=(0,r.u)(),{type:i,description:d,enum:c}=t,u=i||d||c,p=u?{borderTopLeftRadius:a.borders.borderRadiusMd,borderTopRightRadius:a.borders.borderRadiusMd,borderBottom:`1px solid ${a.colors.border}`}:{borderRadius:a.borders.borderRadiusMd};return(0,l.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:a.borders.borderRadiusMd,border:`1px solid ${a.colors.border}`},""),children:[(0,l.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",alignItems:"center",backgroundColor:a.colors.backgroundSecondary,padding:`${a.spacing.sm}px ${a.spacing.md}px`,gap:a.spacing.sm,...p},""),children:[(0,l.Y)(r.T.Title,{withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:e}),s&&(0,l.Y)(r.T.Text,{withoutMargins:!0,color:"error",children:(0,l.Y)(o.sA,{id:"JmNdE4",defaultMessage:"required"})})]}),u&&(0,l.FD)("div",{css:(0,n.AH)({display:"grid",gridTemplateColumns:"auto 1fr",gridTemplateRows:"auto",gap:a.spacing.md,padding:`${a.spacing.sm}px ${a.spacing.md}px`},""),children:[i&&(0,l.FD)(l.FK,{children:[(0,l.Y)(r.T.Text,{withoutMargins:!0,bold:!0,children:(0,l.Y)(o.sA,{id:"CbRDlp",defaultMessage:"Type"})}),(0,l.Y)(r.T.Text,{withoutMargins:!0,code:!0,children:i})]}),d&&(0,l.FD)(l.FK,{children:[(0,l.Y)(r.T.Text,{withoutMargins:!0,bold:!0,children:(0,l.Y)(o.sA,{id:"SLjN1/",defaultMessage:"Description"})}),(0,l.Y)(r.T.Text,{withoutMargins:!0,children:d})]}),c&&(0,l.FD)(l.FK,{children:[(0,l.Y)(r.T.Text,{withoutMargins:!0,bold:!0,children:(0,l.Y)(o.sA,{id:"/WK1x1",defaultMessage:"Enum Values"})}),(0,l.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"row",gap:a.spacing.sm,flexWrap:"wrap"},""),children:c.map((e=>(0,l.Y)(r.T.Text,{withoutMargins:!0,code:!0,children:e},e)))})]})]})]})}function c({tool:e}){var t,s,o;const{theme:c}=(0,r.u)(),[u,p]=(0,a.useState)(!1),m=e.function.description,g=null===(t=e.function.parameters)||void 0===t?void 0:t.properties,h=null!==(s=null===(o=e.function.parameters)||void 0===o?void 0:o.required)&&void 0!==s?s:[],f=m||g,v=f?{":hover":{backgroundColor:c.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,l.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:c.borders.borderRadiusMd,border:`1px solid ${c.colors.border}`,backgroundColor:c.colors.backgroundPrimary},""),"data-testid":"model-trace-explorer-chat-tool",children:[(0,l.FD)("div",{role:"button",css:(0,n.AH)({display:"flex",flexDirection:"row",gap:c.spacing.sm,alignItems:"center",borderBottom:f&&u?`1px solid ${c.colors.border}`:"none",padding:c.spacing.sm,...v},""),onClick:()=>p(!u),"data-testid":"model-trace-explorer-chat-tool-toggle",children:[f&&(u?(0,l.Y)(i.ChevronDownIcon,{}):(0,l.Y)(r.o,{})),(0,l.Y)(r.T.Text,{bold:!0,withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:e.function.name})]}),f&&u&&(0,l.FD)("div",{css:(0,n.AH)({padding:c.spacing.sm},""),children:[m&&(0,l.Y)(r.T.Paragraph,{style:{whiteSpace:"pre-wrap",marginBottom:c.spacing.sm,padding:`0px ${c.spacing.xs}px`},children:e.function.description}),g&&(0,l.Y)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:c.spacing.sm},""),children:Object.keys(g).map((e=>(0,l.Y)(d,{paramName:e,paramProperties:g[e],isRequired:h.includes(e)},e)))})]})]})}}}]);